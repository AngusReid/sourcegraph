<span class="com">/* sbt -- Simple Build Tool
 * Copyright 2011 Mark Harrah
 */</span><span class="">
</span><span class="kwd">package</span><span class=""> </span><span class="pln">sbt</span><span class="">

</span><span class="kwd">import</span><span class=""> </span><span class="pln">scala.concurrent.duration.</span><span class="pun">{</span><span class=""> </span><span class="pln">FiniteDuration</span><span class="pun">,</span><span class=""> </span><span class="pln">Duration</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.util.Attributed</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.util.Attributed.data</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">Scope.</span><span class="pun">{</span><span class=""> </span><span class="pln">fillTaskAxis</span><span class="pun">,</span><span class=""> </span><span class="pln">GlobalScope</span><span class="pun">,</span><span class=""> </span><span class="pln">ThisScope</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.Compiler.InputsWithPrevious</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.librarymanagement.mavenint.</span><span class="pun">{</span><span class=""> </span><span class="pln">PomExtraDependencyAttributes</span><span class="pun">,</span><span class=""> </span><span class="pln">SbtPomExtraProperties</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">xsbt.api.Discovery</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">xsbti.compile.CompileOrder</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">Project.</span><span class="pun">{</span><span class=""> </span><span class="pln">inConfig</span><span class="pun">,</span><span class=""> </span><span class="pln">inScope</span><span class="pun">,</span><span class=""> </span><span class="pln">inTask</span><span class="pun">,</span><span class=""> </span><span class="pln">richInitialize</span><span class="pun">,</span><span class=""> </span><span class="pln">richInitializeTask</span><span class="pun">,</span><span class=""> </span><span class="pln">richTaskSessionVar</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">Def.</span><span class="pun">{</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">,</span><span class=""> </span><span class="pln">ScopedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">Setting</span><span class="pun">,</span><span class=""> </span><span class="pln">SettingsDefinition</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.librarymanagement.</span><span class="pun">{</span><span class=""> </span><span class="pln">CustomPomParser</span><span class="pun">,</span><span class=""> </span><span class="pln">DependencyFilter</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.librarymanagement.Artifact.</span><span class="pun">{</span><span class=""> </span><span class="pln">DocClassifier</span><span class="pun">,</span><span class=""> </span><span class="pln">SourceClassifier</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.librarymanagement.</span><span class="pun">{</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">,</span><span class=""> </span><span class="pln">ConflictManager</span><span class="pun">,</span><span class=""> </span><span class="pln">CrossVersion</span><span class="pun">,</span><span class=""> </span><span class="pln">MavenRepository</span><span class="pun">,</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">,</span><span class=""> </span><span class="pln">ScalaArtifacts</span><span class="pun">,</span><span class=""> </span><span class="pln">UpdateOptions</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.librarymanagement.Configurations.</span><span class="pun">{</span><span class=""> </span><span class="pln">Compile</span><span class="pun">,</span><span class=""> </span><span class="pln">CompilerPlugin</span><span class="pun">,</span><span class=""> </span><span class="pln">IntegrationTest</span><span class="pun">,</span><span class=""> </span><span class="pln">names</span><span class="pun">,</span><span class=""> </span><span class="pln">Provided</span><span class="pun">,</span><span class=""> </span><span class="pln">Runtime</span><span class="pun">,</span><span class=""> </span><span class="pln">Test</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.librarymanagement.CrossVersion.</span><span class="pun">{</span><span class=""> </span><span class="pln">binarySbtVersion</span><span class="pun">,</span><span class=""> </span><span class="pln">binaryScalaVersion</span><span class="pun">,</span><span class=""> </span><span class="pln">partialVersion</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.util.complete._</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">std.TaskExtra._</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.inc.</span><span class="pun">{</span><span class=""> </span><span class="pln">Analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">ClassfileManager</span><span class="pun">,</span><span class=""> </span><span class="pln">ClasspathOptions</span><span class="pun">,</span><span class=""> </span><span class="pln">CompilerCache</span><span class="pun">,</span><span class=""> </span><span class="pln">FileValueCache</span><span class="pun">,</span><span class=""> </span><span class="pln">IncOptions</span><span class="pun">,</span><span class=""> </span><span class="pln">Locate</span><span class="pun">,</span><span class=""> </span><span class="pln">LoggerReporter</span><span class="pun">,</span><span class=""> </span><span class="pln">MixedAnalyzingCompiler</span><span class="pun">,</span><span class=""> </span><span class="pln">ScalaInstance</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">testing.</span><span class="pun">{</span><span class=""> </span><span class="pln">Framework</span><span class="pun">,</span><span class=""> </span><span class="pln">Runner</span><span class="pun">,</span><span class=""> </span><span class="pln">AnnotatedFingerprint</span><span class="pun">,</span><span class=""> </span><span class="pln">SubclassFingerprint</span><span class=""> </span><span class="pun">}</span><span class="">

</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.librarymanagement._</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.librarymanagement._</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.librarymanagement.syntax._</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.util._</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.util.Level</span><span class="">

</span><span class="kwd">import</span><span class=""> </span><span class="pln">sys.error</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">scala.xml.NodeSeq</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">org.apache.ivy.core.module.</span><span class="pun">{</span><span class=""> </span><span class="pln">descriptor</span><span class="pun">,</span><span class=""> </span><span class="pln">id</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">descriptor.ModuleDescriptor</span><span class="pun">,</span><span class=""> </span><span class="pln">id</span><span class="pun">.</span><span class="pln">ModuleRevisionId</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">java.io.</span><span class="pun">{</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">PrintWriter</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">java.net.</span><span class="pun">{</span><span class=""> </span><span class="pln">URI</span><span class="pun">,</span><span class=""> </span><span class="pln">URL</span><span class="pun">,</span><span class=""> </span><span class="pln">MalformedURLException</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">java.util.concurrent.</span><span class="pun">{</span><span class=""> </span><span class="pln">TimeUnit</span><span class="pun">,</span><span class=""> </span><span class="pln">Callable</span><span class=""> </span><span class="pun">}</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbinary.DefaultProtocol.StringFormat</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.util.Cache.seqFormat</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.util.Logger</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">CommandStrings.ExportStream</span><span class="">

</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.util.Types._</span><span class="">

</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.internal.io.WatchState</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.io.</span><span class="pun">{</span><span class=""> </span><span class="pln">AllPassFilter</span><span class="pun">,</span><span class=""> </span><span class="pln">FileFilter</span><span class="pun">,</span><span class=""> </span><span class="pln">GlobFilter</span><span class="pun">,</span><span class=""> </span><span class="pln">HiddenFileFilter</span><span class="pun">,</span><span class=""> </span><span class="pln">IO</span><span class="pun">,</span><span class=""> </span><span class="pln">NameFilter</span><span class="pun">,</span><span class=""> </span><span class="pln">NothingFilter</span><span class="pun">,</span><span class=""> </span><span class="pln">Path</span><span class="pun">,</span><span class=""> </span><span class="pln">PathFinder</span><span class=""> </span><span class="pun">}</span><span class="">

</span><span class="kwd">import</span><span class=""> </span><span class="pln">Path._</span><span class="">
</span><span class="kwd">import</span><span class=""> </span><span class="pln">Keys._</span><span class="">

</span><span class="kwd">object</span><span class=""> </span><span class="pln">Defaults</span><span class=""> </span><span class="kwd">extends</span><span class=""> </span><span class="pln">BuildCommon</span><span class=""> </span><span class="pun">{</span><span class="">
  </span><span class="kwd">final</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">CacheDirectoryName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="str">&#34;cache&#34;</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">configSrcSub</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">key</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">ThisScope</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">config</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Global</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">configuration</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">src</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">src</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">nameForSrc</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">nameForSrc</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">config</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">Compile</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="str">&#34;main&#34;</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">config</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">prefix</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">config</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">Compile</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="str">&#34;&#34;</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">config</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;-&#34;</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">lock</span><span class="pun">(</span><span class="pln">app</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">AppConfiguration</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">GlobalLock</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">app</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">launcher</span><span class="pun">.</span><span class="pln">globalLock</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">extractAnalysis</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class=""> </span><span class="pln">Attributed</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pun">(</span><span class="pln">T</span><span class="pun">,</span><span class=""> </span><span class="pln">Analysis</span><span class="pun">)</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="pln">a</span><span class="pun">.</span><span class="pln">metadata</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">Keys</span><span class="pun">.</span><span class="pln">analysis</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">Analysis</span><span class="pun">.</span><span class="pln">Empty</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">analysisMap</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Attributed</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">T</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">Analysis</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">m</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">cp</span><span class="pun">;</span><span class=""> </span><span class="pln">an</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">a</span><span class="pun">.</span><span class="pln">metadata</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">Keys</span><span class="pun">.</span><span class="pln">analysis</span><span class="pun">)</span><span class=""> </span><span class="kwd">yield</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="pln">an</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toMap</span><span class="">
      </span><span class="pln">m</span><span class="pun">.</span><span class="pln">get</span><span class=""> </span><span class="kwd">_</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">ss</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">defaultSettings</span><span class="pun">(</span><span class="pln">inScope</span><span class="pun">(</span><span class="pln">GlobalScope</span><span class="pun">)</span><span class="pun">(</span><span class="pln">ss</span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">buildCore</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">thisBuildCore</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">globalCore</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">thisBuildCore</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inScope</span><span class="pun">(</span><span class="pln">GlobalScope</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">project</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Select</span><span class="pun">(</span><span class="pln">ThisBuild</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">managedDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">baseDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;lib_managed&#34;</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use AutoPlugins and globalSbtCore instead.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">globalCore</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">defaultTestTasks</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">defaultTestTasks</span><span class="pun">(</span><span class="pln">testOnly</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">defaultTestTasks</span><span class="pun">(</span><span class="pln">testQuick</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">excludeFilter</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">HiddenFileFilter</span><span class="">
  </span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">globalIvyCore</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">globalJvmCore</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">globalSbtCore</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">globalJvmCore</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
      </span><span class="pln">compilerCache</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">Keys</span><span class="pun">.</span><span class="pln">stateCompilerCache</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">CompilerCache</span><span class="pun">.</span><span class="pln">fresh</span><span class="pun">,</span><span class="">
      </span><span class="pln">sourcesInBase</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
      </span><span class="pln">autoAPIMappings</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
      </span><span class="pln">apiMappings</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Map</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">,</span><span class="">
      </span><span class="pln">autoScalaLibrary</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
      </span><span class="pln">managedScalaInstance</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
      </span><span class="pln">definesClass</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">FileValueCache</span><span class="pun">(</span><span class="pln">Locate</span><span class="pun">.</span><span class="pln">definesClass</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class="pun">.</span><span class="pln">get</span><span class="pun">,</span><span class="">
      </span><span class="pln">traceLevel</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="dec">0</span><span class="pun">,</span><span class="">
      </span><span class="pln">traceLevel</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">runMain</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="dec">0</span><span class="pun">,</span><span class="">
      </span><span class="pln">traceLevel</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">console</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Int</span><span class="pun">.</span><span class="pln">MaxValue</span><span class="pun">,</span><span class="">
      </span><span class="pln">traceLevel</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">consoleProject</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Int</span><span class="pun">.</span><span class="pln">MaxValue</span><span class="pun">,</span><span class="">
      </span><span class="pln">autoCompilerPlugins</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
      </span><span class="pln">scalaHome</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
      </span><span class="pln">apiURL</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
      </span><span class="pln">javaHome</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
      </span><span class="pln">testForkedParallel</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
      </span><span class="pln">javaOptions</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
      </span><span class="pln">sbtPlugin</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
      </span><span class="pln">crossPaths</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
      </span><span class="pln">sourcePositionMappers</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
      </span><span class="pln">artifactClassifier</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">packageSrc</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">SourceClassifier</span><span class="pun">)</span><span class="pun">,</span><span class="">
      </span><span class="pln">artifactClassifier</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">packageDoc</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">DocClassifier</span><span class="pun">)</span><span class="pun">,</span><span class="">
      </span><span class="pln">includeFilter</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">NothingFilter</span><span class="pun">,</span><span class="">
      </span><span class="pln">includeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedSources</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="str">&#34;*.java&#34;</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="str">&#34;*.scala&#34;</span><span class="pun">,</span><span class="">
      </span><span class="pln">includeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedJars</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="str">&#34;*.jar&#34;</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="str">&#34;*.so&#34;</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="str">&#34;*.dll&#34;</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="str">&#34;*.jnilib&#34;</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="str">&#34;*.zip&#34;</span><span class="pun">,</span><span class="">
      </span><span class="pln">includeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedResources</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">AllPassFilter</span><span class="">
    </span><span class="pun">)</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">globalIvyCore</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
      </span><span class="pln">internalConfigurationMap</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">internalMap</span><span class=""> </span><span class="kwd">_</span><span class="pun">,</span><span class="">
      </span><span class="pln">credentials</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
      </span><span class="pln">exportJars</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
      </span><span class="pln">retrieveManaged</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
      </span><span class="pln">retrieveManagedSync</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
      </span><span class="pln">configurationsToRetrieve</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
      </span><span class="pln">scalaOrganization</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">ScalaArtifacts</span><span class="pun">.</span><span class="pln">Organization</span><span class="pun">,</span><span class="">
      </span><span class="pln">sbtResolver</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">sbtVersion</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">endsWith</span><span class=""> </span><span class="str">&#34;-SNAPSHOT&#34;</span><span class="pun">)</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">typesafeSnapshots</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">typesafeReleases</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
      </span><span class="pln">crossVersion</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">CrossVersion</span><span class="pun">.</span><span class="pln">Disabled</span><span class="pun">,</span><span class="">
      </span><span class="pln">buildDependencies</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">constructBuildDependencies</span><span class="pun">,</span><span class="">
      </span><span class="pln">version</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="str">&#34;0.1-SNAPSHOT&#34;</span><span class="pun">,</span><span class="">
      </span><span class="pln">classpathTypes</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Set</span><span class="pun">(</span><span class="str">&#34;jar&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;bundle&#34;</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">CustomPomParser</span><span class="pun">.</span><span class="pln">JarPackagings</span><span class="pun">,</span><span class="">
      </span><span class="pln">artifactClassifier</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
      </span><span class="pln">checksums</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">bootChecksums</span><span class="pun">(</span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
      </span><span class="pln">conflictManager</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">ConflictManager</span><span class="pun">.</span><span class="pln">default</span><span class="pun">,</span><span class="">
      </span><span class="pln">pomExtra</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">NodeSeq</span><span class="pun">.</span><span class="pln">Empty</span><span class="pun">,</span><span class="">
      </span><span class="pln">pomPostProcess</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">idFun</span><span class="pun">,</span><span class="">
      </span><span class="pln">pomAllRepositories</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
      </span><span class="pln">pomIncludeRepository</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">defaultRepositoryFilter</span><span class="pun">,</span><span class="">
      </span><span class="pln">updateOptions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">UpdateOptions</span><span class="pun">(</span><span class="pun">)</span><span class="pun">,</span><span class="">
      </span><span class="pln">forceUpdatePeriod</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="">
    </span><span class="pun">)</span><span class="">

  </span><span class="com">/** Core non-plugin settings for sbt builds.  These *must* be on every build or the sbt engine will fail to run at all. */</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">globalSbtCore</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">outputStrategy</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class=""> </span><span class="com">// TODO - This might belong elsewhere.</span><span class="">
    </span><span class="pln">buildStructure</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Project</span><span class="pun">.</span><span class="pln">structure</span><span class="pun">(</span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">settingsData</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">buildStructure</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">data</span><span class="pun">,</span><span class="">
    </span><span class="pln">trapExit</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
    </span><span class="pln">connectInput</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
    </span><span class="pln">cancelable</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
    </span><span class="pln">taskCancelStrategy</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">state</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">cancelable</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">TaskCancellationStrategy</span><span class="pun">.</span><span class="pln">Signal</span><span class="">
      </span><span class="kwd">else</span><span class=""> </span><span class="pln">TaskCancellationStrategy</span><span class="pun">.</span><span class="pln">Null</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">envVars</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Map</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">,</span><span class="">
    </span><span class="pln">sbtVersion</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">id</span><span class="pun">.</span><span class="pln">version</span><span class="pun">,</span><span class="">
    </span><span class="pln">sbtBinaryVersion</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">binarySbtVersion</span><span class="pun">(</span><span class="pln">sbtVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">watchingMessage</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Watched</span><span class="pun">.</span><span class="pln">defaultWatchingMessage</span><span class="pun">,</span><span class="">
    </span><span class="pln">triggeredMessage</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Watched</span><span class="pun">.</span><span class="pln">defaultTriggeredMessage</span><span class="pun">,</span><span class="">
    </span><span class="pln">onLoad</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">idFun</span><span class="pun">[</span><span class="typ">State</span><span class="pun">]</span><span class="pun">,</span><span class="">
    </span><span class="pln">onUnload</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">idFun</span><span class="pun">[</span><span class="typ">State</span><span class="pun">]</span><span class="pun">,</span><span class="">
    </span><span class="pln">onUnload</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">try</span><span class=""> </span><span class="pln">onUnload</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">finally</span><span class=""> </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">delete</span><span class="pun">(</span><span class="pln">taskTemporaryDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">extraLoggers</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">watchSources</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">skip</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
    </span><span class="pln">taskTemporaryDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">dir</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">createTemporaryDirectory</span><span class="pun">;</span><span class=""> </span><span class="pln">dir</span><span class="pun">.</span><span class="pln">deleteOnExit</span><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span><span class=""> </span><span class="pln">dir</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">onComplete</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">dir</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">taskTemporaryDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="pun">;</span><span class=""> </span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">delete</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">)</span><span class="pun">;</span><span class=""> </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">createDirectory</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">Previous</span><span class="pun">.</span><span class="pln">cache</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">Previous</span><span class="pun">.</span><span class="pln">cacheSetting</span><span class="pun">,</span><span class="">
    </span><span class="pln">Previous</span><span class="pun">.</span><span class="pln">references</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Previous</span><span class="pun">.</span><span class="pln">References</span><span class="pun">,</span><span class="">
    </span><span class="pln">concurrentRestrictions</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">defaultRestrictions</span><span class="pun">,</span><span class="">
    </span><span class="pln">parallelExecution</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
    </span><span class="pln">pollInterval</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="dec">500</span><span class="pun">,</span><span class="">
    </span><span class="pln">logBuffered</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
    </span><span class="pln">commands</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">showSuccess</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
    </span><span class="pln">showTiming</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
    </span><span class="pln">timingFormat</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Aggregation</span><span class="pun">.</span><span class="pln">defaultFormat</span><span class="pun">,</span><span class="">
    </span><span class="pln">aggregate</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
    </span><span class="pln">maxErrors</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="dec">100</span><span class="pun">,</span><span class="">
    </span><span class="pln">fork</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
    </span><span class="pln">initialize</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pun">{</span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">forcegc</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">props</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="str">&#34;sbt.task.forcegc&#34;</span><span class="pun">)</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">Boolean</span><span class="pun">.</span><span class="pln">parseBoolean</span><span class="pun">)</span><span class="pun">.</span><span class="pln">getOrElse</span><span class="pun">(</span><span class="pln">GCUtil</span><span class="pun">.</span><span class="pln">defaultForceGarbageCollection</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">minForcegcInterval</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">GCUtil</span><span class="pun">.</span><span class="pln">defaultMinForcegcInterval</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">defaultTestTasks</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">Scoped</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">tags</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Test</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="dec">1</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">logBuffered</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="kwd">true</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="com">// TODO: This should be on the new default settings for a project.</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">projectCore</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">name</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">thisProject</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="">
    </span><span class="pln">logManager</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">LogManager</span><span class="pun">.</span><span class="pln">defaults</span><span class="pun">(</span><span class="pln">extraLoggers</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">StandardMain</span><span class="pun">.</span><span class="pln">console</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">onLoadMessage</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">onLoadMessage</span><span class=""> </span><span class="pln">or</span><span class=""> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">thisProjectRef</span><span class="pun">)</span><span class="pun">(</span><span class="str">&#34;Set current project to &#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34; (in build &#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="kwd">_</span><span class="pun">.</span><span class="pln">build</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;)&#34;</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">paths</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">baseDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">thisProject</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">base</span><span class="pun">,</span><span class="">
    </span><span class="pln">target</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">baseDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;target&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">historyPath</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">historyPath</span><span class=""> </span><span class="pln">or</span><span class=""> </span><span class="pln">target</span><span class="pun">(</span><span class="pln">t</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">t</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;.history&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">sourceDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">baseDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;src&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">sourceManaged</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">crossTarget</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;src_managed&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">resourceManaged</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">crossTarget</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;resource_managed&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">crossTarget</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">CacheDirectoryName</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">thisProject</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">id</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;global&#34;</span><span class="">
  </span><span class="pun">)</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">configPaths</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sourceConfigPaths</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">resourceConfigPaths</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">outputConfigPaths</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">sourceConfigPaths</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">sourceDirectory</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">configSrcSub</span><span class="pun">(</span><span class="pln">sourceDirectory</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">sourceManaged</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">configSrcSub</span><span class="pun">(</span><span class="pln">sourceManaged</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">scalaSource</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">sourceDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;scala&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">javaSource</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">sourceDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;java&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">unmanagedSourceDirectories</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">makeCrossSources</span><span class="pun">(</span><span class="pln">scalaSource</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">javaSource</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBinaryVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">crossPaths</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">unmanagedSources</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">collectFiles</span><span class="pun">(</span><span class="pln">unmanagedSourceDirectories</span><span class="pun">,</span><span class=""> </span><span class="pln">includeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedSources</span><span class="pun">,</span><span class=""> </span><span class="pln">excludeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedSources</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">watchSources</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">ConfigGlobal</span><span class=""> </span><span class="pun">&lt;++=</span><span class=""> </span><span class="pln">unmanagedSources</span><span class="pun">,</span><span class="">
    </span><span class="pln">managedSourceDirectories</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">sourceManaged</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">managedSources</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">generate</span><span class="pun">(</span><span class="pln">sourceGenerators</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">sourceGenerators</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">sourceDirectories</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">concatSettings</span><span class="pun">(</span><span class="pln">unmanagedSourceDirectories</span><span class="pun">,</span><span class=""> </span><span class="pln">managedSourceDirectories</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">sources</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">concat</span><span class="pun">(</span><span class="pln">unmanagedSources</span><span class="pun">,</span><span class=""> </span><span class="pln">managedSources</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">resourceConfigPaths</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">resourceDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">sourceDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;resources&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">resourceManaged</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">configSrcSub</span><span class="pun">(</span><span class="pln">resourceManaged</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">unmanagedResourceDirectories</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">resourceDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">managedResourceDirectories</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">resourceManaged</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">resourceDirectories</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">concatSettings</span><span class="pun">(</span><span class="pln">unmanagedResourceDirectories</span><span class="pun">,</span><span class=""> </span><span class="pln">managedResourceDirectories</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">unmanagedResources</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">collectFiles</span><span class="pun">(</span><span class="pln">unmanagedResourceDirectories</span><span class="pun">,</span><span class=""> </span><span class="pln">includeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedResources</span><span class="pun">,</span><span class=""> </span><span class="pln">excludeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedResources</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">watchSources</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">ConfigGlobal</span><span class=""> </span><span class="pun">++=</span><span class=""> </span><span class="pln">unmanagedResources</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
    </span><span class="pln">resourceGenerators</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">resourceGenerators</span><span class=""> </span><span class="pun">&lt;+=</span><span class=""> </span><span class="pun">(</span><span class="pln">discoveredSbtPlugins</span><span class="pun">,</span><span class=""> </span><span class="pln">resourceManaged</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">PluginDiscovery</span><span class="pun">.</span><span class="pln">writeDescriptors</span><span class="pun">,</span><span class="">
    </span><span class="pln">managedResources</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">generate</span><span class="pun">(</span><span class="pln">resourceGenerators</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">resources</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">concat</span><span class="pun">(</span><span class="pln">managedResources</span><span class="pun">,</span><span class=""> </span><span class="pln">unmanagedResources</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">outputConfigPaths</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">crossTarget</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">CacheDirectoryName</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">thisProject</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">id</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="">
    </span><span class="pln">classDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">crossTarget</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pun">(</span><span class="pln">prefix</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;classes&#34;</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">target</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">doc</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">crossTarget</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pun">(</span><span class="pln">prefix</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;api&#34;</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addBaseSources</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">unmanagedSources</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">srcs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">unmanagedSources</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">f</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">includeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedSources</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">excl</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">excludeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedSources</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">sourcesInBase</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">(</span><span class="pln">srcs</span><span class=""> </span><span class="pun">+++</span><span class=""> </span><span class="pln">baseDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">*</span><span class=""> </span><span class="pun">(</span><span class="pln">f</span><span class=""> </span><span class="pun">--</span><span class=""> </span><span class="pln">excl</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">get</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">srcs</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compileBase</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">console</span><span class="pun">)</span><span class="pun">(</span><span class="pln">compilersSetting</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">compileBaseGlobal</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">incOptions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">incOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">withNewClassfileManager</span><span class="pun">(</span><span class="">
      </span><span class="pln">ClassfileManager</span><span class="pun">.</span><span class="pln">transactional</span><span class="pun">(</span><span class="pln">crossTarget</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;classes.bak&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">sbt</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">Logger</span><span class="pun">.</span><span class="pln">Null</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">scalaInstance</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">scalaInstanceTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">crossVersion</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">(</span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">crossPaths</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">CrossVersion</span><span class="pun">.</span><span class="pln">binary</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">CrossVersion</span><span class="pun">.</span><span class="pln">Disabled</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">crossTarget</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">makeCrossTarget</span><span class="pun">(</span><span class="pln">target</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBinaryVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtBinaryVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtPlugin</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">crossPaths</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">clean</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">clean</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">cleanCachedResolutionCache</span><span class="pun">(</span><span class="pln">ivyModule</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">scalaCompilerBridgeSource</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">defaultCompilerBridgeSource</span><span class="pun">(</span><span class="pln">scalaVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="com">// must be a val: duplication detected by object identity</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">compileBaseGlobal</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">incOptions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">IncOptions</span><span class="pun">.</span><span class="pln">Default</span><span class="pun">,</span><span class="">
    </span><span class="pln">classpathOptions</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">ClasspathOptions</span><span class="pun">.</span><span class="pln">boot</span><span class="pun">,</span><span class="">
    </span><span class="pln">classpathOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">console</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">ClasspathOptions</span><span class="pun">.</span><span class="pln">repl</span><span class="pun">,</span><span class="">
    </span><span class="pln">compileOrder</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">CompileOrder</span><span class="pun">.</span><span class="pln">Mixed</span><span class="pun">,</span><span class="">
    </span><span class="pln">javacOptions</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">scalacOptions</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">scalaVersion</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">version</span><span class="pun">,</span><span class="">
    </span><span class="pln">derive</span><span class="pun">(</span><span class="pln">crossScalaVersions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">scalaVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">derive</span><span class="pun">(</span><span class="pln">compilersSetting</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">derive</span><span class="pun">(</span><span class="pln">scalaBinaryVersion</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">binaryScalaVersion</span><span class="pun">(</span><span class="pln">scalaVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">makeCrossSources</span><span class="pun">(</span><span class="pln">scalaSrcDir</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">javaSrcDir</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">sv</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">cross</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">cross</span><span class="pun">)</span><span class="">
      </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">scalaSrcDir</span><span class="pun">.</span><span class="pln">getParentFile</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">s&#34;</span><span class="str">${</span><span class="pln">scalaSrcDir</span><span class="pun">.</span><span class="pln">name</span><span class="str">}</span><span class="str">-</span><span class="str">$sv</span><span class="str">&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaSrcDir</span><span class="pun">,</span><span class=""> </span><span class="pln">javaSrcDir</span><span class="pun">)</span><span class="">
    </span><span class="kwd">else</span><span class="">
      </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">scalaSrcDir</span><span class="pun">,</span><span class=""> </span><span class="pln">javaSrcDir</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">makeCrossTarget</span><span class="pun">(</span><span class="pln">t</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">sv</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtv</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">plugin</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">cross</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">scalaBase</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">cross</span><span class="pun">)</span><span class=""> </span><span class="pln">t</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pun">(</span><span class="str">&#34;scala-&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">sv</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">t</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">plugin</span><span class="pun">)</span><span class=""> </span><span class="pln">scalaBase</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pun">(</span><span class="str">&#34;sbt-&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">sbtv</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">scalaBase</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compilersSetting</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">compilers</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">compilers</span><span class="pun">(</span><span class="pln">scalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">classpathOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaCompilerBridgeSource</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">(</span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">configTasks</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">docTaskSettings</span><span class="pun">(</span><span class="pln">doc</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">compile</span><span class="pun">)</span><span class="pun">(</span><span class="pln">compileInputsSettings</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">configGlobal</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">compileAnalysisSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">compile</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">compileTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">manipulateBytecode</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">compileIncremental</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
    </span><span class="pln">compileIncremental</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">compileIncrementalTask</span><span class=""> </span><span class="pln">tag</span><span class=""> </span><span class="pun">(</span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Compile</span><span class="pun">,</span><span class=""> </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">CPU</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">printWarnings</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">printWarningsTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">compileAnalysisFilename</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="com">// Here, if the user wants cross-scala-versioning, we also append it</span><span class="">
      </span><span class="com">// to the analysis cache, so we keep the scala versions separated.</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">extra</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">crossPaths</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="str">s&#34;</span><span class="str">_</span><span class="str">${</span><span class="pln">scalaBinaryVersion</span><span class="pun">.</span><span class="pln">value</span><span class="str">}</span><span class="str">&#34;</span><span class="">
        </span><span class="kwd">else</span><span class=""> </span><span class="str">&#34;&#34;</span><span class="">
      </span><span class="str">s&#34;</span><span class="str">inc_compile</span><span class="str">${</span><span class="pln">extra</span><span class="str">}</span><span class="str">&#34;</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">compileIncSetup</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">compileIncSetupTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">console</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">consoleTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">consoleQuick</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">consoleQuickTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">discoveredMainClasses</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">compile</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">discoverMainClasses</span><span class=""> </span><span class="pln">storeAs</span><span class=""> </span><span class="pln">discoveredMainClasses</span><span class=""> </span><span class="pln">xtriggeredBy</span><span class=""> </span><span class="pln">compile</span><span class="pun">,</span><span class="">
    </span><span class="pln">definedSbtPlugins</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">discoverPlugins</span><span class="pun">,</span><span class="">
    </span><span class="pln">discoveredSbtPlugins</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">discoverSbtPluginNames</span><span class="pun">,</span><span class="">
    </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">run</span><span class="pun">)</span><span class="pun">(</span><span class="pln">runnerTask</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="pun">.</span><span class="pln">head</span><span class="pun">,</span><span class="">
    </span><span class="pln">selectMainClass</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">mainClass</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">orElse</span><span class=""> </span><span class="pln">askForMainClass</span><span class="pun">(</span><span class="pln">discoveredMainClasses</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">mainClass</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">(</span><span class="pln">selectMainClass</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
    </span><span class="pln">mainClass</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">pickMainClassOrWarn</span><span class="pun">(</span><span class="pln">discoveredMainClasses</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">run</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">runTask</span><span class="pun">(</span><span class="pln">fullClasspath</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClass</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class="pun">,</span><span class=""> </span><span class="pln">runner</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">runMain</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">runMainTask</span><span class="pun">(</span><span class="pln">fullClasspath</span><span class="pun">,</span><span class=""> </span><span class="pln">runner</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">copyResources</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">copyResourcesTask</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">configGlobal</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">initialCommands</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="str">&#34;&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">cleanupCommands</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="str">&#34;&#34;</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">projectTasks</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">cleanFiles</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">managedDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">target</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">cleanKeepFiles</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">historyPath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">,</span><span class="">
    </span><span class="pln">clean</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">doClean</span><span class="pun">(</span><span class="pln">cleanFiles</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">cleanKeepFiles</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">consoleProject</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">consoleProjectTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">watchTransitiveSources</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">watchTransitiveSourcesTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">watch</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">watchSetting</span><span class="">
  </span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">generate</span><span class="pun">(</span><span class="pln">generators</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">generators</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">_</span><span class="pun">.</span><span class="pln">join</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">flatten</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use the new &lt;key&gt;.all(&lt;ScopeFilter&gt;) API&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">inAllConfigurations</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">thisProjectRef</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">ref</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">structure</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Project</span><span class=""> </span><span class="pln">structure</span><span class=""> </span><span class="pln">state</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">configurations</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Project</span><span class="pun">.</span><span class="pln">getProject</span><span class="pun">(</span><span class="pln">ref</span><span class="pun">,</span><span class=""> </span><span class="pln">structure</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">configurations</span><span class="pun">)</span><span class="">
    </span><span class="pln">configurations</span><span class="pun">.</span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">conf</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">key</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pun">(</span><span class="pln">ref</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">)</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">structure</span><span class="pun">.</span><span class="pln">data</span><span class="">
    </span><span class="pun">}</span><span class=""> </span><span class="pln">join</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">watchTransitiveSourcesTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">import</span><span class=""> </span><span class="pln">ScopeFilter.Make.</span><span class="pun">{</span><span class=""> </span><span class="pln">inDependencies</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">inDeps</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">selectDeps</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ScopeFilter</span><span class="pun">(</span><span class="pln">inAggregates</span><span class="pun">(</span><span class="pln">ThisProject</span><span class="pun">)</span><span class=""> </span><span class="pun">||</span><span class=""> </span><span class="pln">inDeps</span><span class="pun">(</span><span class="pln">ThisProject</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">allWatched</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">watchSources</span><span class=""> </span><span class="pun">??</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="pun">.</span><span class="pln">all</span><span class="pun">(</span><span class="pln">selectDeps</span><span class="pun">)</span><span class="">
    </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">allWatched</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">flatten</span><span class=""> </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">transitiveUpdateTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">UpdateReport</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">import</span><span class=""> </span><span class="pln">ScopeFilter.Make.</span><span class="pun">{</span><span class=""> </span><span class="pln">inDependencies</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">inDeps</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">selectDeps</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ScopeFilter</span><span class="pun">(</span><span class="pln">inDeps</span><span class="pun">(</span><span class="pln">ThisProject</span><span class="pun">,</span><span class=""> </span><span class="pln">includeRoot</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">allUpdates</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">update</span><span class="pun">.</span><span class="pun">?</span><span class="pun">.</span><span class="pln">all</span><span class="pun">(</span><span class="pln">selectDeps</span><span class="pun">)</span><span class="">
    </span><span class="com">// If I am a &#34;build&#34; (a project inside project/) then I have a globalPluginUpdate.</span><span class="">
    </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">allUpdates</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">flatten</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">globalPluginUpdate</span><span class="pun">.</span><span class="pun">?</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">watchSetting</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Watched</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">pollInterval</span><span class="pun">,</span><span class=""> </span><span class="pln">thisProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">watchingMessage</span><span class="pun">,</span><span class=""> </span><span class="pln">triggeredMessage</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">interval</span><span class="pun">,</span><span class=""> </span><span class="pln">base</span><span class="pun">,</span><span class=""> </span><span class="pln">msg</span><span class="pun">,</span><span class=""> </span><span class="pln">trigMsg</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
    </span><span class="kwd">new</span><span class=""> </span><span class="pln">Watched</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">scoped</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">watchTransitiveSources</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">base</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">key</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ScopedKey</span><span class="pun">(</span><span class="pln">scoped</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">,</span><span class=""> </span><span class="pln">scoped</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class="">
      </span><span class="kwd">override</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">pollInterval</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">interval</span><span class="">
      </span><span class="kwd">override</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">watchingMessage</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">WatchState</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">msg</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="">
      </span><span class="kwd">override</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">triggeredMessage</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">WatchState</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">trigMsg</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="">
      </span><span class="kwd">override</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">watchPaths</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">EvaluateTask</span><span class="pun">.</span><span class="pln">evaluateTask</span><span class="pun">(</span><span class="pln">Project</span><span class=""> </span><span class="pln">structure</span><span class=""> </span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">base</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">Value</span><span class="pun">(</span><span class="pln">ps</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">ps</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">Inc</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pun">)</span><span class="">    </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">throw</span><span class=""> </span><span class="pln">i</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">None</span><span class="">            </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">&#34;key not found: &#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">displayFull</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use scalaInstanceTask.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">scalaInstanceSetting</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">scalaInstanceTask</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">scalaInstanceTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ScalaInstance</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">taskDyn</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="com">// if this logic changes, ensure that `unmanagedScalaInstanceOnly` and `update` are changed</span><span class="">
    </span><span class="com">//  appropriately to avoid cycles</span><span class="">
    </span><span class="pln">scalaHome</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">h</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">scalaInstanceFromHome</span><span class="pun">(</span><span class="pln">h</span><span class="pun">)</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">None</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">scalaProvider</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">version</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">scalaVersion</span><span class="pun">.</span><span class="pln">value</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">version</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">version</span><span class="pun">)</span><span class=""> </span><span class="com">// use the same class loader as the Scala classes used by sbt</span><span class="">
          </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class="pun">(</span><span class="pln">ScalaInstance</span><span class="pun">(</span><span class="pln">version</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaProvider</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="kwd">else</span><span class="">
          </span><span class="pln">scalaInstanceFromUpdate</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="com">// Returns the ScalaInstance only if it was not constructed via `update`</span><span class="">
  </span><span class="com">//  This is necessary to prevent cycles between `update` and `scalaInstance`</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">unmanagedScalaInstanceOnly</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Option</span><span class="pun">[</span><span class="typ">ScalaInstance</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">taskDyn</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">scalaHome</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">isDefined</span><span class="pun">)</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class="pun">(</span><span class="pln">Some</span><span class="pun">(</span><span class="pln">scalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class="pun">(</span><span class="pln">None</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">noToolConfiguration</span><span class="pun">(</span><span class="pln">autoInstance</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">pre</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="str">&#34;Missing Scala tool configuration from the &#39;update&#39; report.  &#34;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">post</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">autoInstance</span><span class="pun">)</span><span class="">
          </span><span class="str">&#34;&#39;scala-tool&#39; is normally added automatically, so this may indicate a bug in sbt or you may be removing it from ivyConfigurations, for example.&#34;</span><span class="">
        </span><span class="kwd">else</span><span class="">
          </span><span class="str">&#34;Explicitly define scalaInstance or scalaHome or include Scala dependencies in the &#39;scala-tool&#39; configuration.&#34;</span><span class="">
      </span><span class="pln">pre</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">post</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">scalaInstanceFromUpdate</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ScalaInstance</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">toolReport</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">update</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">configuration</span><span class="pun">(</span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">ScalaTool</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="pln">getOrElse</span><span class="">
      </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="pln">noToolConfiguration</span><span class="pun">(</span><span class="pln">managedScalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="kwd">def</span><span class=""> </span><span class="pln">files</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="kwd">=</span><span class="">
      </span><span class="kwd">for</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="pln">m</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">toolReport</span><span class="pun">.</span><span class="pln">modules</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">m</span><span class="pun">.</span><span class="pln">module</span><span class="pun">.</span><span class="pln">name</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">id</span><span class="pun">;</span><span class="">
        </span><span class="pun">(</span><span class="pln">art</span><span class="pun">,</span><span class=""> </span><span class="pln">file</span><span class="pun">)</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">m</span><span class="pun">.</span><span class="pln">artifacts</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">art</span><span class="pun">.</span><span class="pln">`type`</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">Artifact</span><span class="pun">.</span><span class="pln">DefaultType</span><span class="">
      </span><span class="pun">}</span><span class=""> </span><span class="kwd">yield</span><span class=""> </span><span class="pln">file</span><span class="">
    </span><span class="kwd">def</span><span class=""> </span><span class="pln">file</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">files</span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pun">.</span><span class="pln">headOption</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">s&#34;</span><span class="str">Missing </span><span class="str">${</span><span class="pln">id</span><span class="str">}</span><span class="str">.jar</span><span class="str">&#34;</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">allFiles</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">toolReport</span><span class="pun">.</span><span class="pln">modules</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">artifacts</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">_2</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">libraryJar</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">file</span><span class="pun">(</span><span class="pln">ScalaArtifacts</span><span class="pun">.</span><span class="pln">LibraryID</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">compilerJar</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">file</span><span class="pun">(</span><span class="pln">ScalaArtifacts</span><span class="pun">.</span><span class="pln">CompilerID</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">otherJars</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">allFiles</span><span class="pun">.</span><span class="pln">filterNot</span><span class="pun">(</span><span class="pln">x</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">x</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">libraryJar</span><span class=""> </span><span class="pun">||</span><span class=""> </span><span class="pln">x</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">compilerJar</span><span class="pun">)</span><span class="">
    </span><span class="kwd">new</span><span class=""> </span><span class="pln">ScalaInstance</span><span class="pun">(</span><span class="pln">scalaVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">makeClassLoader</span><span class="pun">(</span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">(</span><span class="pln">libraryJar</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">compilerJar</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">otherJars</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">libraryJar</span><span class="pun">,</span><span class=""> </span><span class="pln">compilerJar</span><span class="pun">,</span><span class=""> </span><span class="pln">otherJars</span><span class="pun">.</span><span class="pln">toArray</span><span class="pun">,</span><span class=""> </span><span class="pln">None</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">scalaInstanceFromHome</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ScalaInstance</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="pln">ScalaInstance</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">)</span><span class="pun">(</span><span class="pln">makeClassLoader</span><span class="pun">(</span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">makeClassLoader</span><span class="pun">(</span><span class="pln">state</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">state</span><span class="pun">.</span><span class="pln">classLoaderCache</span><span class="pun">.</span><span class="pln">apply</span><span class=""> </span><span class="kwd">_</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">testDefaults</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Defaults</span><span class="pun">.</span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">testFrameworks</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">sbt.TestFrameworks._</span><span class="">
      </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">ScalaCheck</span><span class="pun">,</span><span class=""> </span><span class="pln">Specs2</span><span class="pun">,</span><span class=""> </span><span class="pln">Specs</span><span class="pun">,</span><span class=""> </span><span class="pln">ScalaTest</span><span class="pun">,</span><span class=""> </span><span class="pln">JUnit</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">testListeners</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">testOptions</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">testResultLogger</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">TestResultLogger</span><span class="pun">.</span><span class="pln">Default</span><span class="pun">,</span><span class="">
    </span><span class="pln">testFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">testOnly</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pun">(</span><span class="pln">selectedFilter</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">testTasks</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">testTaskOptions</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">testTaskOptions</span><span class="pun">(</span><span class="pln">testOnly</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">testTaskOptions</span><span class="pun">(</span><span class="pln">testQuick</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">testDefaults</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">testLoader</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">TestFramework</span><span class="pun">.</span><span class="pln">createTestLoader</span><span class="pun">(</span><span class="pln">data</span><span class="pun">(</span><span class="pln">fullClasspath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">createUniqueDirectory</span><span class="pun">(</span><span class="pln">taskTemporaryDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">loadedTestFrameworks</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">testFrameworks</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="pln">f</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">f</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">testLoader</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">x</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="pln">x</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toIterable</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toMap</span><span class="pun">,</span><span class="">
    </span><span class="pln">definedTests</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">detectTests</span><span class="pun">,</span><span class="">
    </span><span class="pln">definedTestNames</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">definedTests</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pun">.</span><span class="pln">distinct</span><span class="pun">)</span><span class=""> </span><span class="pln">storeAs</span><span class=""> </span><span class="pln">definedTestNames</span><span class=""> </span><span class="pln">triggeredBy</span><span class=""> </span><span class="pln">compile</span><span class="pun">,</span><span class="">
    </span><span class="pln">testFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">testQuick</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">testQuickFilter</span><span class="pun">,</span><span class="">
    </span><span class="pln">executeTests</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pun">(</span><span class="pln">streams</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">test</span><span class="pun">,</span><span class=""> </span><span class="pln">loadedTestFrameworks</span><span class="pun">,</span><span class=""> </span><span class="pln">testLoader</span><span class="pun">,</span><span class=""> </span><span class="pln">testGrouping</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">test</span><span class="pun">,</span><span class=""> </span><span class="pln">testExecution</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">test</span><span class="pun">,</span><span class=""> </span><span class="pln">fullClasspath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">test</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">test</span><span class="pun">,</span><span class=""> </span><span class="pln">testForkedParallel</span><span class="pun">,</span><span class=""> </span><span class="pln">javaOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">test</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pln">allTestGroupsTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">testResultLogger</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pun">(</span><span class="pln">Test</span><span class="pun">,</span><span class=""> </span><span class="pln">test</span><span class="pun">)</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">TestResultLogger</span><span class="pun">.</span><span class="pln">SilentWhenNoTests</span><span class="pun">,</span><span class=""> </span><span class="com">// https://github.com/sbt/sbt/issues/1185</span><span class="">
    </span><span class="pln">test</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">trl</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">testResultLogger</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pun">(</span><span class="pln">Test</span><span class="pun">,</span><span class=""> </span><span class="pln">test</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">taskName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Project</span><span class="pun">.</span><span class="pln">showContextKey</span><span class="pun">(</span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">(</span><span class="pln">resolvedScoped</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
      </span><span class="pln">trl</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">,</span><span class=""> </span><span class="pln">executeTests</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">taskName</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">testOnly</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">inputTests</span><span class="pun">(</span><span class="pln">testOnly</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">testQuick</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">inputTests</span><span class="pun">(</span><span class="pln">testQuick</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">TaskGlobal</span><span class="pun">:</span><span class=""> </span><span class="pln">Scope</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ThisScope</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">task</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Global</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">ConfigGlobal</span><span class="pun">:</span><span class=""> </span><span class="pln">Scope</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ThisScope</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">config</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Global</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">testTaskOptions</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">Scoped</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">testListeners</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="pln">TestLogger</span><span class="pun">.</span><span class="pln">make</span><span class="pun">(</span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">,</span><span class=""> </span><span class="pln">closeableTestLogger</span><span class="pun">(</span><span class="pln">streamsManager</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">test</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">resolvedScoped</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">,</span><span class=""> </span><span class="pln">logBuffered</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class="">
        </span><span class="kwd">new</span><span class=""> </span><span class="pln">TestStatusReporter</span><span class="pun">(</span><span class="pln">succeededFile</span><span class="pun">(</span><span class="pln">streams</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class="">
        </span><span class="pln">testListeners</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">TaskGlobal</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">testOptions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Listeners</span><span class="pun">(</span><span class="pln">testListeners</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pun">(</span><span class="pln">testOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">TaskGlobal</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
    </span><span class="pln">testExecution</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">testExecutionTask</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">inScope</span><span class="pun">(</span><span class="pln">GlobalScope</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">derive</span><span class="pun">(</span><span class="pln">testGrouping</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">singleTestGroupDefault</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Doesn&#39;t provide for closing the underlying resources.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.1&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">testLogger</span><span class="pun">(</span><span class="pln">manager</span><span class="pun">:</span><span class=""> </span><span class="pln">Streams</span><span class="pun">,</span><span class=""> </span><span class="pln">baseKey</span><span class="pun">:</span><span class=""> </span><span class="pln">Scoped</span><span class="pun">)</span><span class="pun">(</span><span class="pln">tdef</span><span class="pun">:</span><span class=""> </span><span class="pln">TestDefinition</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">scope</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">baseKey</span><span class="pun">.</span><span class="pln">scope</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">extra</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">scope</span><span class="pun">.</span><span class="pln">extra</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pln">Select</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">x</span><span class="pun">;</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">AttributeMap</span><span class="pun">.</span><span class="pln">empty</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">key</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ScopedKey</span><span class="pun">(</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">extra</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Select</span><span class="pun">(</span><span class="pln">testExtra</span><span class="pun">(</span><span class="pln">extra</span><span class="pun">,</span><span class=""> </span><span class="pln">tdef</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">baseKey</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class="">
      </span><span class="pln">manager</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="pun">.</span><span class="pln">log</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">closeableTestLogger</span><span class="pun">(</span><span class="pln">manager</span><span class="pun">:</span><span class=""> </span><span class="pln">Streams</span><span class="pun">,</span><span class=""> </span><span class="pln">baseKey</span><span class="pun">:</span><span class=""> </span><span class="pln">Scoped</span><span class="pun">,</span><span class=""> </span><span class="pln">buffered</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">)</span><span class="pun">(</span><span class="pln">tdef</span><span class="pun">:</span><span class=""> </span><span class="pln">TestDefinition</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">TestLogger</span><span class="pun">.</span><span class="pln">PerTest</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">scope</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">baseKey</span><span class="pun">.</span><span class="pln">scope</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">extra</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">scope</span><span class="pun">.</span><span class="pln">extra</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pln">Select</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">x</span><span class="pun">;</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">AttributeMap</span><span class="pun">.</span><span class="pln">empty</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">key</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ScopedKey</span><span class="pun">(</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">extra</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Select</span><span class="pun">(</span><span class="pln">testExtra</span><span class="pun">(</span><span class="pln">extra</span><span class="pun">,</span><span class=""> </span><span class="pln">tdef</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">baseKey</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">manager</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="">
      </span><span class="kwd">new</span><span class=""> </span><span class="pln">TestLogger</span><span class="pun">.</span><span class="pln">PerTest</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">,</span><span class=""> </span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">close</span><span class="pun">(</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">buffered</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">buffered</span><span class="pun">(</span><span class="pln">log</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">BufferedLogger</span><span class="pun">(</span><span class="pln">FullLogger</span><span class="pun">(</span><span class="pln">log</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">testExtra</span><span class="pun">(</span><span class="pln">extra</span><span class="pun">:</span><span class=""> </span><span class="pln">AttributeMap</span><span class="pun">,</span><span class=""> </span><span class="pln">tdef</span><span class="pun">:</span><span class=""> </span><span class="pln">TestDefinition</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">AttributeMap</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">mod</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">tdef</span><span class="pun">.</span><span class="pln">fingerprint</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">SubclassFingerprint</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">f</span><span class="pun">.</span><span class="pln">isModule</span><span class="pun">;</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">AnnotatedFingerprint</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">f</span><span class="pun">.</span><span class="pln">isModule</span><span class="pun">;</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">false</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="pln">extra</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">name</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">tdef</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">isModule</span><span class="pun">,</span><span class=""> </span><span class="pln">mod</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">singleTestGroup</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">Scoped</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Group</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">singleTestGroupDefault</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">singleTestGroupDefault</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Group</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">tests</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">definedTests</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">fk</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">fork</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">opts</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">forkOptions</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="pln">Seq</span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Group</span><span class="pun">(</span><span class="str">&#34;&lt;default&gt;&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">tests</span><span class="pun">,</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">fk</span><span class="pun">)</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">SubProcess</span><span class="pun">(</span><span class="pln">opts</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">InProcess</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">forkOptions</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ForkOptions</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">baseDirectory</span><span class="pun">,</span><span class=""> </span><span class="pln">javaOptions</span><span class="pun">,</span><span class=""> </span><span class="pln">outputStrategy</span><span class="pun">,</span><span class=""> </span><span class="pln">envVars</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class="pun">,</span><span class=""> </span><span class="pln">connectInput</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="pun">(</span><span class="pln">base</span><span class="pun">,</span><span class=""> </span><span class="pln">options</span><span class="pun">,</span><span class=""> </span><span class="pln">strategy</span><span class="pun">,</span><span class=""> </span><span class="pln">env</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHomeDir</span><span class="pun">,</span><span class=""> </span><span class="pln">connectIn</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="com">// bootJars is empty by default because only jars on the user&#39;s classpath should be on the boot classpath</span><span class="">
        </span><span class="pln">ForkOptions</span><span class="pun">(</span><span class="pln">bootJars</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">javaHomeDir</span><span class="pun">,</span><span class=""> </span><span class="pln">connectInput</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">connectIn</span><span class="pun">,</span><span class=""> </span><span class="pln">outputStrategy</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">strategy</span><span class="pun">,</span><span class=""> </span><span class="pln">runJVMOptions</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">options</span><span class="pun">,</span><span class=""> </span><span class="pln">workingDirectory</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">base</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">envVars</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">env</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">testExecutionTask</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">Scoped</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Execution</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">testOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">parallelExecution</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">tags</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="pun">(</span><span class="pln">opts</span><span class="pun">,</span><span class=""> </span><span class="pln">par</span><span class="pun">,</span><span class=""> </span><span class="pln">ts</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">new</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Execution</span><span class="pun">(</span><span class="pln">opts</span><span class="pun">,</span><span class=""> </span><span class="pln">par</span><span class="pun">,</span><span class=""> </span><span class="pln">ts</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">testQuickFilter</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">String</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Boolean</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">fullClasspath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">test</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">test</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="pun">(</span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">ans</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cp</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">metadata</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">Keys</span><span class="pun">.</span><span class="pln">analysis</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">succeeded</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">TestStatus</span><span class="pun">.</span><span class="pln">read</span><span class="pun">(</span><span class="pln">succeededFile</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">stamps</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">collection</span><span class="pun">.</span><span class="pln">mutable</span><span class="pun">.</span><span class="pln">Map</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">[</span><span class="typ">File</span><span class="">, </span><span class="typ">Long</span><span class="pun">]</span><span class="">
        </span><span class="kwd">def</span><span class=""> </span><span class="pln">stamp</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Long</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">stamps</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">ans</span><span class="pun">;</span><span class=""> </span><span class="pln">f</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">a</span><span class="pun">.</span><span class="pln">relations</span><span class="pun">.</span><span class="pln">definesClass</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">yield</span><span class=""> </span><span class="pln">intlStamp</span><span class="pun">(</span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">Set</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">)</span><span class="">
          </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">stamps</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">)</span><span class=""> </span><span class="pln">Long</span><span class="pun">.</span><span class="pln">MinValue</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">stamps</span><span class="pun">.</span><span class="pln">max</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">def</span><span class=""> </span><span class="pln">intlStamp</span><span class="pun">(</span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">analysis</span><span class="pun">:</span><span class=""> </span><span class="pln">Analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Set</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Long</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class=""> </span><span class="pln">contains</span><span class=""> </span><span class="pln">f</span><span class="pun">)</span><span class=""> </span><span class="pln">Long</span><span class="pun">.</span><span class="pln">MinValue</span><span class=""> </span><span class="kwd">else</span><span class="">
            </span><span class="pln">stamps</span><span class="pun">.</span><span class="pln">getOrElseUpdate</span><span class="pun">(</span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="pun">{</span><span class="">
              </span><span class="kwd">import</span><span class=""> </span><span class="pln">analysis.</span><span class="pun">{</span><span class=""> </span><span class="pln">relations</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">rel</span><span class="pun">,</span><span class=""> </span><span class="pln">apis</span><span class=""> </span><span class="pun">}</span><span class="">
              </span><span class="pln">rel</span><span class="pun">.</span><span class="pln">internalSrcDeps</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">intlStamp</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">f</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class="">
                </span><span class="pln">rel</span><span class="pun">.</span><span class="pln">externalDeps</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">stamp</span><span class="pun">)</span><span class=""> </span><span class="pun">+</span><span class="">
                </span><span class="pln">apis</span><span class="pun">.</span><span class="pln">internal</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class="pun">.</span><span class="pln">compilation</span><span class="pun">.</span><span class="pln">startTime</span><span class="">
            </span><span class="pun">}</span><span class="pun">.</span><span class="pln">max</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">def</span><span class=""> </span><span class="pln">noSuccessYet</span><span class="pun">(</span><span class="pln">test</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">succeeded</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">None</span><span class="">     </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">true</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">ts</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">stamp</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span><span class=""> </span><span class="pun">&gt;</span><span class=""> </span><span class="pln">ts</span><span class="">
        </span><span class="pun">}</span><span class="">

        </span><span class="pln">args</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">filter</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">selectedFilter</span><span class="pun">(</span><span class="pln">args</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">yield</span><span class=""> </span><span class="pun">(</span><span class="pln">test</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">filter</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">noSuccessYet</span><span class="pun">(</span><span class="pln">test</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">succeededFile</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">dir</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;succeeded_tests&#34;</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">inputTests</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">InputKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">InputTask</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inputTests0</span><span class="pun">.</span><span class="pln">mapReferenced</span><span class="pun">(</span><span class="pln">Def</span><span class="pun">.</span><span class="pln">mapScope</span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">key</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">inputTests0</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">InputTask</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">parser</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">loadForParser</span><span class="pun">(</span><span class="pln">definedTestNames</span><span class="pun">)</span><span class="pun">(</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">testOnlyParser</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">inputTaskDyn</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pun">(</span><span class="pln">selected</span><span class="pun">,</span><span class=""> </span><span class="pln">frameworkOptions</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">parser</span><span class="pun">.</span><span class="pln">parsed</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">filter</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">testFilter</span><span class="pun">.</span><span class="pln">value</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">config</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">testExecution</span><span class="pun">.</span><span class="pln">value</span><span class="">

        </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">display</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Project</span><span class="pun">.</span><span class="pln">showContextKey</span><span class="pun">(</span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">modifiedOpts</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Filters</span><span class="pun">(</span><span class="pln">filter</span><span class="pun">(</span><span class="pln">selected</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Argument</span><span class="pun">(</span><span class="pln">frameworkOptions</span><span class="pun">:</span><span class=""> </span><span class="kwd">_</span><span class="pun">*</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">config</span><span class="pun">.</span><span class="pln">options</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">newConfig</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">config</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">modifiedOpts</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">output</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">allTestGroupsTask</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">loadedTestFrameworks</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">testLoader</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">testGrouping</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">newConfig</span><span class="pun">,</span><span class=""> </span><span class="pln">fullClasspath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">testForkedParallel</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">javaOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">taskName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">display</span><span class="pun">(</span><span class="pln">resolvedScoped</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">trl</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">testResultLogger</span><span class="pun">.</span><span class="pln">value</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">processed</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">output</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">out</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">trl</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">,</span><span class=""> </span><span class="pln">out</span><span class="pun">,</span><span class=""> </span><span class="pln">taskName</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="pln">processed</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">createTestRunners</span><span class="pun">(</span><span class="pln">frameworks</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">TestFramework</span><span class="">, </span><span class="typ">Framework</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">:</span><span class=""> </span><span class="pln">ClassLoader</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Execution</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">TestFramework</span><span class="">, </span><span class="typ">Runner</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">import</span><span class=""> </span><span class="pln">Tests.Argument</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">opts</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">config</span><span class="pun">.</span><span class="pln">options</span><span class="pun">.</span><span class="pln">toList</span><span class="">
    </span><span class="pln">frameworks</span><span class="pun">.</span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">tf</span><span class="pun">,</span><span class=""> </span><span class="pln">f</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">args</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">opts</span><span class="pun">.</span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Argument</span><span class="pun">(</span><span class="pln">None</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">`tf`</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">args</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">args</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="">                                 </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Nil</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">mainRunner</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">f</span><span class="pun">.</span><span class="pln">runner</span><span class="pun">(</span><span class="pln">args</span><span class="pun">.</span><span class="pln">toArray</span><span class="pun">,</span><span class=""> </span><span class="pln">Array</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">)</span><span class="">
        </span><span class="pln">tf</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="pln">mainRunner</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">allTestGroupsTask</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskStreams</span><span class="pun">,</span><span class=""> </span><span class="pln">frameworks</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">TestFramework</span><span class="">, </span><span class="typ">Framework</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">:</span><span class=""> </span><span class="pln">ClassLoader</span><span class="pun">,</span><span class=""> </span><span class="pln">groups</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Group</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Execution</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Output</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="pln">allTestGroupsTask</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">frameworks</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">,</span><span class=""> </span><span class="pln">groups</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class="pun">,</span><span class=""> </span><span class="pln">forkedParallelExecution</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class=""> </span><span class="pln">javaOptions</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">allTestGroupsTask</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskStreams</span><span class="pun">,</span><span class=""> </span><span class="pln">frameworks</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">TestFramework</span><span class="">, </span><span class="typ">Framework</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">:</span><span class=""> </span><span class="pln">ClassLoader</span><span class="pun">,</span><span class=""> </span><span class="pln">groups</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Group</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Execution</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">forkedParallelExecution</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Output</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="pln">allTestGroupsTask</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">frameworks</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">,</span><span class=""> </span><span class="pln">groups</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class="pun">,</span><span class=""> </span><span class="pln">forkedParallelExecution</span><span class="pun">,</span><span class=""> </span><span class="pln">javaOptions</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">allTestGroupsTask</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskStreams</span><span class="pun">,</span><span class=""> </span><span class="pln">frameworks</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">TestFramework</span><span class="">, </span><span class="typ">Framework</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">:</span><span class=""> </span><span class="pln">ClassLoader</span><span class="pun">,</span><span class=""> </span><span class="pln">groups</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Group</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Execution</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class="pun">,</span><span class=""> </span><span class="pln">javaHome</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">forkedParallelExecution</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">javaOptions</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Tests</span><span class="typ">.</span><span class="typ">Output</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">runners</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">createTestRunners</span><span class="pun">(</span><span class="pln">frameworks</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">groupTasks</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">groups</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Group</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">tests</span><span class="pun">,</span><span class=""> </span><span class="pln">runPolicy</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="pln">runPolicy</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">SubProcess</span><span class="pun">(</span><span class="pln">opts</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
            </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="str">s&#34;</span><span class="str">javaOptions: </span><span class="str">${</span><span class="pln">opts</span><span class="pun">.</span><span class="pln">runJVMOptions</span><span class="str">}</span><span class="str">&#34;</span><span class="pun">)</span><span class="">
            </span><span class="kwd">val</span><span class=""> </span><span class="pln">forkedConfig</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">config</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">parallel</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">config</span><span class="pun">.</span><span class="pln">parallel</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">forkedParallelExecution</span><span class="pun">)</span><span class="">
            </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="str">s&#34;</span><span class="str">Forking tests - parallelism = </span><span class="str">${</span><span class="pln">forkedConfig</span><span class="pun">.</span><span class="pln">parallel</span><span class="str">}</span><span class="str">&#34;</span><span class="pun">)</span><span class="">
            </span><span class="pln">ForkTests</span><span class="pun">(</span><span class="pln">runners</span><span class="pun">,</span><span class=""> </span><span class="pln">tests</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">,</span><span class=""> </span><span class="pln">forkedConfig</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">.</span><span class="pln">files</span><span class="pun">,</span><span class=""> </span><span class="pln">opts</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class=""> </span><span class="pln">tag</span><span class=""> </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">ForkedTestGroup</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">InProcess</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
            </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">javaOptions</span><span class="pun">.</span><span class="pln">nonEmpty</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
              </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="str">&#34;javaOptions will be ignored, fork is set to false&#34;</span><span class="pun">)</span><span class="">
            </span><span class="pun">}</span><span class="">
            </span><span class="pln">Tests</span><span class="pun">(</span><span class="pln">frameworks</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">,</span><span class=""> </span><span class="pln">runners</span><span class="pun">,</span><span class=""> </span><span class="pln">tests</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">output</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">foldTasks</span><span class="pun">(</span><span class="pln">groupTasks</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">.</span><span class="pln">parallel</span><span class="pun">)</span><span class="">
    </span><span class="pln">output</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">out</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">summaries</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="pln">runners</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">tf</span><span class="pun">,</span><span class=""> </span><span class="pln">r</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
            </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">Summary</span><span class="pun">(</span><span class="pln">frameworks</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">)</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">r</span><span class="pun">.</span><span class="pln">done</span><span class="pun">(</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="pln">out</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">summaries</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">summaries</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">selectedFilter</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Boolean</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">matches</span><span class="pun">(</span><span class="pln">nfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">NameFilter</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">nfs</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pun">)</span><span class="">

      </span><span class="kwd">val</span><span class=""> </span><span class="pun">(</span><span class="pln">excludeArgs</span><span class="pun">,</span><span class=""> </span><span class="pln">includeArgs</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">args</span><span class="pun">.</span><span class="pln">partition</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="str">&#34;-&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="">

      </span><span class="kwd">val</span><span class=""> </span><span class="pln">includeFilters</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">includeArgs</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">GlobFilter</span><span class="pun">.</span><span class="pln">apply</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">excludeFilters</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">excludeArgs</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">substring</span><span class="pun">(</span><span class="dec">1</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">GlobFilter</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">)</span><span class="">

      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">includeFilters</span><span class="pun">.</span><span class="pln">isEmpty</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">excludeArgs</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">const</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">includeFilters</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="pln">Seq</span><span class="pun">(</span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">!</span><span class="pln">matches</span><span class="pun">(</span><span class="pln">excludeFilters</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="pln">includeFilters</span><span class="pun">.</span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">f</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pun">!</span><span class="pln">matches</span><span class="pun">(</span><span class="pln">excludeFilters</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">detectTests</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">TestDefinition</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">loadedTestFrameworks</span><span class="pun">,</span><span class=""> </span><span class="pln">compile</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">frameworkMap</span><span class="pun">,</span><span class=""> </span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
    </span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">discover</span><span class="pun">(</span><span class="pln">frameworkMap</span><span class="pun">.</span><span class="pln">values</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">,</span><span class=""> </span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">.</span><span class="pln">_1</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">defaultRestrictions</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">Tags</span><span class="typ">.</span><span class="typ">Rule</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">parallelExecution</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">par</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">max</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">EvaluateTask</span><span class="pun">.</span><span class="pln">SystemProcessors</span><span class="">
    </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">limitAll</span><span class="pun">(</span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">par</span><span class="pun">)</span><span class=""> </span><span class="pln">max</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="dec">1</span><span class="pun">)</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">limit</span><span class="pun">(</span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">ForkedTestGroup</span><span class="pun">,</span><span class=""> </span><span class="dec">1</span><span class="pun">)</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">packageBase</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">artifact</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Artifact</span><span class="pun">(</span><span class="pln">moduleName</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Defaults</span><span class="pun">.</span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
      </span><span class="pln">packageOptions</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
      </span><span class="pln">artifactName</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pun">(</span><span class="pln">Artifact</span><span class="pun">.</span><span class="pln">artifactName</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class="">
    </span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">packageConfig</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">packageBin</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
      </span><span class="pln">packageOptions</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">version</span><span class="pun">,</span><span class=""> </span><span class="pln">homepage</span><span class="pun">,</span><span class=""> </span><span class="pln">organization</span><span class="pun">,</span><span class=""> </span><span class="pln">organizationName</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClass</span><span class="pun">,</span><span class=""> </span><span class="pln">packageOptions</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">ver</span><span class="pun">,</span><span class=""> </span><span class="pln">h</span><span class="pun">,</span><span class=""> </span><span class="pln">org</span><span class="pun">,</span><span class=""> </span><span class="pln">orgName</span><span class="pun">,</span><span class=""> </span><span class="pln">main</span><span class="pun">,</span><span class=""> </span><span class="pln">p</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Package</span><span class="pun">.</span><span class="pln">addSpecManifestAttributes</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">ver</span><span class="pun">,</span><span class=""> </span><span class="pln">orgName</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">Package</span><span class="pun">.</span><span class="pln">addImplManifestAttributes</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">ver</span><span class="pun">,</span><span class=""> </span><span class="pln">h</span><span class="pun">,</span><span class=""> </span><span class="pln">org</span><span class="pun">,</span><span class=""> </span><span class="pln">orgName</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">main</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">Package</span><span class="pun">.</span><span class="pln">MainClass</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">)</span><span class=""> </span><span class="pun">++:</span><span class=""> </span><span class="pln">p</span><span class=""> </span><span class="pun">}</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class="">
      </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">packageSrc</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
        </span><span class="pln">packageOptions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Package</span><span class="pun">.</span><span class="pln">addSpecManifestAttributes</span><span class="pun">(</span><span class="pln">name</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">version</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">organizationName</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">packageOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class="">
      </span><span class="pln">packageTaskSettings</span><span class="pun">(</span><span class="pln">packageBin</span><span class="pun">,</span><span class=""> </span><span class="pln">packageBinMappings</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class="">
      </span><span class="pln">packageTaskSettings</span><span class="pun">(</span><span class="pln">packageSrc</span><span class="pun">,</span><span class=""> </span><span class="pln">packageSrcMappings</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class="">
      </span><span class="pln">packageTaskSettings</span><span class="pun">(</span><span class="pln">packageDoc</span><span class="pun">,</span><span class=""> </span><span class="pln">packageDocMappings</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class="">
      </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">`package`</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">packageBin</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageBinMappings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">products</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pln">Path</span><span class="pun">.</span><span class="pln">allSubpaths</span><span class=""> </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageDocMappings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">doc</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">Path</span><span class="pun">.</span><span class="pln">allSubpaths</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toSeq</span><span class=""> </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageSrcMappings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">concatMappings</span><span class="pun">(</span><span class="pln">resourceMappings</span><span class="pun">,</span><span class=""> </span><span class="pln">sourceMappings</span><span class="pun">)</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use `packageBinMappings` instead&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.12.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageBinTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">packageBinMappings</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use `packageDocMappings` instead&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.12.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageDocTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">packageDocMappings</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use `packageSrcMappings` instead&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.12.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageSrcTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">packageSrcMappings</span><span class="">

  </span><span class="kwd">private</span><span class=""> </span><span class="kwd">type</span><span class=""> </span><span class="typ">Mappings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="pun">(</span><span class="typ">File</span><span class="">, </span><span class="typ">String</span><span class="pun">)</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">concatMappings</span><span class="pun">(</span><span class="pln">as</span><span class="pun">:</span><span class=""> </span><span class="pln">Mappings</span><span class="pun">,</span><span class=""> </span><span class="pln">bs</span><span class="pun">:</span><span class=""> </span><span class="pln">Mappings</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">as</span><span class=""> </span><span class="pln">zipWith</span><span class=""> </span><span class="pln">bs</span><span class="pun">)</span><span class="pun">(</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">a</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">b</span><span class=""> </span><span class="pun">}</span><span class="pun">)</span><span class="">

  </span><span class="com">// drop base directories, since there are no valid mappings for these</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">sourceMappings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">unmanagedSources</span><span class="pun">,</span><span class=""> </span><span class="pln">unmanagedSourceDirectories</span><span class="pun">,</span><span class=""> </span><span class="pln">baseDirectory</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">srcs</span><span class="pun">,</span><span class=""> </span><span class="pln">sdirs</span><span class="pun">,</span><span class=""> </span><span class="pln">base</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
    </span><span class="pun">(</span><span class="pln">srcs</span><span class=""> </span><span class="pun">---</span><span class=""> </span><span class="pln">sdirs</span><span class=""> </span><span class="pun">---</span><span class=""> </span><span class="pln">base</span><span class="pun">)</span><span class=""> </span><span class="pln">pair</span><span class=""> </span><span class="pun">(</span><span class="pln">relativeTo</span><span class="pun">(</span><span class="pln">sdirs</span><span class="pun">)</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="pln">relativeTo</span><span class="pun">(</span><span class="pln">base</span><span class="pun">)</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="pln">flat</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">resourceMappings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">relativeMappings</span><span class="pun">(</span><span class="pln">unmanagedResources</span><span class="pun">,</span><span class=""> </span><span class="pln">unmanagedResourceDirectories</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">relativeMappings</span><span class="pun">(</span><span class="pln">files</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">dirs</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="pun">(</span><span class="typ">File</span><span class="">, </span><span class="typ">String</span><span class="pun">)</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">files</span><span class="pun">,</span><span class=""> </span><span class="pln">dirs</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">rs</span><span class="pun">,</span><span class=""> </span><span class="pln">rdirs</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pun">(</span><span class="pln">rs</span><span class=""> </span><span class="pun">---</span><span class=""> </span><span class="pln">rdirs</span><span class="pun">)</span><span class=""> </span><span class="pln">pair</span><span class=""> </span><span class="pun">(</span><span class="pln">relativeTo</span><span class="pun">(</span><span class="pln">rdirs</span><span class="pun">)</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="pln">flat</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">collectFiles</span><span class="pun">(</span><span class="pln">dirs</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">filter</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">FileFilter</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">excludes</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">FileFilter</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">dirs</span><span class="pun">,</span><span class=""> </span><span class="pln">filter</span><span class="pun">,</span><span class=""> </span><span class="pln">excludes</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">,</span><span class=""> </span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="pln">excl</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">d</span><span class="pun">.</span><span class="pln">descendantsExcept</span><span class="pun">(</span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="pln">excl</span><span class="pun">)</span><span class="pun">.</span><span class="pln">get</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">artifactPathSetting</span><span class="pun">(</span><span class="pln">art</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">Artifact</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">crossTarget</span><span class="pun">,</span><span class=""> </span><span class="pln">projectID</span><span class="pun">,</span><span class=""> </span><span class="pln">art</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">artifactName</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBinaryVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">artifactName</span><span class="pun">,</span><span class=""> </span><span class="pln">artifactName</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="pun">(</span><span class="pln">t</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">sv</span><span class="pun">,</span><span class=""> </span><span class="pln">sbv</span><span class="pun">,</span><span class=""> </span><span class="pln">toString</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">t</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">toString</span><span class="pun">(</span><span class="pln">ScalaVersion</span><span class="pun">(</span><span class="pln">sv</span><span class="pun">,</span><span class=""> </span><span class="pln">sbv</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">a</span><span class="pun">)</span><span class=""> </span><span class="pln">asFile</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">artifactSetting</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pun">(</span><span class="pln">artifact</span><span class="pun">,</span><span class=""> </span><span class="pln">artifactClassifier</span><span class="pun">)</span><span class="pun">.</span><span class="pln">identity</span><span class=""> </span><span class="pln">zipWith</span><span class=""> </span><span class="pln">configuration</span><span class="pun">.</span><span class="pun">?</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">classifier</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">cOpt</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">cPart</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cOpt</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">Compile</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">None</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">Test</span><span class="">    </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">Artifact</span><span class="pun">.</span><span class="pln">TestsClassifier</span><span class="pun">)</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">c</span><span class="">       </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">c</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">combined</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cPart</span><span class="pun">.</span><span class="pln">toList</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">classifier</span><span class="pun">.</span><span class="pln">toList</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">combined</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">)</span><span class=""> </span><span class="pln">a</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">classifier</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class=""> </span><span class="pln">configurations</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cOpt</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">classifierString</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">combined</span><span class=""> </span><span class="pln">mkString</span><span class=""> </span><span class="str">&#34;-&#34;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">confs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cOpt</span><span class="pun">.</span><span class="pln">toList</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">c</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">artifactConfigurations</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">c</span><span class="pun">,</span><span class=""> </span><span class="pln">classifier</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
        </span><span class="pln">a</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">classifier</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">classifierString</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">`type`</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Artifact</span><span class="pun">.</span><span class="pln">classifierType</span><span class="pun">(</span><span class="pln">classifierString</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">configurations</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">confs</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">artifactConfigurations</span><span class="pun">(</span><span class="pln">base</span><span class="pun">:</span><span class=""> </span><span class="pln">Artifact</span><span class="pun">,</span><span class=""> </span><span class="pln">scope</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">classifier</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Iterable</span><span class="pun">[</span><span class="typ">Configuration</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">classifier</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Artifact</span><span class="pun">.</span><span class="pln">classifierConf</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">None</span><span class="">    </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">scope</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use `Util.pairID` instead&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.12.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">pairID</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Util</span><span class="pun">.</span><span class="pln">pairID</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use the cacheDirectory val on streams.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">perTaskCache</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">~=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pun">(</span><span class="str">&#34;for_&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">key</span><span class="pun">.</span><span class="pln">key</span><span class="pun">.</span><span class="pln">label</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use `packageTaskSettings` instead&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.12.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageTasks</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">mappingsTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="pun">(</span><span class="typ">File</span><span class="">, </span><span class="typ">String</span><span class="pun">)</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">packageTaskSettings</span><span class="pun">(</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">mappingsTask</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageTaskSettings</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">mappingsTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="pun">(</span><span class="typ">File</span><span class="">, </span><span class="typ">String</span><span class="pun">)</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
      </span><span class="pln">key</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">TaskGlobal</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">packageTask</span><span class="pun">,</span><span class="">
      </span><span class="pln">packageConfiguration</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">packageConfigurationTask</span><span class="pun">,</span><span class="">
      </span><span class="pln">mappings</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">mappingsTask</span><span class="pun">,</span><span class="">
      </span><span class="pln">packagedArtifact</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">(</span><span class="pln">artifact</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="pln">key</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
      </span><span class="pln">artifact</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">artifactSetting</span><span class="pun">,</span><span class="">
      </span><span class="pln">artifactPath</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">artifactPathSetting</span><span class="pun">(</span><span class="pln">artifact</span><span class="pun">)</span><span class="">
    </span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">packageConfiguration</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">Package</span><span class="pun">(</span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
      </span><span class="pln">config</span><span class="pun">.</span><span class="pln">jar</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packageConfigurationTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Package</span><span class="typ">.</span><span class="typ">Configuration</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">mappings</span><span class="pun">,</span><span class=""> </span><span class="pln">artifactPath</span><span class="pun">,</span><span class=""> </span><span class="pln">packageOptions</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">srcs</span><span class="pun">,</span><span class=""> </span><span class="pln">path</span><span class="pun">,</span><span class=""> </span><span class="pln">options</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">new</span><span class=""> </span><span class="pln">Package</span><span class="pun">.</span><span class="pln">Configuration</span><span class="pun">(</span><span class="pln">srcs</span><span class="pun">,</span><span class=""> </span><span class="pln">path</span><span class="pun">,</span><span class=""> </span><span class="pln">options</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;use Defaults.askForMainClass&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.7&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">selectRunMain</span><span class="pun">(</span><span class="pln">classes</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">askForMainClass</span><span class="pun">(</span><span class="pln">classes</span><span class="pun">)</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;use Defaults.pickMainClass&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.7&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">selectPackageMain</span><span class="pun">(</span><span class="pln">classes</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">pickMainClass</span><span class="pun">(</span><span class="pln">classes</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">askForMainClass</span><span class="pun">(</span><span class="pln">classes</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">sbt</span><span class="pun">.</span><span class="pln">SelectMainClass</span><span class="pun">(</span><span class="pln">Some</span><span class="pun">(</span><span class="pln">SimpleReader</span><span class=""> </span><span class="pln">readLine</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">classes</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">pickMainClass</span><span class="pun">(</span><span class="pln">classes</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">sbt</span><span class="pun">.</span><span class="pln">SelectMainClass</span><span class="pun">(</span><span class="pln">None</span><span class="pun">,</span><span class=""> </span><span class="pln">classes</span><span class="pun">)</span><span class="">
  </span><span class="kwd">private</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">pickMainClassOrWarn</span><span class="pun">(</span><span class="pln">classes</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">logger</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="pln">classes</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">multiple</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">multiple</span><span class="pun">.</span><span class="pln">size</span><span class=""> </span><span class="pun">&gt;</span><span class=""> </span><span class="dec">1</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">logger</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="str">&#34;Multiple main classes detected.  Run &#39;show discoveredMainClasses&#39; to see the list&#34;</span><span class="pun">)</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="">                             </span><span class="kwd">=&gt;</span><span class="">
    </span><span class="pun">}</span><span class="">
    </span><span class="pln">pickMainClass</span><span class="pun">(</span><span class="pln">classes</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">doClean</span><span class="pun">(</span><span class="pln">clean</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">preserve</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Unit</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">withTemporaryDirectory</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">temp</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pun">(</span><span class="pln">dirs</span><span class="pun">,</span><span class=""> </span><span class="pln">files</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">preserve</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">)</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">allPaths</span><span class="pun">.</span><span class="pln">get</span><span class="pun">)</span><span class="pun">.</span><span class="pln">partition</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">isDirectory</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">mappings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">files</span><span class="pun">.</span><span class="pln">zipWithIndex</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">File</span><span class="pun">(</span><span class="pln">temp</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class="pun">.</span><span class="pln">toHexString</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">move</span><span class="pun">(</span><span class="pln">mappings</span><span class="pun">)</span><span class="">
      </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">delete</span><span class="pun">(</span><span class="pln">clean</span><span class="pun">)</span><span class="">
      </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">createDirectories</span><span class="pun">(</span><span class="pln">dirs</span><span class="pun">)</span><span class=""> </span><span class="com">// recreate empty directories</span><span class="">
      </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">move</span><span class="pun">(</span><span class="pln">mappings</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">swap</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">runMainTask</span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaRun</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ScalaRun</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">InputTask</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">DefaultParsers._</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">parser</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">loadForParser</span><span class="pun">(</span><span class="pln">discoveredMainClasses</span><span class="pun">)</span><span class="pun">(</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">names</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">runMainParser</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">names</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">inputTask</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pun">(</span><span class="pln">mainClass</span><span class="pun">,</span><span class=""> </span><span class="pln">args</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">parser</span><span class="pun">.</span><span class="pln">parsed</span><span class="">
        </span><span class="pln">toError</span><span class="pun">(</span><span class="pln">scalaRun</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">mainClass</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">args</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">runTask</span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClassTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaRun</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ScalaRun</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">InputTask</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">Def.parserToInput</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">parser</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">spaceDelimited</span><span class="pun">(</span><span class="pun">)</span><span class="">
      </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">inputTask</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">mainClass</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">mainClassTask</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">&#34;No main class detected.&#34;</span><span class="pun">)</span><span class="">
        </span><span class="pln">toError</span><span class="pun">(</span><span class="pln">scalaRun</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">mainClass</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">parser</span><span class="pun">.</span><span class="pln">parsed</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">runnerTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">runner</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">runnerInit</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">runnerInit</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ScalaRun</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">tmp</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">taskTemporaryDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">resolvedScope</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">resolvedScoped</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">scope</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">structure</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">buildStructure</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">si</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">scalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">javaOptions</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">fork</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="str">s&#34;</span><span class="str">javaOptions: </span><span class="str">$options</span><span class="str">&#34;</span><span class="pun">)</span><span class="">
      </span><span class="kwd">new</span><span class=""> </span><span class="pln">ForkRun</span><span class="pun">(</span><span class="pln">forkOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">options</span><span class="pun">.</span><span class="pln">nonEmpty</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">mask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ScopeMask</span><span class="pun">(</span><span class="pln">project</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">showJavaOptions</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Scope</span><span class="pun">.</span><span class="pln">displayMasked</span><span class="pun">(</span><span class="pun">(</span><span class="pln">javaOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">resolvedScope</span><span class="pun">)</span><span class="pun">.</span><span class="pln">scopedKey</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">,</span><span class=""> </span><span class="pun">(</span><span class="pln">javaOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">resolvedScope</span><span class="pun">)</span><span class="pun">.</span><span class="pln">key</span><span class="pun">.</span><span class="pln">label</span><span class="pun">,</span><span class=""> </span><span class="pln">mask</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">showFork</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Scope</span><span class="pun">.</span><span class="pln">displayMasked</span><span class="pun">(</span><span class="pun">(</span><span class="pln">fork</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">resolvedScope</span><span class="pun">)</span><span class="pun">.</span><span class="pln">scopedKey</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">,</span><span class=""> </span><span class="pun">(</span><span class="pln">fork</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">resolvedScope</span><span class="pun">)</span><span class="pun">.</span><span class="pln">key</span><span class="pun">.</span><span class="pln">label</span><span class="pun">,</span><span class=""> </span><span class="pln">mask</span><span class="pun">)</span><span class="">
        </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="str">s&#34;</span><span class="str">$showJavaOptions</span><span class="str"> will be ignored, </span><span class="str">$showFork</span><span class="str"> is set to false</span><span class="str">&#34;</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
      </span><span class="kwd">new</span><span class=""> </span><span class="pln">Run</span><span class="pun">(</span><span class="pln">si</span><span class="pun">,</span><span class=""> </span><span class="pln">trapExit</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">tmp</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use `docTaskSettings` instead&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.12.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">docSetting</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">docTaskSettings</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">docTaskSettings</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">doc</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">apiMappings</span><span class=""> </span><span class="pun">++=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">autoAPIMappings</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">APIMappings</span><span class="pun">.</span><span class="pln">extract</span><span class="pun">(</span><span class="pln">dependencyClasspath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toMap</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Map</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">[</span><span class="typ">File</span><span class="">, </span><span class="typ">URL</span><span class="pun">]</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">fileInputOptions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="str">&#34;-doc-root-content&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;-diagrams-dot-path&#34;</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">key</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">TaskGlobal</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">cs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">compilers</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">srcs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sources</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">out</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">target</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">sOpts</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">scalacOptions</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">xapis</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">apiMappings</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">hasScala</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">srcs</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">endsWith</span><span class="pun">(</span><span class="str">&#34;.scala&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">hasJava</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">srcs</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">endsWith</span><span class="pun">(</span><span class="str">&#34;.java&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">cp</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">dependencyClasspath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toList</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">label</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">nameForSrc</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">fiOpts</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">fileInputOptions</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">logger</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">maxer</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">maxErrors</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">spms</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sourcePositionMappers</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">reporter</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">Reporter</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="pun">(</span><span class="pln">compilerReporter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">compile</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">r</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">r</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="">       </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">LoggerReporter</span><span class="pun">(</span><span class="pln">maxer</span><span class="pun">,</span><span class=""> </span><span class="pln">logger</span><span class="pun">,</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">foldMappers</span><span class="pun">(</span><span class="pln">spms</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="pun">(</span><span class="pln">hasScala</span><span class="pun">,</span><span class=""> </span><span class="pln">hasJava</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sOpts</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Opts</span><span class="pun">.</span><span class="pln">doc</span><span class="pun">.</span><span class="pln">externalAPI</span><span class="pun">(</span><span class="pln">xapis</span><span class="pun">)</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">runDoc</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Doc</span><span class="pun">.</span><span class="pln">scaladoc</span><span class="pun">(</span><span class="pln">label</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;scala&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">cs</span><span class="pun">.</span><span class="pln">scalac</span><span class="pun">.</span><span class="pln">onArgs</span><span class="pun">(</span><span class="pln">exported</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;scaladoc&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">fiOpts</span><span class="pun">)</span><span class="">
          </span><span class="pln">runDoc</span><span class="pun">(</span><span class="pln">srcs</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">out</span><span class="pun">,</span><span class=""> </span><span class="pln">options</span><span class="pun">,</span><span class=""> </span><span class="pln">maxErrors</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">javadoc</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sbt</span><span class="pun">.</span><span class="pln">inc</span><span class="pun">.</span><span class="pln">Doc</span><span class="pun">.</span><span class="pln">cachedJavadoc</span><span class="pun">(</span><span class="pln">label</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;java&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">cs</span><span class="pun">.</span><span class="pln">javac</span><span class="pun">)</span><span class="">
          </span><span class="pln">javadoc</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">srcs</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">out</span><span class="pun">,</span><span class=""> </span><span class="pln">javacOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">,</span><span class=""> </span><span class="pln">reporter</span><span class="pun">)</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="com">// do nothing</span><span class="">
      </span><span class="pun">}</span><span class="">
      </span><span class="pln">out</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">mainRunTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">run</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">runTask</span><span class="pun">(</span><span class="pln">fullClasspath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">Runtime</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClass</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class="pun">,</span><span class=""> </span><span class="pln">runner</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">mainRunMainTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">runMain</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">runMainTask</span><span class="pun">(</span><span class="pln">fullClasspath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">Runtime</span><span class="pun">,</span><span class=""> </span><span class="pln">runner</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">run</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">discoverMainClasses</span><span class="pun">(</span><span class="pln">analysis</span><span class="pun">:</span><span class=""> </span><span class="pln">Analysis</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">Discovery</span><span class="pun">.</span><span class="pln">applications</span><span class="pun">(</span><span class="pln">Tests</span><span class="pun">.</span><span class="pln">allDefs</span><span class="pun">(</span><span class="pln">analysis</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">collect</span><span class="pun">(</span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">definition</span><span class="pun">,</span><span class=""> </span><span class="pln">discovered</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">discovered</span><span class="pun">.</span><span class="pln">hasMain</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">definition</span><span class="pun">.</span><span class="pln">name</span><span class=""> </span><span class="pun">}</span><span class="pun">)</span><span class="pun">.</span><span class="pln">sorted</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">consoleProjectTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">,</span><span class=""> </span><span class="pln">initialCommands</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">consoleProject</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">extra</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">ConsoleProject</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">extra</span><span class="pun">)</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">;</span><span class=""> </span><span class="pln">println</span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">consoleTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">consoleTask</span><span class="pun">(</span><span class="pln">fullClasspath</span><span class="pun">,</span><span class=""> </span><span class="pln">console</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">consoleQuickTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">consoleTask</span><span class="pun">(</span><span class="pln">externalDependencyClasspath</span><span class="pun">,</span><span class=""> </span><span class="pln">consoleQuick</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">consoleTask</span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">compilers</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">scalacOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">initialCommands</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">cleanupCommands</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">taskTemporaryDirectory</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaInstance</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="pun">(</span><span class="pln">cs</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">options</span><span class="pun">,</span><span class=""> </span><span class="pln">initCommands</span><span class="pun">,</span><span class=""> </span><span class="pln">cleanup</span><span class="pun">,</span><span class=""> </span><span class="pln">temp</span><span class="pun">,</span><span class=""> </span><span class="pln">si</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">cpFiles</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">fullcp</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">cpFiles</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">si</span><span class="pun">.</span><span class="pln">allJars</span><span class="pun">)</span><span class="pun">.</span><span class="pln">distinct</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">loader</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sbt</span><span class="pun">.</span><span class="pln">internal</span><span class="pun">.</span><span class="pln">inc</span><span class="pun">.</span><span class="pln">classpath</span><span class="pun">.</span><span class="pln">ClasspathUtilities</span><span class="pun">.</span><span class="pln">makeLoader</span><span class="pun">(</span><span class="pln">fullcp</span><span class="pun">,</span><span class=""> </span><span class="pln">si</span><span class="pun">,</span><span class=""> </span><span class="pln">IO</span><span class="pun">.</span><span class="pln">createUniqueDirectory</span><span class="pun">(</span><span class="pln">temp</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">compiler</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cs</span><span class="pun">.</span><span class="pln">scalac</span><span class="pun">.</span><span class="pln">onArgs</span><span class="pun">(</span><span class="pln">exported</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;scala&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">Console</span><span class="pun">(</span><span class="pln">compiler</span><span class="pun">)</span><span class="pun">)</span><span class="pun">(</span><span class="pln">cpFiles</span><span class="pun">,</span><span class=""> </span><span class="pln">options</span><span class="pun">,</span><span class=""> </span><span class="pln">loader</span><span class="pun">,</span><span class=""> </span><span class="pln">initCommands</span><span class="pun">,</span><span class=""> </span><span class="pln">cleanup</span><span class="pun">)</span><span class="pun">(</span><span class="pun">)</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">.</span><span class="pln">foreach</span><span class="pun">(</span><span class="pln">msg</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pln">println</span><span class="pun">(</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">exported</span><span class="pun">(</span><span class="pln">w</span><span class="pun">:</span><span class=""> </span><span class="pln">PrintWriter</span><span class="pun">,</span><span class=""> </span><span class="pln">command</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Unit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">args</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
    </span><span class="pln">w</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pun">(</span><span class="pln">command</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">args</span><span class="pun">)</span><span class="pun">.</span><span class="pln">mkString</span><span class="pun">(</span><span class="str">&#34; &#34;</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">exported</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskStreams</span><span class="pun">,</span><span class=""> </span><span class="pln">command</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Unit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">args</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">w</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">text</span><span class="pun">(</span><span class="pln">ExportStream</span><span class="pun">)</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pln">exported</span><span class="pun">(</span><span class="pln">w</span><span class="pun">,</span><span class=""> </span><span class="pln">command</span><span class="pun">)</span><span class="">
    </span><span class="kwd">finally</span><span class=""> </span><span class="pln">w</span><span class="pun">.</span><span class="pln">close</span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="com">// workaround for #937</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use inTask(compile)(compileInputsSettings)&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compileTaskSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">compile</span><span class="pun">)</span><span class="pun">(</span><span class="pln">compileInputsSettings</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compileTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Analysis</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">setup</span><span class="pun">:</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">IncSetup</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">compileIncSetup</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="com">// TODO - expose bytecode manipulation phase.</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">analysisResult</span><span class="pun">:</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">CompileResult</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">manipulateBytecode</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">analysisResult</span><span class="pun">.</span><span class="pln">hasModified</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">store</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">MixedAnalyzingCompiler</span><span class="pun">.</span><span class="pln">staticCachedStore</span><span class="pun">(</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">cacheFile</span><span class="pun">)</span><span class="">
      </span><span class="pln">store</span><span class="pun">.</span><span class="pln">set</span><span class="pun">(</span><span class="pln">analysisResult</span><span class="pun">.</span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">analysisResult</span><span class="pun">.</span><span class="pln">setup</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
    </span><span class="pln">analysisResult</span><span class="pun">.</span><span class="pln">analysis</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compileIncrementalTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="com">// TODO - Should readAnalysis + saveAnalysis be scoped by the compile task too?</span><span class="">
    </span><span class="pln">compileIncrementalTaskImpl</span><span class="pun">(</span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pun">(</span><span class="pln">compileInputs</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">compile</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">previousCompile</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pun">(</span><span class="pln">compilerReporter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">compile</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">compileIncrementalTaskImpl</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskStreams</span><span class="pun">,</span><span class=""> </span><span class="pln">ci</span><span class="pun">:</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">Inputs</span><span class="pun">,</span><span class=""> </span><span class="pln">previous</span><span class="pun">:</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">PreviousAnalysis</span><span class="pun">,</span><span class=""> </span><span class="pln">reporter</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">xsbti</span><span class="typ">.</span><span class="typ">Reporter</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">CompileResult</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">x</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">text</span><span class="pun">(</span><span class="pln">ExportStream</span><span class="pun">)</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">onArgs</span><span class="pun">(</span><span class="pln">cs</span><span class="pun">:</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">Compilers</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cs</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">scalac</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cs</span><span class="pun">.</span><span class="pln">scalac</span><span class="pun">.</span><span class="pln">onArgs</span><span class="pun">(</span><span class="pln">exported</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;scalac&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">javac</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cs</span><span class="pun">.</span><span class="pln">javac</span><span class=""> </span><span class="com">/*.onArgs(exported(x, &#34;javac&#34;))*/</span><span class=""> </span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">i</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">InputsWithPrevious</span><span class="pun">(</span><span class="pln">ci</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">compilers</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">onArgs</span><span class="pun">(</span><span class="pln">ci</span><span class="pun">.</span><span class="pln">compilers</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">previous</span><span class="pun">)</span><span class="">
      </span><span class="kwd">try</span><span class=""> </span><span class="pln">reporter</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">reporter</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">compile</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">,</span><span class=""> </span><span class="pln">reporter</span><span class="pun">)</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">None</span><span class="">           </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">compile</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
      </span><span class="kwd">finally</span><span class=""> </span><span class="pln">x</span><span class="pun">.</span><span class="pln">close</span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="com">// workaround for #937</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compileIncSetupTask</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">IncSetup</span><span class="pun">(</span><span class="">
      </span><span class="pln">analysisMap</span><span class="pun">(</span><span class="pln">dependencyClasspath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
      </span><span class="pln">definesClass</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
      </span><span class="pun">(</span><span class="pln">skip</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">compile</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
      </span><span class="com">// TODO - this is kind of a bad way to grab the cache directory for streams...</span><span class="">
      </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">compileAnalysisFilename</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
      </span><span class="pln">compilerCache</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
      </span><span class="pln">incOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compileInputsSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">compileInputs</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">cp</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">classDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">dependencyClasspath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
      </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">sources</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">classDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">scalacOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">javacOptions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
        </span><span class="pln">maxErrors</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">sourcePositionMappers</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">compileOrder</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">(</span><span class="pln">compilers</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">compileIncSetup</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
      </span><span class="pln">compilerReporter</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">None</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compileAnalysisSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">previousCompile</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">setup</span><span class="pun">:</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">IncSetup</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">compileIncSetup</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">store</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">MixedAnalyzingCompiler</span><span class="pun">.</span><span class="pln">staticCachedStore</span><span class="pun">(</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">cacheFile</span><span class="pun">)</span><span class="">
      </span><span class="pln">store</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pun">(</span><span class="pln">an</span><span class="pun">,</span><span class=""> </span><span class="pln">setup</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">PreviousAnalysis</span><span class="pun">(</span><span class="pln">an</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">setup</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">None</span><span class="">              </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">PreviousAnalysis</span><span class="pun">(</span><span class="pln">Analysis</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">(</span><span class="pln">nameHashing</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">setup</span><span class="pun">.</span><span class="pln">incOptions</span><span class="pun">.</span><span class="pln">nameHashing</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">None</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">printWarningsTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">streams</span><span class="pun">,</span><span class=""> </span><span class="pln">compile</span><span class="pun">,</span><span class=""> </span><span class="pln">maxErrors</span><span class="pun">,</span><span class=""> </span><span class="pln">sourcePositionMappers</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">max</span><span class="pun">,</span><span class=""> </span><span class="pln">spms</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">problems</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">analysis</span><span class="pun">.</span><span class="pln">infos</span><span class="pun">.</span><span class="pln">allInfos</span><span class="pun">.</span><span class="pln">values</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="pln">i</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">i</span><span class="pun">.</span><span class="pln">reportedProblems</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">i</span><span class="pun">.</span><span class="pln">unreportedProblems</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">reporter</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">LoggerReporter</span><span class="pun">(</span><span class="pln">max</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">,</span><span class=""> </span><span class="pln">Compiler</span><span class="pun">.</span><span class="pln">foldMappers</span><span class="pun">(</span><span class="pln">spms</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pln">problems</span><span class=""> </span><span class="pln">foreach</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">p</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">reporter</span><span class="pun">.</span><span class="pln">display</span><span class="pun">(</span><span class="pln">p</span><span class="pun">.</span><span class="pln">position</span><span class="pun">,</span><span class=""> </span><span class="pln">p</span><span class="pun">.</span><span class="pln">message</span><span class="pun">,</span><span class=""> </span><span class="pln">p</span><span class="pun">.</span><span class="pln">severity</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">sbtPluginExtra</span><span class="pun">(</span><span class="pln">m</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtV</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaV</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">m</span><span class="pun">.</span><span class="pln">extra</span><span class="pun">(</span><span class="pln">PomExtraDependencyAttributes</span><span class="pun">.</span><span class="pln">SbtVersionKey</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="pln">sbtV</span><span class="pun">,</span><span class=""> </span><span class="pln">PomExtraDependencyAttributes</span><span class="pun">.</span><span class="pln">ScalaVersionKey</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="pln">scalaV</span><span class="pun">)</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">crossVersion</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">CrossVersion</span><span class="pun">.</span><span class="pln">Disabled</span><span class="pun">)</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use PluginDiscovery.writeDescriptor.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">writePluginsDescriptor</span><span class="pun">(</span><span class="pln">plugins</span><span class="pun">:</span><span class=""> </span><span class="pln">Set</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">dir</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">PluginDiscovery</span><span class="pun">.</span><span class="pln">writeDescriptor</span><span class="pun">(</span><span class="pln">plugins</span><span class="pun">.</span><span class="pln">toSeq</span><span class="pun">,</span><span class=""> </span><span class="pln">dir</span><span class="pun">,</span><span class=""> </span><span class="pln">PluginDiscovery</span><span class="pun">.</span><span class="pln">Paths</span><span class="pun">.</span><span class="pln">Plugins</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toList</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">discoverSbtPluginNames</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">PluginDiscovery</span><span class="typ">.</span><span class="typ">DiscoveredNames</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">sbtPlugin</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">PluginDiscovery</span><span class="pun">.</span><span class="pln">discoverSourceAll</span><span class="pun">(</span><span class="pln">compile</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">PluginDiscovery</span><span class="pun">.</span><span class="pln">emptyDiscoveredNames</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use discoverSbtPluginNames.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">discoverPlugins</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Set</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">compile</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtPlugin</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">isPlugin</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">isPlugin</span><span class="pun">)</span><span class=""> </span><span class="pln">discoverSbtPlugins</span><span class="pun">(</span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Set</span><span class="pun">.</span><span class="pln">empty</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use PluginDiscovery.sourceModuleNames[Plugin].&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">discoverSbtPlugins</span><span class="pun">(</span><span class="pln">analysis</span><span class="pun">:</span><span class=""> </span><span class="pln">Analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Set</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">PluginDiscovery</span><span class="pun">.</span><span class="pln">sourceModuleNames</span><span class="pun">(</span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">classOf</span><span class="pun">[</span><span class="typ">Plugin</span><span class="pun">]</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toSet</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">copyResourcesTask</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">classDirectory</span><span class="pun">,</span><span class=""> </span><span class="pln">resources</span><span class="pun">,</span><span class=""> </span><span class="pln">resourceDirectories</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">target</span><span class="pun">,</span><span class=""> </span><span class="pln">resrcs</span><span class="pun">,</span><span class=""> </span><span class="pln">dirs</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">cacheFile</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;copy-resources&#34;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">mappings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">resrcs</span><span class=""> </span><span class="pun">---</span><span class=""> </span><span class="pln">dirs</span><span class="pun">)</span><span class=""> </span><span class="pln">pair</span><span class=""> </span><span class="pun">(</span><span class="pln">rebase</span><span class="pun">(</span><span class="pln">dirs</span><span class="pun">,</span><span class=""> </span><span class="pln">target</span><span class="pun">)</span><span class=""> </span><span class="pun">|</span><span class=""> </span><span class="pln">flat</span><span class="pun">(</span><span class="pln">target</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="str">&#34;Copy resource mappings: &#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">mappings</span><span class="pun">.</span><span class="pln">mkString</span><span class="pun">(</span><span class="str">&#34;\n\t&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;\n\t&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pln">Sync</span><span class="pun">(</span><span class="pln">cacheFile</span><span class="pun">)</span><span class="pun">(</span><span class="pln">mappings</span><span class="pun">)</span><span class="">
      </span><span class="pln">mappings</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">runMainParser</span><span class="pun">:</span><span class=""> </span><span class="pun">(</span><span class="pln">State</span><span class="pun">,</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Parser</span><span class="pun">[</span><span class="pun">(</span><span class="typ">String</span><span class="">, </span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">DefaultParsers._</span><span class="">
      </span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClasses</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Space</span><span class=""> </span><span class="pun">~&gt;</span><span class=""> </span><span class="pln">token</span><span class="pun">(</span><span class="pln">NotSpace</span><span class=""> </span><span class="pln">examples</span><span class=""> </span><span class="pln">mainClasses</span><span class="pun">.</span><span class="pln">toSet</span><span class="pun">)</span><span class=""> </span><span class="pun">~</span><span class=""> </span><span class="pln">spaceDelimited</span><span class="pun">(</span><span class="str">&#34;&lt;arg&gt;&#34;</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">testOnlyParser</span><span class="pun">:</span><span class=""> </span><span class="pun">(</span><span class="pln">State</span><span class="pun">,</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Parser</span><span class="pun">[</span><span class="pun">(</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="">, </span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">tests</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">DefaultParsers._</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">selectTests</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">distinctParser</span><span class="pun">(</span><span class="pln">tests</span><span class="pun">.</span><span class="pln">toSet</span><span class="pun">,</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">token</span><span class="pun">(</span><span class="pln">Space</span><span class="pun">)</span><span class=""> </span><span class="pun">~&gt;</span><span class=""> </span><span class="pln">token</span><span class="pun">(</span><span class="str">&#34;--&#34;</span><span class="pun">)</span><span class=""> </span><span class="pun">~&gt;</span><span class=""> </span><span class="pln">spaceDelimited</span><span class="pun">(</span><span class="str">&#34;&lt;option&gt;&#34;</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">??</span><span class=""> </span><span class="pln">Nil</span><span class="">
      </span><span class="pln">selectTests</span><span class=""> </span><span class="pun">~</span><span class=""> </span><span class="pln">options</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">distinctParser</span><span class="pun">(</span><span class="pln">exs</span><span class="pun">:</span><span class=""> </span><span class="pln">Set</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">raw</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Parser</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">DefaultParsers._</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">base</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">token</span><span class="pun">(</span><span class="pln">Space</span><span class="pun">)</span><span class=""> </span><span class="pun">~&gt;</span><span class=""> </span><span class="pln">token</span><span class="pun">(</span><span class="pln">NotSpace</span><span class=""> </span><span class="pun">-</span><span class=""> </span><span class="str">&#34;--&#34;</span><span class=""> </span><span class="pln">examples</span><span class=""> </span><span class="pln">exs</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">recurse</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">base</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">ex</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pun">(</span><span class="pln">matching</span><span class="pun">,</span><span class=""> </span><span class="pln">notMatching</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">exs</span><span class="pun">.</span><span class="pln">partition</span><span class="pun">(</span><span class="pln">GlobFilter</span><span class="pun">(</span><span class="pln">ex</span><span class="pun">)</span><span class="pun">.</span><span class="pln">accept</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class="">
        </span><span class="pln">distinctParser</span><span class="pun">(</span><span class="pln">notMatching</span><span class="pun">,</span><span class=""> </span><span class="pln">raw</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">result</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">raw</span><span class="pun">)</span><span class=""> </span><span class="pln">ex</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">result</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">matching</span><span class="pun">.</span><span class="pln">toSeq</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">result</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="pun">}</span><span class="">
      </span><span class="pln">recurse</span><span class=""> </span><span class="pun">??</span><span class=""> </span><span class="pln">Nil</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use the new &lt;key&gt;.all(&lt;ScopeFilter&gt;) API&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">inDependencies</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">default</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">T</span><span class="pun">,</span><span class=""> </span><span class="pln">includeRoot</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">forDependencies</span><span class="pun">[</span><span class="typ">T</span><span class="">, </span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">ref</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">key</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">ref</span><span class="pun">)</span><span class=""> </span><span class="pun">??</span><span class=""> </span><span class="pln">default</span><span class="pun">(</span><span class="pln">ref</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">includeRoot</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class="pun">)</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use the new &lt;key&gt;.all(&lt;ScopeFilter&gt;) API&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">forDependencies</span><span class="pun">[</span><span class="typ">T</span><span class="">, </span><span class="typ">V</span><span class="pun">]</span><span class="pun">(</span><span class="pln">init</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">V</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">includeRoot</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">V</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pun">(</span><span class="pln">loadedBuild</span><span class="pun">,</span><span class=""> </span><span class="pln">thisProjectRef</span><span class="pun">)</span><span class="pun">.</span><span class="pln">identity</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">lb</span><span class="pun">,</span><span class=""> </span><span class="pln">base</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="pln">transitiveDependencies</span><span class="pun">(</span><span class="pln">base</span><span class="pun">,</span><span class=""> </span><span class="pln">lb</span><span class="pun">,</span><span class=""> </span><span class="pln">includeRoot</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">init</span><span class=""> </span><span class="pln">join</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">transitiveDependencies</span><span class="pun">(</span><span class="pln">base</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">structure</span><span class="pun">:</span><span class=""> </span><span class="pln">LoadedBuild</span><span class="pun">,</span><span class=""> </span><span class="pln">includeRoot</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ProjectRef</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">tdeps</span><span class="pun">(</span><span class="pln">enabled</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ProjectRef</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ProjectRef</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="pun">{</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">full</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">enabled</span><span class="pun">)</span><span class=""> </span><span class="pln">Dag</span><span class="pun">.</span><span class="pln">topologicalSort</span><span class="pun">(</span><span class="pln">base</span><span class="pun">)</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Nil</span><span class="">
          </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">includeRoot</span><span class="pun">)</span><span class=""> </span><span class="pln">full</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">full</span><span class=""> </span><span class="pln">dropRight</span><span class=""> </span><span class="dec">1</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">fullCp</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">tdeps</span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">,</span><span class=""> </span><span class="pln">getDependencies</span><span class="pun">(</span><span class="pln">structure</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">fullAgg</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">tdeps</span><span class="pun">(</span><span class="pln">aggregate</span><span class="pun">,</span><span class=""> </span><span class="pln">getDependencies</span><span class="pun">(</span><span class="pln">structure</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class="">  </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">fullCp</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">fullAgg</span><span class="pun">)</span><span class="pun">.</span><span class="pln">distinct</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">fullCp</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="">             </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">fullAgg</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">getDependencies</span><span class="pun">(</span><span class="pln">structure</span><span class="pun">:</span><span class=""> </span><span class="pln">LoadedBuild</span><span class="pun">,</span><span class=""> </span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">aggregate</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ProjectRef</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">ref</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Project</span><span class="pun">.</span><span class="pln">getProject</span><span class="pun">(</span><span class="pln">ref</span><span class="pun">,</span><span class=""> </span><span class="pln">structure</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toList</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">p</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pun">(</span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">)</span><span class=""> </span><span class="pln">p</span><span class="pun">.</span><span class="pln">dependencies</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">project</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class="">
        </span><span class="pun">(</span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">aggregate</span><span class="pun">)</span><span class=""> </span><span class="pln">p</span><span class="pun">.</span><span class="pln">aggregate</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">val</span><span class=""> </span><span class="pln">CompletionsID</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="str">&#34;completions&#34;</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">noAggregation</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Scoped</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">run</span><span class="pun">,</span><span class=""> </span><span class="pln">runMain</span><span class="pun">,</span><span class=""> </span><span class="pln">console</span><span class="pun">,</span><span class=""> </span><span class="pln">consoleQuick</span><span class="pun">,</span><span class=""> </span><span class="pln">consoleProject</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">disableAggregation</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Defaults</span><span class="pun">.</span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">noAggregation</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">disableAggregate</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">disableAggregate</span><span class="pun">(</span><span class="pln">k</span><span class="pun">:</span><span class=""> </span><span class="pln">Scoped</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">aggregate</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">k</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">runnerSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">runnerTask</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">baseTasks</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">projectTasks</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">packageBase</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">baseClasspaths</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">publishSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">baseSettings</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">configSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">configSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">configTasks</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">configPaths</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">packageConfig</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">compilerPluginConfig</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">compileSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">configSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pun">(</span><span class="pln">mainRunMainTask</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">mainRunTask</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">addBaseSources</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">addUnmanagedLibrary</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">testSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">configSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">testTasks</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">itSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inConfig</span><span class="pun">(</span><span class="pln">IntegrationTest</span><span class="pun">)</span><span class="pun">(</span><span class="pln">testSettings</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">defaultConfigs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inConfig</span><span class="pun">(</span><span class="pln">Compile</span><span class="pun">)</span><span class="pun">(</span><span class="pln">compileSettings</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">inConfig</span><span class="pun">(</span><span class="pln">Test</span><span class="pun">)</span><span class="pun">(</span><span class="pln">testSettings</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">inConfig</span><span class="pun">(</span><span class="pln">Runtime</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Classpaths</span><span class="pun">.</span><span class="pln">configSettings</span><span class="pun">)</span><span class="">

  </span><span class="com">// settings that are not specific to a configuration</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Settings now split into AutoPlugins.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">projectBaseSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">projectCore</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">runnerSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">paths</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">baseClasspaths</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">baseTasks</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">compileBase</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">disableAggregation</span><span class="">

  </span><span class="com">// These are project level settings that MUST be on every project.</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">coreDefaultSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">projectCore</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">disableAggregation</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
      </span><span class="com">// Missing but core settings</span><span class="">
      </span><span class="pln">baseDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">thisProject</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">base</span><span class="pun">,</span><span class="">
      </span><span class="pln">target</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">baseDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;target&#34;</span><span class="">
    </span><span class="pun">)</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Default settings split into coreDefaultSettings and IvyModule/JvmModule plugins.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">defaultSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">projectBaseSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">defaultConfigs</span><span class="">

</span><span class="pun">}</span><span class="">
</span><span class="kwd">object</span><span class=""> </span><span class="pln">Classpaths</span><span class=""> </span><span class="pun">{</span><span class="">
  </span><span class="kwd">import</span><span class=""> </span><span class="pln">Path._</span><span class="">
  </span><span class="kwd">import</span><span class=""> </span><span class="pln">Keys._</span><span class="">
  </span><span class="kwd">import</span><span class=""> </span><span class="pln">Scope.ThisScope</span><span class="">
  </span><span class="kwd">import</span><span class=""> </span><span class="pln">Defaults._</span><span class="">
  </span><span class="kwd">import</span><span class=""> </span><span class="pln">Attributed.</span><span class="pun">{</span><span class=""> </span><span class="pln">blank</span><span class="pun">,</span><span class=""> </span><span class="pln">blankSeq</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">concatDistinct</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class=""> </span><span class="pln">y</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">x</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">y</span><span class="pun">)</span><span class="pun">.</span><span class="pln">distinct</span><span class=""> </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">concat</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedTaskable</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">concatSettings</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">b</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">configSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">classpaths</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">products</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">makeProducts</span><span class="pun">,</span><span class="">
    </span><span class="pln">productDirectories</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">classDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">classpathConfiguration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">findClasspathConfig</span><span class="pun">(</span><span class="pln">internalConfigurationMap</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">classpathConfiguration</span><span class="pun">.</span><span class="pun">?</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">update</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">classpaths</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">externalDependencyClasspath</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">concat</span><span class="pun">(</span><span class="pln">unmanagedClasspath</span><span class="pun">,</span><span class=""> </span><span class="pln">managedClasspath</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">dependencyClasspath</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">concat</span><span class="pun">(</span><span class="pln">internalDependencyClasspath</span><span class="pun">,</span><span class=""> </span><span class="pln">externalDependencyClasspath</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">fullClasspath</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">concatDistinct</span><span class="pun">(</span><span class="pln">exportedProducts</span><span class="pun">,</span><span class=""> </span><span class="pln">dependencyClasspath</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">internalDependencyClasspath</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">internalDependencies</span><span class="pun">,</span><span class="">
    </span><span class="pln">unmanagedClasspath</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">unmanagedDependencies</span><span class="pun">,</span><span class="">
    </span><span class="pln">managedClasspath</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">managedJars</span><span class="pun">(</span><span class="pln">classpathConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">classpathTypes</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">update</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">exportedProducts</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">exportProductsTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">unmanagedJars</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">findUnmanagedJars</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">unmanagedBase</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">includeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedJars</span><span class=""> </span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">excludeFilter</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">unmanagedJars</span><span class=""> </span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">exportClasspath</span><span class="pun">)</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">exportClasspath</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">s</span><span class="pun">.</span><span class="pln">mapInitialize</span><span class="pun">(</span><span class="pln">init</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">exportClasspath</span><span class="pun">(</span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">init</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="pun">)</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">exportClasspath</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskStreams</span><span class="pun">,</span><span class=""> </span><span class="pln">cp</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">w</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">text</span><span class="pun">(</span><span class="pln">ExportStream</span><span class="pun">)</span><span class="">
      </span><span class="kwd">try</span><span class=""> </span><span class="pln">w</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">Path</span><span class="pun">.</span><span class="pln">makeString</span><span class="pun">(</span><span class="pln">data</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="kwd">finally</span><span class=""> </span><span class="pln">w</span><span class="pun">.</span><span class="pln">close</span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="com">// workaround for #937</span><span class="">
      </span><span class="pln">cp</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">defaultPackageKeys</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">packageBin</span><span class="pun">,</span><span class=""> </span><span class="pln">packageSrc</span><span class="pun">,</span><span class=""> </span><span class="pln">packageDoc</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">defaultPackages</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">task</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">defaultPackageKeys</span><span class="pun">;</span><span class=""> </span><span class="pln">conf</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">Compile</span><span class="pun">,</span><span class=""> </span><span class="pln">Test</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">yield</span><span class=""> </span><span class="pun">(</span><span class="pln">task</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">conf</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">defaultArtifactTasks</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">makePom</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">defaultPackages</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">findClasspathConfig</span><span class="pun">(</span><span class="pln">map</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">thisConfig</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">delegated</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">Configuration</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">report</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">defined</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">report</span><span class="pun">.</span><span class="pln">allConfigurations</span><span class="pun">.</span><span class="pln">toSet</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">search</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">map</span><span class="pun">(</span><span class="pln">thisConfig</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pun">(</span><span class="pln">delegated</span><span class="pun">.</span><span class="pln">toList</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">Compile</span><span class="pun">,</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">Default</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">notFound</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">&#34;Configuration to use for managed classpath must be explicitly defined when default configurations are not present.&#34;</span><span class="pun">)</span><span class="">
      </span><span class="pln">search</span><span class=""> </span><span class="pln">find</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">defined</span><span class=""> </span><span class="pln">contains</span><span class=""> </span><span class="kwd">_</span><span class="pun">.</span><span class="pln">name</span><span class=""> </span><span class="pun">}</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">notFound</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">packaged</span><span class="pun">(</span><span class="pln">pkgTasks</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Map</span><span class="pun">[</span><span class="typ">Artifact</span><span class="">, </span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">enabledOnly</span><span class="pun">(</span><span class="pln">packagedArtifact</span><span class="pun">.</span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgTasks</span><span class="pun">)</span><span class=""> </span><span class="pln">apply</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">join</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">toMap</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">artifactDefs</span><span class="pun">(</span><span class="pln">pkgTasks</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">Artifact</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">enabledOnly</span><span class="pun">(</span><span class="pln">artifact</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgTasks</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">enabledOnly</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgTasks</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">forallIn</span><span class="pun">(</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgTasks</span><span class="pun">)</span><span class=""> </span><span class="pln">zipWith</span><span class=""> </span><span class="pln">forallIn</span><span class="pun">(</span><span class="pln">publishArtifact</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgTasks</span><span class="pun">)</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pln">zip</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pln">collect</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">a</span><span class=""> </span><span class="pun">}</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">forallIn</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgTasks</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">TaskKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">pkgTasks</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">pkg</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">key</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">pkg</span><span class="pun">.</span><span class="pln">scope</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">pkg</span><span class="pun">)</span><span class="pun">.</span><span class="pln">join</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">publishGlobalDefaults</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Defaults</span><span class="pun">.</span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">publishMavenStyle</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishArtifact</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishArtifact</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">Test</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">val</span><span class=""> </span><span class="pln">jvmPublishSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">artifacts</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">artifactDefs</span><span class="pun">(</span><span class="pln">defaultArtifactTasks</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">packagedArtifacts</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">packaged</span><span class="pun">(</span><span class="pln">defaultArtifactTasks</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">

  </span><span class="kwd">val</span><span class=""> </span><span class="pln">ivyPublishSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">publishGlobalDefaults</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">artifacts</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">packagedArtifacts</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Map</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">,</span><span class="">
    </span><span class="pln">crossTarget</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">target</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
    </span><span class="pln">makePom</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">config</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">makePomConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">;</span><span class=""> </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">makePom</span><span class="pun">(</span><span class="pln">ivyModule</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">;</span><span class=""> </span><span class="pln">config</span><span class="pun">.</span><span class="pln">file</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">packagedArtifact</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">makePom</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">(</span><span class="pun">(</span><span class="pln">artifact</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">makePom</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="pln">makePom</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">deliver</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">deliverTask</span><span class="pun">(</span><span class="pln">deliverConfiguration</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">deliverLocal</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">deliverTask</span><span class="pun">(</span><span class="pln">deliverLocalConfiguration</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">publish</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">publishTask</span><span class="pun">(</span><span class="pln">publishConfiguration</span><span class="pun">,</span><span class=""> </span><span class="pln">deliver</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishLocal</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">publishTask</span><span class="pun">(</span><span class="pln">publishLocalConfiguration</span><span class="pun">,</span><span class=""> </span><span class="pln">deliverLocal</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishM2</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">publishTask</span><span class="pun">(</span><span class="pln">publishM2Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">deliverLocal</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;This has been split into jvmPublishSettings and ivyPublishSettings.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">val</span><span class=""> </span><span class="pln">publishSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyPublishSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">jvmPublishSettings</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">baseGlobalDefaults</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Defaults</span><span class="pun">.</span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">conflictWarning</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">ConflictWarning</span><span class="pun">.</span><span class="pln">default</span><span class="pun">(</span><span class="str">&#34;global&#34;</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">homepage</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
    </span><span class="pln">startYear</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
    </span><span class="pln">licenses</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">developers</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">scmInfo</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
    </span><span class="pln">offline</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
    </span><span class="pln">defaultConfiguration</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">Compile</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">dependencyOverrides</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Set</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">,</span><span class="">
    </span><span class="pln">libraryDependencies</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">excludeDependencies</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyLoggingLevel</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">UpdateLogging</span><span class="pun">.</span><span class="pln">Default</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyXML</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">NodeSeq</span><span class="pun">.</span><span class="pln">Empty</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyValidate</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class="">
    </span><span class="pln">moduleConfigurations</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishTo</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class="">
    </span><span class="pln">resolvers</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class="">
    </span><span class="pln">retrievePattern</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">defaultRetrievePattern</span><span class="pun">,</span><span class="">
    </span><span class="pln">transitiveClassifiers</span><span class=""> </span><span class="pun">:==</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">SourceClassifier</span><span class="pun">,</span><span class=""> </span><span class="pln">DocClassifier</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">sbtDependency</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">app</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">id</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">app</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">id</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">scalaVersion</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">app</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">version</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">binVersion</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">binaryScalaVersion</span><span class="pun">(</span><span class="pln">scalaVersion</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">cross</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">id</span><span class="pun">.</span><span class="pln">crossVersioned</span><span class="pun">)</span><span class=""> </span><span class="pln">CrossVersion</span><span class="pun">.</span><span class="pln">binary</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">CrossVersion</span><span class="pun">.</span><span class="pln">Disabled</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">base</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">(</span><span class="pln">id</span><span class="pun">.</span><span class="pln">groupID</span><span class="pun">,</span><span class=""> </span><span class="pln">id</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">crossVersion</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cross</span><span class="pun">)</span><span class="">
      </span><span class="pln">CrossVersion</span><span class="pun">(</span><span class="pln">scalaVersion</span><span class="pun">,</span><span class=""> </span><span class="pln">binVersion</span><span class="pun">)</span><span class="pun">(</span><span class="pln">base</span><span class="pun">)</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">crossVersion</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">CrossVersion</span><span class="pun">.</span><span class="pln">Disabled</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">val</span><span class=""> </span><span class="pln">ivyBaseSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">baseGlobalDefaults</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">sbtClassifiersTasks</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">conflictWarning</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">conflictWarning</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">label</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Reference</span><span class="pun">.</span><span class="pln">display</span><span class="pun">(</span><span class="pln">thisProjectRef</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">unmanagedBase</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">baseDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;lib&#34;</span><span class="pun">,</span><span class="">
    </span><span class="pln">normalizedName</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Project</span><span class="pun">.</span><span class="pln">normalizeModuleID</span><span class="pun">(</span><span class="pln">name</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">isSnapshot</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">isSnapshot</span><span class=""> </span><span class="pln">or</span><span class=""> </span><span class="pln">version</span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pln">endsWith</span><span class=""> </span><span class="str">&#34;-SNAPSHOT&#34;</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">description</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">description</span><span class=""> </span><span class="pln">or</span><span class=""> </span><span class="pln">name</span><span class="pun">,</span><span class="">
    </span><span class="pln">organization</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">organization</span><span class=""> </span><span class="pln">or</span><span class=""> </span><span class="pln">normalizedName</span><span class="pun">,</span><span class="">
    </span><span class="pln">organizationName</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">organizationName</span><span class=""> </span><span class="pln">or</span><span class=""> </span><span class="pln">organization</span><span class="pun">,</span><span class="">
    </span><span class="pln">organizationHomepage</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">organizationHomepage</span><span class=""> </span><span class="pln">or</span><span class=""> </span><span class="pln">homepage</span><span class="pun">,</span><span class="">
    </span><span class="pln">projectInfo</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">description</span><span class="pun">,</span><span class=""> </span><span class="pln">homepage</span><span class="pun">,</span><span class=""> </span><span class="pln">startYear</span><span class="pun">,</span><span class=""> </span><span class="pln">licenses</span><span class="pun">,</span><span class=""> </span><span class="pln">organizationName</span><span class="pun">,</span><span class=""> </span><span class="pln">organizationHomepage</span><span class="pun">,</span><span class=""> </span><span class="pln">scmInfo</span><span class="pun">,</span><span class=""> </span><span class="pln">developers</span><span class="pun">)</span><span class=""> </span><span class="pln">apply</span><span class=""> </span><span class="pln">ModuleInfo</span><span class="pun">,</span><span class="">
    </span><span class="pln">overrideBuildResolvers</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">(</span><span class="pln">isOverrideRepositories</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">externalResolvers</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pun">(</span><span class="pln">externalResolvers</span><span class="pun">.</span><span class="pln">task</span><span class="pun">.</span><span class="pun">?</span><span class="pun">,</span><span class=""> </span><span class="pln">resolvers</span><span class="pun">,</span><span class=""> </span><span class="pln">appResolvers</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">Some</span><span class="pun">(</span><span class="pln">delegated</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">delegated</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="pln">rs</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">ars</span><span class="pun">)</span><span class="pun">)</span><span class="">          </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">ars</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">rs</span><span class=""> </span><span class="pun">}</span><span class=""> </span><span class="com">// TODO - Do we need to filter out duplicates?</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="pln">rs</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class="">                  </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">withDefaultResolvers</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">appResolvers</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">appConfiguration</span><span class=""> </span><span class="pln">apply</span><span class=""> </span><span class="pln">appRepositories</span><span class="pun">,</span><span class="">
    </span><span class="pln">bootResolvers</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">appConfiguration</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">bootRepositories</span><span class="pun">,</span><span class="">
    </span><span class="pln">fullResolvers</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pun">(</span><span class="pln">projectResolver</span><span class="pun">,</span><span class=""> </span><span class="pln">externalResolvers</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtPlugin</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtResolver</span><span class="pun">,</span><span class=""> </span><span class="pln">bootResolvers</span><span class="pun">,</span><span class=""> </span><span class="pln">overrideBuildResolvers</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">proj</span><span class="pun">,</span><span class=""> </span><span class="pln">rs</span><span class="pun">,</span><span class=""> </span><span class="pln">isPlugin</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtr</span><span class="pun">,</span><span class=""> </span><span class="pln">boot</span><span class="pun">,</span><span class=""> </span><span class="pln">overrideFlag</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">boot</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">repos</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">overrideFlag</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">proj</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">repos</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">base</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">isPlugin</span><span class="pun">)</span><span class=""> </span><span class="pln">sbtr</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">sbtPluginReleases</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">rs</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">rs</span><span class="">
          </span><span class="pln">proj</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">base</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">moduleName</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">normalizedName</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyPaths</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">IvyPaths</span><span class="pun">(</span><span class="pln">baseDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">bootIvyHome</span><span class="pun">(</span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">dependencyCacheDirectory</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">st</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="pln">BuildPaths</span><span class="pun">.</span><span class="pln">getDependencyDirectory</span><span class="pun">(</span><span class="pln">st</span><span class="pun">,</span><span class=""> </span><span class="pln">BuildPaths</span><span class="pun">.</span><span class="pln">getGlobalBase</span><span class="pun">(</span><span class="pln">st</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">otherResolvers</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">publishMavenLocal</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">publishTo</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">,</span><span class="">
    </span><span class="pln">projectResolver</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">projectResolverTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">projectDependencies</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">projectDependenciesTask</span><span class="pun">,</span><span class="">
    </span><span class="com">// TODO - Is this the appropriate split?  Ivy defines this simply as</span><span class="">
    </span><span class="com">//        just project + library, while the JVM plugin will define it as</span><span class="">
    </span><span class="com">//        having the additional sbtPlugin + autoScala magikz.</span><span class="">
    </span><span class="pln">allDependencies</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="pln">projectDependencies</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">libraryDependencies</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyScala</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">ivyScala</span><span class=""> </span><span class="pln">or</span><span class=""> </span><span class="pun">(</span><span class="pln">scalaHome</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBinaryVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaOrganization</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtPlugin</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">sh</span><span class="pun">,</span><span class=""> </span><span class="pln">fv</span><span class="pun">,</span><span class=""> </span><span class="pln">bv</span><span class="pun">,</span><span class=""> </span><span class="pln">so</span><span class="pun">,</span><span class=""> </span><span class="pln">plugin</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">Some</span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">IvyScala</span><span class="pun">(</span><span class="pln">fv</span><span class="pun">,</span><span class=""> </span><span class="pln">bv</span><span class="pun">,</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class=""> </span><span class="pln">filterImplicit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class=""> </span><span class="pln">checkExplicit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">overrideScalaVersion</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">plugin</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaOrganization</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">so</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">artifactPath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">makePom</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">artifactPathSetting</span><span class="pun">(</span><span class="pln">artifact</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">makePom</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishArtifact</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">makePom</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">publishMavenStyle</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">publishArtifact</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
    </span><span class="pln">artifact</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">makePom</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">Artifact</span><span class="pun">.</span><span class="pln">pom</span><span class="pun">(</span><span class="pln">moduleName</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">projectID</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">defaultProjectID</span><span class="pun">,</span><span class="">
    </span><span class="pln">projectID</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">pluginProjectID</span><span class="pun">,</span><span class="">
    </span><span class="pln">projectDescriptors</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">depMap</span><span class="pun">,</span><span class="">
    </span><span class="pln">updateConfiguration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">UpdateConfiguration</span><span class="pun">(</span><span class="pln">retrieveConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyLoggingLevel</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">updateOptions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">(</span><span class="pln">updateOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">Global</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
    </span><span class="pln">retrieveConfiguration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">retrieveManaged</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">RetrieveConfiguration</span><span class="pun">(</span><span class="pln">managedDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">retrievePattern</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">retrieveManagedSync</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">configurationsToRetrieve</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">None</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyConfiguration</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">mkIvyConfiguration</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyConfigurations</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">confs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">thisProject</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">configurations</span><span class="">
      </span><span class="pun">(</span><span class="pln">confs</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">confs</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">internalConfigurationMap</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pun">(</span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">autoCompilerPlugins</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">CompilerPlugin</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">distinct</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyConfigurations</span><span class=""> </span><span class="pun">++=</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">auxiliary</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyConfigurations</span><span class=""> </span><span class="pun">++=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">managedScalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">scalaHome</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">)</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">ScalaTool</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">moduleSettings</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">moduleSettings0</span><span class="pun">,</span><span class="">
    </span><span class="pln">makePomConfiguration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">MakePomConfiguration</span><span class="pun">(</span><span class="pln">artifactPath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">makePom</span><span class=""> </span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">projectInfo</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class=""> </span><span class="pln">pomExtra</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">pomPostProcess</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">pomIncludeRepository</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">pomAllRepositories</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">deliverLocalConfiguration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">deliverConfig</span><span class="pun">(</span><span class="pln">crossTarget</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">status</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">isSnapshot</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="str">&#34;integration&#34;</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="str">&#34;release&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyLoggingLevel</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">deliverConfiguration</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">deliverLocalConfiguration</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishConfiguration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">publishConfig</span><span class="pun">(</span><span class="pln">packagedArtifacts</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">publish</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">publishMavenStyle</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">None</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">deliver</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">resolverName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">getPublishTo</span><span class="pun">(</span><span class="pln">publishTo</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">checksums</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">checksums</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">publish</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyLoggingLevel</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">overwrite</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">isSnapshot</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishLocalConfiguration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">publishConfig</span><span class="pun">(</span><span class="pln">packagedArtifacts</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">publishLocal</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">deliverLocal</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">checksums</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">publishLocal</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyLoggingLevel</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">overwrite</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">isSnapshot</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">publishM2Configuration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">publishConfig</span><span class="pun">(</span><span class="pln">packagedArtifacts</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">publishM2</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class=""> </span><span class="pln">resolverName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">publishMavenLocal</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">checksums</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">checksums</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">publishM2</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyLoggingLevel</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">overwrite</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">isSnapshot</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivySbt</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">ivySbt0</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyModule</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">is</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivySbt</span><span class="pun">.</span><span class="pln">value</span><span class="pun">;</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">is</span><span class="pun">.</span><span class="pln">Module</span><span class="pun">(</span><span class="pln">moduleSettings</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">transitiveUpdate</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">transitiveUpdateTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">updateCacheName</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="str">&#34;update_cache&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pun">(</span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">crossPaths</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="str">s&#34;</span><span class="str">_</span><span class="str">${</span><span class="pln">scalaBinaryVersion</span><span class="pun">.</span><span class="pln">value</span><span class="str">}</span><span class="str">&#34;</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="str">&#34;&#34;</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">evictionWarningOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">EvictionWarningOptions</span><span class="pun">.</span><span class="pln">default</span><span class="pun">,</span><span class="">
    </span><span class="pln">dependencyPositions</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">dependencyPositionsTask</span><span class="pun">,</span><span class="">
    </span><span class="pln">unresolvedWarningConfiguration</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">UnresolvedWarningConfiguration</span><span class="pun">(</span><span class="pln">dependencyPositions</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">update</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">updateTask</span><span class=""> </span><span class="pln">tag</span><span class=""> </span><span class="pun">(</span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Update</span><span class="pun">,</span><span class=""> </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Network</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">update</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">report</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">update</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">log</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="">
      </span><span class="pln">ConflictWarning</span><span class="pun">(</span><span class="pln">conflictWarning</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">report</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">)</span><span class="">
      </span><span class="pln">report</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">evictionWarningOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">evicted</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">EvictionWarningOptions</span><span class="pun">.</span><span class="pln">full</span><span class="pun">,</span><span class="">
    </span><span class="pln">evicted</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">ShowLines._</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">report</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">updateTask</span><span class=""> </span><span class="pln">tag</span><span class=""> </span><span class="pun">(</span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Update</span><span class="pun">,</span><span class=""> </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Network</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">log</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">ew</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">EvictionWarning</span><span class="pun">(</span><span class="pln">ivyModule</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pun">(</span><span class="pln">evictionWarningOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">evicted</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">report</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">)</span><span class="">
      </span><span class="pln">ew</span><span class="pun">.</span><span class="pln">lines</span><span class=""> </span><span class="pln">foreach</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="pln">ew</span><span class="pun">.</span><span class="pln">infoAllTheThings</span><span class=""> </span><span class="pln">foreach</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="pln">ew</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">classifiersModule</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">updateClassifiers</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">language.implicitConversions</span><span class="">
      </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">key</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">m</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">m</span><span class="pun">.</span><span class="pln">organization</span><span class="pun">,</span><span class=""> </span><span class="pln">m</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">m</span><span class="pun">.</span><span class="pln">revision</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">projectDeps</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">projectDependencies</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toSet</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">externalModules</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">update</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">allModules</span><span class="pun">.</span><span class="pln">filterNot</span><span class="pun">(</span><span class="pln">m</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">projectDeps</span><span class=""> </span><span class="pln">contains</span><span class=""> </span><span class="pln">key</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pln">GetClassifiersModule</span><span class="pun">(</span><span class="pln">projectID</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">externalModules</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyConfigurations</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">updateClassifiers</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">transitiveClassifiers</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln">updateClassifiers</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">updateClassifiers</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">is</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivySbt</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">mod</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">classifiersModule</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">updateClassifiers</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">c</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">updateConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">app</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">out</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">is</span><span class="pun">.</span><span class="pln">withIvy</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">getSettings</span><span class="pun">.</span><span class="pln">getDefaultIvyUserDir</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">uwConfig</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">unresolvedWarningConfiguration</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">depDir</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">dependencyCacheDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="pln">withExcludes</span><span class="pun">(</span><span class="pln">out</span><span class="pun">,</span><span class=""> </span><span class="pln">mod</span><span class="pun">.</span><span class="pln">classifiers</span><span class="pun">,</span><span class=""> </span><span class="pln">lock</span><span class="pun">(</span><span class="pln">app</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">excludes</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">uwConfig</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">unresolvedWarningConfiguration</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">logicalClock</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">LogicalClock</span><span class="pun">(</span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">depDir</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">dependencyCacheDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="">
        </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">updateClassifiers</span><span class="pun">(</span><span class="pln">is</span><span class="pun">,</span><span class=""> </span><span class="pln">GetClassifiersConfiguration</span><span class="pun">(</span><span class="pln">mod</span><span class="pun">,</span><span class=""> </span><span class="pln">excludes</span><span class="pun">,</span><span class=""> </span><span class="pln">c</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyScala</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">uwConfig</span><span class="pun">,</span><span class=""> </span><span class="pln">LogicalClock</span><span class="pun">(</span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">depDir</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class=""> </span><span class="pln">tag</span><span class=""> </span><span class="pun">(</span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Update</span><span class="pun">,</span><span class=""> </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Network</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="">

  </span><span class="kwd">val</span><span class=""> </span><span class="pln">jvmBaseSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">libraryDependencies</span><span class=""> </span><span class="pun">++=</span><span class=""> </span><span class="pln">autoLibraryDependency</span><span class="pun">(</span><span class="pln">autoScalaLibrary</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">scalaHome</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">isEmpty</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">managedScalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtPlugin</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaOrganization</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="com">// Override the default to handle mixing in the sbtPlugin + scala dependencies.</span><span class="">
    </span><span class="pln">allDependencies</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">base</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">projectDependencies</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">libraryDependencies</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">pluginAdjust</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">sbtPlugin</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">sbtDependency</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">configurations</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">Provided</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">base</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">base</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">scalaHome</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">isDefined</span><span class=""> </span><span class="pun">||</span><span class=""> </span><span class="pln">ivyScala</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">isEmpty</span><span class=""> </span><span class="pun">||</span><span class=""> </span><span class="pun">!</span><span class="pln">managedScalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
        </span><span class="pln">pluginAdjust</span><span class="">
      </span><span class="kwd">else</span><span class="">
        </span><span class="pln">ScalaArtifacts</span><span class="pun">.</span><span class="pln">toolDependencies</span><span class="pun">(</span><span class="pln">scalaOrganization</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">pluginAdjust</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Split into ivyBaseSettings and jvmBaseSettings.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">val</span><span class=""> </span><span class="pln">baseSettings</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyBaseSettings</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">jvmBaseSettings</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">warnResolversConflict</span><span class="pun">(</span><span class="pln">ress</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Resolver</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Unit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">resset</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ress</span><span class="pun">.</span><span class="pln">toSet</span><span class="">
    </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">r</span><span class="pun">)</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">resset</span><span class=""> </span><span class="pln">groupBy</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">r</span><span class="pun">.</span><span class="pln">size</span><span class=""> </span><span class="pun">&gt;</span><span class=""> </span><span class="dec">1</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="str">&#34;Multiple resolvers having different access mechanism configured with same name &#39;&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">name</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;&#39;. To avoid conflict, Remove duplicate project resolvers (`resolvers`) or rename publishing resolver (`publishTo`).&#34;</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">defaultProjectID</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">setting</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">base</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">(</span><span class="pln">organization</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">moduleName</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">version</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">.</span><span class="pln">cross</span><span class="pun">(</span><span class="pln">crossVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">projectID</span><span class=""> </span><span class="pln">value</span><span class="pun">)</span><span class="pun">.</span><span class="pln">artifacts</span><span class="pun">(</span><span class="pln">artifacts</span><span class="pun">.</span><span class="pln">value</span><span class="pun">:</span><span class=""> </span><span class="kwd">_</span><span class="pun">*</span><span class="pun">)</span><span class="">
    </span><span class="pln">apiURL</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">u</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">autoAPIMappings</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">base</span><span class="pun">.</span><span class="pln">extra</span><span class="pun">(</span><span class="pln">SbtPomExtraProperties</span><span class="pun">.</span><span class="pln">POM_API_KEY</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="pln">u</span><span class="pun">.</span><span class="pln">toExternalForm</span><span class="pun">)</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="">                                </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">base</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">pluginProjectID</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">sbtBinaryVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBinaryVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">,</span><span class=""> </span><span class="pln">projectID</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtPlugin</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="pun">(</span><span class="pln">sbtBV</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBV</span><span class="pun">,</span><span class=""> </span><span class="pln">pid</span><span class="pun">,</span><span class=""> </span><span class="pln">isPlugin</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">isPlugin</span><span class="pun">)</span><span class=""> </span><span class="pln">sbtPluginExtra</span><span class="pun">(</span><span class="pln">pid</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtBV</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBV</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">pid</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">ivySbt0</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">IvySbt</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">ivyConfiguration</span><span class="pun">,</span><span class=""> </span><span class="pln">credentials</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">conf</span><span class="pun">,</span><span class=""> </span><span class="pln">creds</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">Credentials</span><span class="pun">.</span><span class="pln">register</span><span class="pun">(</span><span class="pln">creds</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
      </span><span class="kwd">new</span><span class=""> </span><span class="pln">IvySbt</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">moduleSettings0</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ModuleSettings</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">new</span><span class=""> </span><span class="pln">InlineConfigurationWithExcludes</span><span class="pun">(</span><span class="pln">projectID</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">projectInfo</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">allDependencies</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">dependencyOverrides</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">excludeDependencies</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class="">
      </span><span class="pln">ivyXML</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyConfigurations</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">defaultConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyScala</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyValidate</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">conflictManager</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">sbtClassifiersGlobalDefaults</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Defaults</span><span class="pun">.</span><span class="pln">globalDefaults</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">transitiveClassifiers</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">updateSbtClassifiers</span><span class=""> </span><span class="pun">~=</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pun">!=</span><span class=""> </span><span class="pln">DocClassifier</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">sbtClassifiersTasks</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sbtClassifiersGlobalDefaults</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">inTask</span><span class="pun">(</span><span class="pln">updateSbtClassifiers</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">externalResolvers</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">explicit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">buildStructure</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">units</span><span class="pun">(</span><span class="pln">thisProjectRef</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">build</span><span class="pun">)</span><span class="pun">.</span><span class="pln">unit</span><span class="pun">.</span><span class="pln">plugins</span><span class="pun">.</span><span class="pln">pluginData</span><span class="pun">.</span><span class="pln">resolvers</span><span class="">
      </span><span class="pln">explicit</span><span class=""> </span><span class="pln">orElse</span><span class=""> </span><span class="pln">bootRepositories</span><span class="pun">(</span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">externalResolvers</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivyConfiguration</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">InlineIvyConfiguration</span><span class="pun">(</span><span class="pln">ivyPaths</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">externalResolvers</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class=""> </span><span class="pln">offline</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">Option</span><span class="pun">(</span><span class="pln">lock</span><span class="pun">(</span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class="">
      </span><span class="pln">checksums</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">target</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;resolution-cache&#34;</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">UpdateOptions</span><span class="pun">(</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">,</span><span class="">
    </span><span class="pln">ivySbt</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">ivySbt0</span><span class="pun">,</span><span class="">
    </span><span class="pln">classifiersModule</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pun">(</span><span class="pln">projectID</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtDependency</span><span class="pun">,</span><span class=""> </span><span class="pln">transitiveClassifiers</span><span class="pun">,</span><span class=""> </span><span class="pln">loadedBuild</span><span class="pun">,</span><span class=""> </span><span class="pln">thisProjectRef</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">pid</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtDep</span><span class="pun">,</span><span class=""> </span><span class="pln">classifiers</span><span class="pun">,</span><span class=""> </span><span class="pln">lb</span><span class="pun">,</span><span class=""> </span><span class="pln">ref</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">pluginClasspath</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">lb</span><span class="pun">.</span><span class="pln">units</span><span class="pun">(</span><span class="pln">ref</span><span class="pun">.</span><span class="pln">build</span><span class="pun">)</span><span class="pun">.</span><span class="pln">unit</span><span class="pun">.</span><span class="pln">plugins</span><span class="pun">.</span><span class="pln">fullClasspath</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">pluginJars</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">pluginClasspath</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">isFile</span><span class="pun">)</span><span class=""> </span><span class="com">// exclude directories: an approximation to whether they&#39;ve been published</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">pluginIDs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">pluginJars</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">moduleID</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class="">
      </span><span class="pln">GetClassifiersModule</span><span class="pun">(</span><span class="pln">pid</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtDep</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">pluginIDs</span><span class="pun">,</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">Default</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class=""> </span><span class="pln">classifiers</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="pun">,</span><span class="">
    </span><span class="pln">updateSbtClassifiers</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">TaskGlobal</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">is</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivySbt</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">mod</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">classifiersModule</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">c</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">updateConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">app</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">out</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">is</span><span class="pun">.</span><span class="pln">withIvy</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">getSettings</span><span class="pun">.</span><span class="pln">getDefaultIvyUserDir</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">uwConfig</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">unresolvedWarningConfiguration</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">depDir</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">dependencyCacheDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="pln">withExcludes</span><span class="pun">(</span><span class="pln">out</span><span class="pun">,</span><span class=""> </span><span class="pln">mod</span><span class="pun">.</span><span class="pln">classifiers</span><span class="pun">,</span><span class=""> </span><span class="pln">lock</span><span class="pun">(</span><span class="pln">app</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">excludes</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">noExplicitCheck</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyScala</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">checkExplicit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">transitiveScratch</span><span class="pun">(</span><span class="pln">is</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;sbt&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">GetClassifiersConfiguration</span><span class="pun">(</span><span class="pln">mod</span><span class="pun">,</span><span class=""> </span><span class="pln">excludes</span><span class="pun">,</span><span class=""> </span><span class="pln">c</span><span class="pun">,</span><span class=""> </span><span class="pln">noExplicitCheck</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">uwConfig</span><span class="pun">,</span><span class=""> </span><span class="pln">LogicalClock</span><span class="pun">(</span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">depDir</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class=""> </span><span class="pln">tag</span><span class=""> </span><span class="pun">(</span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Update</span><span class="pun">,</span><span class=""> </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Network</span><span class="pun">)</span><span class="">
  </span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">deliverTask</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">DeliverConfiguration</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">ivyModule</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">update</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">deliver</span><span class="pun">(</span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">publishTask</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">PublishConfiguration</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">deliverKey</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">ivyModule</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">publish</span><span class="pun">(</span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class=""> </span><span class="pln">tag</span><span class=""> </span><span class="pun">(</span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Publish</span><span class="pun">,</span><span class=""> </span><span class="pln">Tags</span><span class="pun">.</span><span class="pln">Network</span><span class="pun">)</span><span class="">

  </span><span class="kwd">import</span><span class=""> </span><span class="pln">Cache._</span><span class="">
  </span><span class="kwd">import</span><span class=""> </span><span class="pln">CacheIvy.</span><span class="pun">{</span><span class="">
    </span><span class="pln">classpathFormat</span><span class="pun">,</span><span class=""> </span><span class="com">/*publishIC,*/</span><span class=""> </span><span class="pln">updateIC</span><span class="pun">,</span><span class="">
    </span><span class="pln">updateReportFormat</span><span class="pun">,</span><span class="">
    </span><span class="pln">excludeMap</span><span class="pun">,</span><span class="">
    </span><span class="pln">moduleIDSeqIC</span><span class="pun">,</span><span class="">
    </span><span class="pln">modulePositionMapFormat</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">withExcludes</span><span class="pun">(</span><span class="pln">out</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">classifiers</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">lock</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">GlobalLock</span><span class="pun">)</span><span class="pun">(</span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="">, </span><span class="typ">Set</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">exclName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="str">&#34;exclude_classifiers&#34;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">file</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">out</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">exclName</span><span class="">
      </span><span class="pln">lock</span><span class="pun">(</span><span class="pln">out</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pun">(</span><span class="pln">exclName</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;.lock&#34;</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Callable</span><span class="pun">[</span><span class="typ">UpdateReport</span><span class="pun">]</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">def</span><span class=""> </span><span class="pln">call</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">excludes</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">CacheIO</span><span class="pun">.</span><span class="pln">fromFile</span><span class="pun">[</span><span class="typ">Map</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="">, </span><span class="typ">Set</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class="pun">(</span><span class="pln">excludeMap</span><span class="pun">,</span><span class=""> </span><span class="pln">Map</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="">, </span><span class="typ">Set</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">report</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">f</span><span class="pun">(</span><span class="pln">excludes</span><span class="pun">)</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">allExcludes</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">excludes</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">extractExcludes</span><span class="pun">(</span><span class="pln">report</span><span class="pun">)</span><span class="">
          </span><span class="pln">CacheIO</span><span class="pun">.</span><span class="pln">toFile</span><span class="pun">(</span><span class="pln">excludeMap</span><span class="pun">)</span><span class="pun">(</span><span class="pln">allExcludes</span><span class="pun">)</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="">
          </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">addExcluded</span><span class="pun">(</span><span class="pln">report</span><span class="pun">,</span><span class=""> </span><span class="pln">classifiers</span><span class="pun">,</span><span class=""> </span><span class="pln">allExcludes</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="pun">}</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">updateTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">UpdateReport</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">depsUpdated</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">transitiveUpdate</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">(</span><span class="pun">!</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">stats</span><span class="pun">.</span><span class="pln">cached</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">isRoot</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">executionRoots</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">contains</span><span class=""> </span><span class="pln">resolvedScoped</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">forceUpdate</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">forceUpdatePeriod</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">fullUpdateOutput</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;out&#34;</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">forceUpdateByTime</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">forceUpdate</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">None</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">false</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">period</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">elapsedDuration</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">FiniteDuration</span><span class="pun">(</span><span class="pln">System</span><span class="pun">.</span><span class="pln">currentTimeMillis</span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="pun">-</span><span class=""> </span><span class="pln">fullUpdateOutput</span><span class="pun">.</span><span class="pln">lastModified</span><span class="pun">(</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">TimeUnit</span><span class="pun">.</span><span class="pln">MILLISECONDS</span><span class="pun">)</span><span class="">
        </span><span class="pln">fullUpdateOutput</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">elapsedDuration</span><span class=""> </span><span class="pun">&gt;</span><span class=""> </span><span class="pln">period</span><span class="">
    </span><span class="pun">}</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">scalaProvider</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="">

    </span><span class="com">// Only substitute unmanaged jars for managed jars when the major.minor parts of the versions the same for:</span><span class="">
    </span><span class="com">//   the resolved Scala version and the scalaHome version: compatible (weakly- no qualifier checked)</span><span class="">
    </span><span class="com">//   the resolved Scala version and the declared scalaVersion: assume the user intended scalaHome to override anything with scalaVersion</span><span class="">
    </span><span class="kwd">def</span><span class=""> </span><span class="pln">subUnmanaged</span><span class="pun">(</span><span class="pln">subVersion</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">jars</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">sv</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pun">(</span><span class="pln">partialVersion</span><span class="pun">(</span><span class="pln">sv</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">partialVersion</span><span class="pun">(</span><span class="pln">subVersion</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">partialVersion</span><span class="pun">(</span><span class="pln">scalaVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">Some</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">sh</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">res</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">sh</span><span class="">     </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">jars</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">Some</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">decl</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">res</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">decl</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">jars</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="">                                         </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Nil</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">subScalaJars</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Defaults</span><span class="pun">.</span><span class="pln">unmanagedScalaInstanceOnly</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">si</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">subUnmanaged</span><span class="pun">(</span><span class="pln">si</span><span class="pun">.</span><span class="pln">version</span><span class="pun">,</span><span class=""> </span><span class="pln">si</span><span class="pun">.</span><span class="pln">allJars</span><span class="pun">)</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">None</span><span class="">     </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">sv</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">version</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">sv</span><span class="pun">)</span><span class=""> </span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">jars</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Nil</span><span class="">
    </span><span class="pun">}</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">transform</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">r</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">substituteScalaFiles</span><span class="pun">(</span><span class="pln">scalaOrganization</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">r</span><span class="pun">)</span><span class="pun">(</span><span class="pln">subScalaJars</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">uwConfig</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">unresolvedWarningConfiguration</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">show</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Reference</span><span class="pun">.</span><span class="pln">display</span><span class="pun">(</span><span class="pln">thisProjectRef</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">st</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">logicalClock</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">LogicalClock</span><span class="pun">(</span><span class="pln">st</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">)</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">depDir</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">dependencyCacheDirectory</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">uc0</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">updateConfiguration</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="com">// Normally, log would capture log messages at all levels.</span><span class="">
    </span><span class="com">// Ivy logs are treated specially using sbt.UpdateConfiguration.logging.</span><span class="">
    </span><span class="com">// This code bumps up the sbt.UpdateConfiguration.logging to Full when logLevel is Debug.</span><span class="">
    </span><span class="kwd">import</span><span class=""> </span><span class="pln">UpdateLogging.</span><span class="pun">{</span><span class=""> </span><span class="pln">Full</span><span class="pun">,</span><span class=""> </span><span class="pln">DownloadOnly</span><span class="pun">,</span><span class=""> </span><span class="pln">Default</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">uc</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">logLevel</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class="pun">.</span><span class="pun">?</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">orElse</span><span class=""> </span><span class="pln">st</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln">logLevel</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">Level</span><span class="pun">.</span><span class="pln">Debug</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">uc0</span><span class="pun">.</span><span class="pln">logging</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">Default</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">uc0</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">logging</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Full</span><span class="pun">)</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">uc0</span><span class="pun">.</span><span class="pln">logging</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">Default</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">uc0</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">logging</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">DownloadOnly</span><span class="pun">)</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">uc0</span><span class="">
    </span><span class="pun">}</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">ewo</span><span class=""> </span><span class="kwd">=</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">executionRoots</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">exists</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">_</span><span class="pun">.</span><span class="pln">key</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">evicted</span><span class="pun">.</span><span class="pln">key</span><span class=""> </span><span class="pun">}</span><span class="pun">)</span><span class=""> </span><span class="pln">EvictionWarningOptions</span><span class="pun">.</span><span class="pln">empty</span><span class="">
      </span><span class="kwd">else</span><span class=""> </span><span class="pun">(</span><span class="pln">evictionWarningOptions</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="pln">cachedUpdate</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">updateCacheName</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">show</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyModule</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">uc</span><span class="pun">,</span><span class=""> </span><span class="pln">transform</span><span class="pun">,</span><span class="">
      </span><span class="pln">skip</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">skip</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">force</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">isRoot</span><span class=""> </span><span class="pun">||</span><span class=""> </span><span class="pln">forceUpdateByTime</span><span class="pun">,</span><span class=""> </span><span class="pln">depsUpdated</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">depsUpdated</span><span class="pun">,</span><span class="">
      </span><span class="pln">uwConfig</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">uwConfig</span><span class="pun">,</span><span class=""> </span><span class="pln">logicalClock</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">logicalClock</span><span class="pun">,</span><span class=""> </span><span class="pln">depDir</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">depDir</span><span class="pun">)</span><span class="pun">,</span><span class="">
      </span><span class="pln">ewo</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ewo</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use cachedUpdate with the variant that takes unresolvedHandler instead.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.6&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">cachedUpdate</span><span class="pun">(</span><span class="pln">cacheFile</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">label</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">:</span><span class=""> </span><span class="pln">IvySbt</span><span class="kwd">#</span><span class="pln">Module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateConfiguration</span><span class="pun">,</span><span class="">
    </span><span class="pln">transform</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">,</span><span class=""> </span><span class="pln">skip</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">force</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">depsUpdated</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">cachedUpdate</span><span class="pun">(</span><span class="pln">cacheFile</span><span class="pun">,</span><span class=""> </span><span class="pln">label</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">transform</span><span class="pun">,</span><span class=""> </span><span class="pln">skip</span><span class="pun">,</span><span class=""> </span><span class="pln">force</span><span class="pun">,</span><span class=""> </span><span class="pln">depsUpdated</span><span class="pun">,</span><span class="">
      </span><span class="pln">UnresolvedWarningConfiguration</span><span class="pun">(</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">LogicalClock</span><span class="pun">.</span><span class="pln">unknown</span><span class="pun">,</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class=""> </span><span class="pln">EvictionWarningOptions</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">)</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">cachedUpdate</span><span class="pun">(</span><span class="pln">cacheFile</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">label</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">:</span><span class=""> </span><span class="pln">IvySbt</span><span class="kwd">#</span><span class="pln">Module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateConfiguration</span><span class="pun">,</span><span class="">
    </span><span class="pln">transform</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">,</span><span class=""> </span><span class="pln">skip</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">force</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">depsUpdated</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class="">
    </span><span class="pln">uwConfig</span><span class="pun">:</span><span class=""> </span><span class="pln">UnresolvedWarningConfiguration</span><span class="pun">,</span><span class=""> </span><span class="pln">logicalClock</span><span class="pun">:</span><span class=""> </span><span class="pln">LogicalClock</span><span class="pun">,</span><span class=""> </span><span class="pln">depDir</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class="">
    </span><span class="pln">ewo</span><span class="pun">:</span><span class=""> </span><span class="pln">EvictionWarningOptions</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">updateCache</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">updateIC</span><span class="">
      </span><span class="kwd">type</span><span class=""> </span><span class="typ">In</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">IvyConfiguration</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">ModuleSettings</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">UpdateConfiguration</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">HNil</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">work</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">In</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">conf</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">settings</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">config</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">HNil</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
          </span><span class="kwd">import</span><span class=""> </span><span class="pln">ShowLines._</span><span class="">
          </span><span class="pln">log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">&#34;Updating &#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">label</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;...&#34;</span><span class="pun">)</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">r</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">IvyActions</span><span class="pun">.</span><span class="pln">updateEither</span><span class="pun">(</span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">uwConfig</span><span class="pun">,</span><span class=""> </span><span class="pln">logicalClock</span><span class="pun">,</span><span class=""> </span><span class="pln">depDir</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="pln">Right</span><span class="pun">(</span><span class="pln">ur</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">ur</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="pln">Left</span><span class="pun">(</span><span class="pln">uw</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
              </span><span class="pln">uw</span><span class="pun">.</span><span class="pln">lines</span><span class=""> </span><span class="pln">foreach</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
              </span><span class="kwd">throw</span><span class=""> </span><span class="pln">uw</span><span class="pun">.</span><span class="pln">resolveException</span><span class="">
          </span><span class="pun">}</span><span class="">
          </span><span class="pln">log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">&#34;Done updating.&#34;</span><span class="pun">)</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">result</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">transform</span><span class="pun">(</span><span class="pln">r</span><span class="pun">)</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">ew</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">EvictionWarning</span><span class="pun">(</span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">ewo</span><span class="pun">,</span><span class=""> </span><span class="pln">result</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">)</span><span class="">
          </span><span class="pln">ew</span><span class="pun">.</span><span class="pln">lines</span><span class=""> </span><span class="pln">foreach</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
          </span><span class="pln">ew</span><span class="pun">.</span><span class="pln">infoAllTheThings</span><span class=""> </span><span class="pln">foreach</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
          </span><span class="pln">result</span><span class="">
      </span><span class="pun">}</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">uptodate</span><span class="pun">(</span><span class="pln">inChanged</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">out</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="pun">!</span><span class="pln">force</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class="">
          </span><span class="pun">!</span><span class="pln">depsUpdated</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class="">
          </span><span class="pun">!</span><span class="pln">inChanged</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class="">
          </span><span class="pln">out</span><span class="pun">.</span><span class="pln">allFiles</span><span class="pun">.</span><span class="pln">forall</span><span class="pun">(</span><span class="pln">f</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">fileUptodate</span><span class="pun">(</span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="pln">out</span><span class="pun">.</span><span class="pln">stamps</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class="">
          </span><span class="pln">fileUptodate</span><span class="pun">(</span><span class="pln">out</span><span class="pun">.</span><span class="pln">cachedDescriptor</span><span class="pun">,</span><span class=""> </span><span class="pln">out</span><span class="pun">.</span><span class="pln">stamps</span><span class="pun">)</span><span class="">

      </span><span class="kwd">val</span><span class=""> </span><span class="pln">outCacheFile</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cacheFile</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;output&#34;</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">skipWork</span><span class="pun">:</span><span class=""> </span><span class="pln">In</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="pln">Tracked</span><span class="pun">.</span><span class="pln">lastOutput</span><span class="pun">[</span><span class="typ">In</span><span class="">, </span><span class="typ">UpdateReport</span><span class="pun">]</span><span class="pun">(</span><span class="pln">outCacheFile</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">out</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">out</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="">              </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">&#34;Skipping update requested, but update has not previously run successfully.&#34;</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">doWork</span><span class="pun">:</span><span class=""> </span><span class="pln">In</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="pln">Tracked</span><span class="pun">.</span><span class="pln">inputChanged</span><span class="pun">(</span><span class="pln">cacheFile</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;inputs&#34;</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">inChanged</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">in</span><span class="pun">:</span><span class=""> </span><span class="pln">In</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">outCache</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Tracked</span><span class="pun">.</span><span class="pln">lastOutput</span><span class="pun">[</span><span class="typ">In</span><span class="">, </span><span class="typ">UpdateReport</span><span class="pun">]</span><span class="pun">(</span><span class="pln">outCacheFile</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">out</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pln">uptodate</span><span class="pun">(</span><span class="pln">inChanged</span><span class="pun">,</span><span class=""> </span><span class="pln">out</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">out</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">work</span><span class="pun">(</span><span class="pln">in</span><span class="pun">)</span><span class="">
          </span><span class="pun">}</span><span class="">
          </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="pln">outCache</span><span class="pun">(</span><span class="pln">in</span><span class="pun">)</span><span class="">
          </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="pln">e</span><span class="pun">:</span><span class=""> </span><span class="pln">NullPointerException</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
              </span><span class="kwd">val</span><span class=""> </span><span class="pln">r</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">work</span><span class="pun">(</span><span class="pln">in</span><span class="pun">)</span><span class="">
              </span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="str">&#34;Update task has failed to cache the report due to null.&#34;</span><span class="pun">)</span><span class="">
              </span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="str">&#34;Report the following output to sbt:&#34;</span><span class="pun">)</span><span class="">
              </span><span class="pln">r</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">.</span><span class="pln">lines</span><span class=""> </span><span class="pln">foreach</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
              </span><span class="pln">log</span><span class="pun">.</span><span class="pln">trace</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="">
              </span><span class="pln">r</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="pln">e</span><span class="pun">:</span><span class=""> </span><span class="pln">OutOfMemoryError</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
              </span><span class="kwd">val</span><span class=""> </span><span class="pln">r</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">work</span><span class="pun">(</span><span class="pln">in</span><span class="pun">)</span><span class="">
              </span><span class="pln">log</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="str">&#34;Update task has failed to cache the report due to OutOfMemoryError.&#34;</span><span class="pun">)</span><span class="">
              </span><span class="pln">log</span><span class="pun">.</span><span class="pln">trace</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="">
              </span><span class="pln">r</span><span class="">
          </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">f</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">skip</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pun">!</span><span class="pln">force</span><span class="pun">)</span><span class=""> </span><span class="pln">skipWork</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">doWork</span><span class="">
      </span><span class="pln">f</span><span class="pun">(</span><span class="pln">module</span><span class="pun">.</span><span class="pln">owner</span><span class="pun">.</span><span class="pln">configuration</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">module</span><span class="pun">.</span><span class="pln">moduleSettings</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">config</span><span class=""> </span><span class="pun">:+:</span><span class=""> </span><span class="pln">HNil</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">fileUptodate</span><span class="pun">(</span><span class="pln">file</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">stamps</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">File</span><span class="">, </span><span class="typ">Long</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">stamps</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pun">.</span><span class="pln">forall</span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">file</span><span class="pun">.</span><span class="pln">lastModified</span><span class="pun">)</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">dependencyPositionsTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Map</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="">, </span><span class="typ">SourcePosition</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">projRef</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">thisProjectRef</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">st</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">state</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">s</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">cacheFile</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">cacheDirectory</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">updateCacheName</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">depSourcePosCache</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">moduleIDSeqIC</span><span class="">
    </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">outFormat</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">modulePositionMapFormat</span><span class="">
    </span><span class="kwd">def</span><span class=""> </span><span class="pln">modulePositions</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="">, </span><span class="typ">SourcePosition</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
      </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">extracted</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">Project</span><span class=""> </span><span class="pln">extract</span><span class=""> </span><span class="pln">st</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">sk</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">libraryDependencies</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pun">(</span><span class="pln">GlobalScope</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">projRef</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">scopedKey</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">empty</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">extracted</span><span class="pun">.</span><span class="pln">structure</span><span class="pun">.</span><span class="pln">data</span><span class=""> </span><span class="pln">set</span><span class=""> </span><span class="pun">(</span><span class="pln">sk</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">,</span><span class=""> </span><span class="pln">sk</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">settings</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">extracted</span><span class="pun">.</span><span class="pln">structure</span><span class="pun">.</span><span class="pln">settings</span><span class=""> </span><span class="pln">filter</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
          </span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">key</span><span class="pun">.</span><span class="pln">key</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">libraryDependencies</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class="">
            </span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">key</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">project</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">Select</span><span class="pun">(</span><span class="pln">projRef</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
        </span><span class="pln">Map</span><span class="pun">(</span><span class="pln">settings</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pln">@unchecked</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
            </span><span class="pln">s</span><span class="pun">.</span><span class="pln">init</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="pln">empty</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">pos</span><span class=""> </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="pun">:</span><span class=""> </span><span class="kwd">_</span><span class="pun">*</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">Throwable</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Map</span><span class="pun">(</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">

    </span><span class="kwd">val</span><span class=""> </span><span class="pln">outCacheFile</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cacheFile</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;output_dsp&#34;</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">f</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Tracked</span><span class="pun">.</span><span class="pln">inputChanged</span><span class="pun">(</span><span class="pln">cacheFile</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;input_dsp&#34;</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">inChanged</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">in</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">outCache</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Tracked</span><span class="pun">.</span><span class="pln">lastOutput</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="">, </span><span class="typ">Map</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="">, </span><span class="typ">SourcePosition</span><span class="pun">]</span><span class="pun">]</span><span class="pun">(</span><span class="pln">outCacheFile</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">out</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">!</span><span class="pln">inChanged</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">out</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="">                            </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">modulePositions</span><span class="">
      </span><span class="pun">}</span><span class="">
      </span><span class="pln">outCache</span><span class="pun">(</span><span class="pln">in</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
    </span><span class="pln">f</span><span class="pun">(</span><span class="pln">libraryDependencies</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="com">/*
	// can&#39;t cache deliver/publish easily since files involved are hidden behind patterns.  publish will be difficult to verify target-side anyway
	def cachedPublish(cacheFile: File)(g: (IvySbt#Module, PublishConfiguration) =&gt; Unit, module: IvySbt#Module, config: PublishConfiguration) =&gt; Unit =
	{ case module :+: config :+: HNil =&gt;
	/*	implicit val publishCache = publishIC
		val f = cached(cacheFile) { (conf: IvyConfiguration, settings: ModuleSettings, config: PublishConfiguration) =&gt;*/</span><span class="">
		    </span><span class="pln">g</span><span class="pun">(</span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">)</span><span class="">
		</span><span class="com">/*}
		f(module.owner.configuration :+: module.moduleSettings :+: config :+: HNil)*/</span><span class="">
	</span><span class="pun">}</span><span class="pun">*/</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">defaultRepositoryFilter</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">repo</span><span class="pun">:</span><span class=""> </span><span class="pln">MavenRepository</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">!</span><span class="pln">repo</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="str">&#34;file:&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">getPublishTo</span><span class="pun">(</span><span class="pln">repo</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">Resolver</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Resolver</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">repo</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">&#34;Repository for publishing is not specified.&#34;</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">deliverConfig</span><span class="pun">(</span><span class="pln">outputDirectory</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">status</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="str">&#34;release&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateLogging</span><span class="pun">.</span><span class="pln">Value</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">UpdateLogging</span><span class="pun">.</span><span class="pln">DownloadOnly</span><span class="pun">)</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">new</span><span class=""> </span><span class="pln">DeliverConfiguration</span><span class="pun">(</span><span class="pln">deliverPattern</span><span class="pun">(</span><span class="pln">outputDirectory</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">status</span><span class="pun">,</span><span class=""> </span><span class="pln">None</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class="pun">)</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Previous semantics allowed overwriting cached files, which was unsafe. Please specify overwrite parameter.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.2&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">publishConfig</span><span class="pun">(</span><span class="pln">artifacts</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">Artifact</span><span class="">, </span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyFile</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">checksums</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">resolverName</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateLogging</span><span class="pun">.</span><span class="pln">Value</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">PublishConfiguration</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">publishConfig</span><span class="pun">(</span><span class="pln">artifacts</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyFile</span><span class="pun">,</span><span class=""> </span><span class="pln">checksums</span><span class="pun">,</span><span class=""> </span><span class="pln">resolverName</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class="pun">,</span><span class=""> </span><span class="pln">overwrite</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">publishConfig</span><span class="pun">(</span><span class="pln">artifacts</span><span class="pun">:</span><span class=""> </span><span class="pln">Map</span><span class="pun">[</span><span class="typ">Artifact</span><span class="">, </span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyFile</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">checksums</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">resolverName</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="str">&#34;local&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateLogging</span><span class="pun">.</span><span class="pln">Value</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">UpdateLogging</span><span class="pun">.</span><span class="pln">DownloadOnly</span><span class="pun">,</span><span class=""> </span><span class="pln">overwrite</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">new</span><span class=""> </span><span class="pln">PublishConfiguration</span><span class="pun">(</span><span class="pln">ivyFile</span><span class="pun">,</span><span class=""> </span><span class="pln">resolverName</span><span class="pun">,</span><span class=""> </span><span class="pln">artifacts</span><span class="pun">,</span><span class=""> </span><span class="pln">checksums</span><span class="pun">,</span><span class=""> </span><span class="pln">logging</span><span class="pun">,</span><span class=""> </span><span class="pln">overwrite</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">deliverPattern</span><span class="pun">(</span><span class="pln">outputPath</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">outputPath</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;[artifact]-[revision](-[classifier]).[ext]&#34;</span><span class="pun">)</span><span class="pun">.</span><span class="pln">absolutePath</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">projectDependenciesTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">thisProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">settingsData</span><span class="pun">,</span><span class=""> </span><span class="pln">buildDependencies</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">ref</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">deps</span><span class="pun">.</span><span class="pln">classpath</span><span class="pun">(</span><span class="pln">ref</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">dep</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="pun">(</span><span class="pln">projectID</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">dep</span><span class="pun">.</span><span class="pln">project</span><span class="pun">)</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">data</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">_</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">configurations</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">dep</span><span class="pun">.</span><span class="pln">configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">explicitArtifacts</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">depMap</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Map</span><span class="pun">[</span><span class="typ">ModuleRevisionId</span><span class="">, </span><span class="typ">ModuleDescriptor</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">thisProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">settingsData</span><span class="pun">,</span><span class=""> </span><span class="pln">buildDependencies</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">root</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">depMap</span><span class="pun">(</span><span class="pln">deps</span><span class=""> </span><span class="pln">classpathTransitiveRefs</span><span class=""> </span><span class="pln">root</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">depMap</span><span class="pun">(</span><span class="pln">projects</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ProjectRef</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">log</span><span class="pun">:</span><span class=""> </span><span class="pln">Logger</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Map</span><span class="pun">[</span><span class="typ">ModuleRevisionId</span><span class="">, </span><span class="typ">ModuleDescriptor</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">projects</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="pln">ivyModule</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">data</span><span class="pun">)</span><span class="pun">.</span><span class="pln">join</span><span class="pun">.</span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">mod</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">mod</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">_</span><span class="pun">.</span><span class="pln">dependencyMapping</span><span class="pun">(</span><span class="pln">log</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class=""> </span><span class="pln">toMap</span><span class="pun">;</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">projectResolverTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Resolver</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">projectDescriptors</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">m</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">new</span><span class=""> </span><span class="pln">RawRepository</span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">ProjectResolver</span><span class="pun">(</span><span class="pln">ProjectResolver</span><span class="pun">.</span><span class="pln">InterProject</span><span class="pun">,</span><span class=""> </span><span class="pln">m</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">analyzed</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">T</span><span class="pun">,</span><span class=""> </span><span class="pln">analysis</span><span class="pun">:</span><span class=""> </span><span class="pln">Analysis</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Attributed</span><span class="pun">.</span><span class="pln">blank</span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">Keys</span><span class="pun">.</span><span class="pln">analysis</span><span class="pun">,</span><span class=""> </span><span class="pln">analysis</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">makeProducts</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">x1</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">compile</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">x2</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">copyResources</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="pln">classDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">exportProductsTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">art</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">artifact</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">packageBin</span><span class="pun">)</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">module</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">projectID</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">val</span><span class=""> </span><span class="pln">config</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">value</span><span class="">
    </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">f</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">productsImplTask</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="kwd">yield</span><span class=""> </span><span class="pln">APIMappings</span><span class="pun">.</span><span class="pln">store</span><span class="pun">(</span><span class="pln">analyzed</span><span class="pun">(</span><span class="pln">f</span><span class="pun">,</span><span class=""> </span><span class="pln">compile</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">apiURL</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">artifact</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">art</span><span class="pun">)</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">moduleID</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">)</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">productsImplTask</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">products</span><span class="pun">.</span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">packageBin</span><span class="pun">.</span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">exportJars</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">psTask</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgTask</span><span class="pun">,</span><span class=""> </span><span class="pln">useJars</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">useJars</span><span class="pun">)</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">pkgTask</span><span class="pun">)</span><span class="pun">.</span><span class="pln">join</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">psTask</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">constructBuildDependencies</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">BuildDependencies</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">loadedBuild</span><span class="pun">(</span><span class="pln">lb</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">BuildUtil</span><span class="pun">.</span><span class="pln">dependencies</span><span class="pun">(</span><span class="pln">lb</span><span class="pun">.</span><span class="pln">units</span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">internalDependencies</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">thisProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">classpathConfiguration</span><span class="pun">,</span><span class=""> </span><span class="pln">configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">settingsData</span><span class="pun">,</span><span class=""> </span><span class="pln">buildDependencies</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pln">internalDependencies0</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">unmanagedDependencies</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">thisProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">settingsData</span><span class="pun">,</span><span class=""> </span><span class="pln">buildDependencies</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pln">unmanagedDependencies0</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">mkIvyConfiguration</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">IvyConfiguration</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">fullResolvers</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyPaths</span><span class="pun">,</span><span class=""> </span><span class="pln">otherResolvers</span><span class="pun">,</span><span class=""> </span><span class="pln">moduleConfigurations</span><span class="pun">,</span><span class=""> </span><span class="pln">offline</span><span class="pun">,</span><span class=""> </span><span class="pln">checksums</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">,</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">,</span><span class="">
      </span><span class="pln">target</span><span class="pun">,</span><span class=""> </span><span class="pln">updateOptions</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">rs</span><span class="pun">,</span><span class=""> </span><span class="pln">paths</span><span class="pun">,</span><span class=""> </span><span class="pln">other</span><span class="pun">,</span><span class=""> </span><span class="pln">moduleConfs</span><span class="pun">,</span><span class=""> </span><span class="pln">off</span><span class="pun">,</span><span class=""> </span><span class="pln">check</span><span class="pun">,</span><span class=""> </span><span class="pln">app</span><span class="pun">,</span><span class=""> </span><span class="pln">t</span><span class="pun">,</span><span class=""> </span><span class="pln">uo</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="pln">warnResolversConflict</span><span class="pun">(</span><span class="pln">rs</span><span class=""> </span><span class="pun">++:</span><span class=""> </span><span class="pln">other</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">resCacheDir</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">t</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="str">&#34;resolution-cache&#34;</span><span class="">

        </span><span class="kwd">new</span><span class=""> </span><span class="pln">InlineIvyConfiguration</span><span class="pun">(</span><span class="pln">paths</span><span class="pun">,</span><span class=""> </span><span class="pln">rs</span><span class="pun">,</span><span class=""> </span><span class="pln">other</span><span class="pun">,</span><span class=""> </span><span class="pln">moduleConfs</span><span class="pun">,</span><span class=""> </span><span class="pln">off</span><span class="pun">,</span><span class=""> </span><span class="pln">Option</span><span class="pun">(</span><span class="pln">lock</span><span class="pun">(</span><span class="pln">app</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">check</span><span class="pun">,</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">resCacheDir</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">uo</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">

  </span><span class="kwd">import</span><span class=""> </span><span class="pln">java.util.LinkedHashSet</span><span class="">
  </span><span class="kwd">import</span><span class=""> </span><span class="pln">collection.JavaConversions.asScalaSet</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">interSort</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">:</span><span class=""> </span><span class="pln">BuildDependencies</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="pun">(</span><span class="typ">ProjectRef</span><span class="">, </span><span class="typ">String</span><span class="pun">)</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">visited</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">asScalaSet</span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">LinkedHashSet</span><span class="pun">[</span><span class="pun">(</span><span class="typ">ProjectRef</span><span class="">, </span><span class="typ">String</span><span class="pun">)</span><span class="pun">]</span><span class="pun">)</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">visit</span><span class="pun">(</span><span class="pln">p</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">c</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Unit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">applicableConfigs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">allConfigs</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="">
        </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">ac</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">applicableConfigs</span><span class="pun">)</span><span class=""> </span><span class="com">// add all configurations in this project</span><span class="">
          </span><span class="pln">visited</span><span class=""> </span><span class="pln">add</span><span class=""> </span><span class="pun">(</span><span class="pln">p</span><span class=""> </span><span class="pun">-&gt;</span><span class=""> </span><span class="pln">ac</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">masterConfs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">names</span><span class="pun">(</span><span class="pln">getConfigurations</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">)</span><span class="pun">)</span><span class="">

        </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">ResolvedClasspathDependency</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">confMapping</span><span class="pun">)</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">deps</span><span class="pun">.</span><span class="pln">classpath</span><span class="pun">(</span><span class="pln">p</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">configurations</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">getConfigurations</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">)</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">mapping</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">mapped</span><span class="pun">(</span><span class="pln">confMapping</span><span class="pun">,</span><span class=""> </span><span class="pln">masterConfs</span><span class="pun">,</span><span class=""> </span><span class="pln">names</span><span class="pun">(</span><span class="pln">configurations</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;compile&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;*-&gt;compile&#34;</span><span class="pun">)</span><span class="">
          </span><span class="com">// map master configuration &#39;c&#39; and all extended configurations to the appropriate dependency configuration</span><span class="">
          </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">ac</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">applicableConfigs</span><span class="pun">;</span><span class=""> </span><span class="pln">depConfName</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">mapping</span><span class="pun">(</span><span class="pln">ac</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">depConf</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">confOpt</span><span class="pun">(</span><span class="pln">configurations</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfName</span><span class="pun">)</span><span class="pun">)</span><span class="">
              </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">visited</span><span class="pun">(</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfName</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="">
                </span><span class="pln">visit</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">depConf</span><span class="pun">)</span><span class="">
          </span><span class="pun">}</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="pun">}</span><span class="">
      </span><span class="pln">visit</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">)</span><span class="">
      </span><span class="pln">visited</span><span class="pun">.</span><span class="pln">toSeq</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">unmanagedDependencies0</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">:</span><span class=""> </span><span class="pln">BuildDependencies</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">interDependencies</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">unmanagedLibs</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">internalDependencies0</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">self</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">:</span><span class=""> </span><span class="pln">BuildDependencies</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">interDependencies</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">,</span><span class=""> </span><span class="pln">self</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="kwd">false</span><span class="pun">,</span><span class=""> </span><span class="pln">productsTask</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">interDependencies</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">:</span><span class=""> </span><span class="pln">ProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">:</span><span class=""> </span><span class="pln">BuildDependencies</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">self</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">includeSelf</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class="">
    </span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pun">(</span><span class="pln">ProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">visited</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">interSort</span><span class="pun">(</span><span class="pln">projectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">tasks</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">asScalaSet</span><span class="pun">(</span><span class="kwd">new</span><span class=""> </span><span class="pln">LinkedHashSet</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="">
      </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">c</span><span class="pun">)</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">visited</span><span class="pun">)</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">includeSelf</span><span class=""> </span><span class="pun">||</span><span class=""> </span><span class="pun">(</span><span class="pln">dep</span><span class=""> </span><span class="pun">!=</span><span class=""> </span><span class="pln">projectRef</span><span class="pun">)</span><span class=""> </span><span class="pun">||</span><span class=""> </span><span class="pun">(</span><span class="pln">conf</span><span class="pun">.</span><span class="pln">name</span><span class=""> </span><span class="pun">!=</span><span class=""> </span><span class="pln">c</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">self</span><span class="pun">.</span><span class="pln">name</span><span class=""> </span><span class="pun">!=</span><span class=""> </span><span class="pln">c</span><span class="pun">)</span><span class="pun">)</span><span class="">
          </span><span class="pln">tasks</span><span class=""> </span><span class="pun">+=</span><span class=""> </span><span class="pln">f</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">c</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">)</span><span class="">

      </span><span class="pun">(</span><span class="pln">tasks</span><span class="pun">.</span><span class="pln">toSeq</span><span class="pun">.</span><span class="pln">join</span><span class="pun">)</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">flatten</span><span class="pun">.</span><span class="pln">distinct</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">mapped</span><span class="pun">(</span><span class="pln">confString</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">masterConfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">default</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">defaultMapping</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">defaultMap</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">parseMapping</span><span class="pun">(</span><span class="pln">defaultMapping</span><span class="pun">,</span><span class=""> </span><span class="pln">masterConfs</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfs</span><span class="pun">,</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="">
      </span><span class="pln">parseMapping</span><span class="pun">(</span><span class="pln">confString</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">default</span><span class="pun">,</span><span class=""> </span><span class="pln">masterConfs</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfs</span><span class="pun">,</span><span class=""> </span><span class="pln">defaultMap</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">parseMapping</span><span class="pun">(</span><span class="pln">confString</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">masterConfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">default</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">union</span><span class="pun">(</span><span class="pln">confString</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">&#34;;&#34;</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">parseSingleMapping</span><span class="pun">(</span><span class="pln">masterConfs</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfs</span><span class="pun">,</span><span class=""> </span><span class="pln">default</span><span class="pun">)</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">parseSingleMapping</span><span class="pun">(</span><span class="pln">masterConfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">default</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="pln">confString</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">ms</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="pun">(</span><span class="typ">String</span><span class="">, </span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
        </span><span class="pln">trim</span><span class="pun">(</span><span class="pln">confString</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">&#34;-&gt;&#34;</span><span class="pun">,</span><span class=""> </span><span class="dec">2</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">x</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">parseList</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class=""> </span><span class="pln">masterConfs</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">yield</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">default</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pun">)</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">x</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">y</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
            </span><span class="kwd">val</span><span class=""> </span><span class="pln">target</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">parseList</span><span class="pun">(</span><span class="pln">y</span><span class="pun">,</span><span class=""> </span><span class="pln">depConfs</span><span class="pun">)</span><span class="pun">;</span><span class=""> </span><span class="kwd">for</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class=""> </span><span class="pun">&lt;-</span><span class=""> </span><span class="pln">parseList</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class=""> </span><span class="pln">masterConfs</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">yield</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">target</span><span class="pun">)</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">&#34;Invalid configuration &#39;&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">confString</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;&#39;&#34;</span><span class="pun">)</span><span class=""> </span><span class="com">// shouldn&#39;t get here</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">m</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ms</span><span class="pun">.</span><span class="pln">toMap</span><span class="">
      </span><span class="pln">s</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">m</span><span class="pun">.</span><span class="pln">getOrElse</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">union</span><span class="pun">[</span><span class="typ">A</span><span class="">, </span><span class="typ">B</span><span class="pun">]</span><span class="pun">(</span><span class="pln">maps</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">A</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">B</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">A</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">B</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">a</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">B</span><span class="pun">]</span><span class="pun">(</span><span class="pun">)</span><span class=""> </span><span class="pun">/:</span><span class=""> </span><span class="pln">maps</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="kwd">_</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class=""> </span><span class="pln">distinct</span><span class="pun">;</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">parseList</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">allConfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">trim</span><span class="pun">(</span><span class="pln">s</span><span class=""> </span><span class="pln">split</span><span class=""> </span><span class="str">&#34;,&#34;</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pln">replaceWildcard</span><span class="pun">(</span><span class="pln">allConfs</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">distinct</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">replaceWildcard</span><span class="pun">(</span><span class="pln">allConfs</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">conf</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="str">&#34;&#34;</span><span class="pun">)</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">conf</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="str">&#34;*&#34;</span><span class="pun">)</span><span class=""> </span><span class="pln">allConfs</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">conf</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="">

  </span><span class="kwd">private</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">trim</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class=""> </span><span class="pln">Array</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">List</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">a</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">trim</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">missingConfiguration</span><span class="pun">(</span><span class="pln">in</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">&#34;Configuration &#39;&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">conf</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;&#39; not defined in &#39;&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;&#39;&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">allConfigs</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Configuration</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">Dag</span><span class="pun">.</span><span class="pln">topologicalSort</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">extendsConfigs</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">getConfigurations</span><span class="pun">(</span><span class="pln">p</span><span class="pun">:</span><span class=""> </span><span class="pln">ResolvedReference</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Configuration</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">ivyConfigurations</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">p</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">data</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">Nil</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">confOpt</span><span class="pun">(</span><span class="pln">configurations</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Configuration</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">Configuration</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">configurations</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">name</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">conf</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">productsTask</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">:</span><span class=""> </span><span class="pln">ResolvedReference</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">getClasspath</span><span class="pun">(</span><span class="pln">exportedProducts</span><span class="pun">,</span><span class=""> </span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">unmanagedLibs</span><span class="pun">(</span><span class="pln">dep</span><span class="pun">:</span><span class=""> </span><span class="pln">ResolvedReference</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">getClasspath</span><span class="pun">(</span><span class="pln">unmanagedJars</span><span class="pun">,</span><span class=""> </span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">getClasspath</span><span class="pun">(</span><span class="pln">key</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">dep</span><span class="pun">:</span><span class=""> </span><span class="pln">ResolvedReference</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">key</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pun">(</span><span class="pln">dep</span><span class="pun">,</span><span class=""> </span><span class="pln">ConfigKey</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">data</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">constant</span><span class="pun">(</span><span class="pln">Nil</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">defaultConfigurationTask</span><span class="pun">(</span><span class="pln">p</span><span class="pun">:</span><span class=""> </span><span class="pln">ResolvedReference</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">:</span><span class=""> </span><span class="pln">Settings</span><span class="pun">[</span><span class="typ">Scope</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">flatten</span><span class="pun">(</span><span class="pln">defaultConfiguration</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">p</span><span class=""> </span><span class="pln">get</span><span class=""> </span><span class="pln">data</span><span class="pun">)</span><span class=""> </span><span class="pln">getOrElse</span><span class=""> </span><span class="pln">Configurations</span><span class="pun">.</span><span class="pln">Default</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">flatten</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">o</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">o</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pln">idFun</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">typesafeReleases</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">typesafeIvyRepo</span><span class="pun">(</span><span class="str">&#34;releases&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">typesafeSnapshots</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">typesafeIvyRepo</span><span class="pun">(</span><span class="str">&#34;snapshots&#34;</span><span class="pun">)</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use `typesafeReleases` instead&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.12.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">typesafeResolver</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">typesafeReleases</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use `Resolver.typesafeIvyRepo` instead&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.12.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">typesafeRepo</span><span class="pun">(</span><span class="pln">status</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">typesafeIvyRepo</span><span class="pun">(</span><span class="pln">status</span><span class="pun">)</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">sbtPluginReleases</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">sbtPluginRepo</span><span class="pun">(</span><span class="str">&#34;releases&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">sbtPluginSnapshots</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">sbtPluginRepo</span><span class="pun">(</span><span class="str">&#34;snapshots&#34;</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">modifyForPlugin</span><span class="pun">(</span><span class="pln">plugin</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">dep</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">plugin</span><span class="pun">)</span><span class=""> </span><span class="pln">dep</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">configurations</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">Provided</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">dep</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Explicitly specify the organization using the other variant.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">autoLibraryDependency</span><span class="pun">(</span><span class="pln">auto</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">plugin</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">version</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">auto</span><span class="pun">)</span><span class="">
      </span><span class="pln">modifyForPlugin</span><span class="pun">(</span><span class="pln">plugin</span><span class="pun">,</span><span class=""> </span><span class="pln">ScalaArtifacts</span><span class="pun">.</span><span class="pln">libraryDependency</span><span class="pun">(</span><span class="pln">version</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="">
    </span><span class="kwd">else</span><span class="">
      </span><span class="pln">Nil</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">autoLibraryDependency</span><span class="pun">(</span><span class="pln">auto</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">plugin</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">,</span><span class=""> </span><span class="pln">org</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">version</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">auto</span><span class="pun">)</span><span class="">
      </span><span class="pln">modifyForPlugin</span><span class="pun">(</span><span class="pln">plugin</span><span class="pun">,</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">(</span><span class="pln">org</span><span class="pun">,</span><span class=""> </span><span class="pln">ScalaArtifacts</span><span class="pun">.</span><span class="pln">LibraryID</span><span class="pun">,</span><span class=""> </span><span class="pln">version</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="">
    </span><span class="kwd">else</span><span class="">
      </span><span class="pln">Nil</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addUnmanagedLibrary</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">unmanagedJars</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">Compile</span><span class=""> </span><span class="pun">&lt;++=</span><span class=""> </span><span class="pln">unmanagedScalaLibrary</span><span class="">
  </span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">unmanagedScalaLibrary</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">taskDyn</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">autoScalaLibrary</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">scalaHome</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">isDefined</span><span class="pun">)</span><span class="">
        </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">scalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">libraryJar</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="kwd">else</span><span class="">
        </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">task</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">import</span><span class=""> </span><span class="pln">DependencyFilter._</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">managedJars</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">jarTypes</span><span class="pun">:</span><span class=""> </span><span class="pln">Set</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">up</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">up</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln">configurationFilter</span><span class="pun">(</span><span class="pln">config</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pln">artifactFilter</span><span class="pun">(</span><span class="pln">`type`</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">jarTypes</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toSeq</span><span class="pun">.</span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">conf</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">art</span><span class="pun">,</span><span class=""> </span><span class="pln">file</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="pln">Attributed</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pun">(</span><span class="pln">AttributeMap</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">artifact</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">art</span><span class="pun">)</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">moduleID</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">)</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class=""> </span><span class="pln">distinct</span><span class="pun">;</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">findUnmanagedJars</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">base</span><span class="pun">:</span><span class=""> </span><span class="pln">File</span><span class="pun">,</span><span class=""> </span><span class="pln">filter</span><span class="pun">:</span><span class=""> </span><span class="pln">FileFilter</span><span class="pun">,</span><span class=""> </span><span class="pln">excl</span><span class="pun">:</span><span class=""> </span><span class="pln">FileFilter</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">base</span><span class=""> </span><span class="pun">*</span><span class=""> </span><span class="pun">(</span><span class="pln">filter</span><span class=""> </span><span class="pun">--</span><span class=""> </span><span class="pln">excl</span><span class="pun">)</span><span class=""> </span><span class="pun">+++</span><span class=""> </span><span class="pun">(</span><span class="pln">base</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">config</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pun">.</span><span class="pln">descendantsExcept</span><span class="pun">(</span><span class="pln">filter</span><span class="pun">,</span><span class=""> </span><span class="pln">excl</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">classpath</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Specify the classpath that includes internal dependencies&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">autoPlugins</span><span class="pun">(</span><span class="pln">report</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">autoPlugins</span><span class="pun">(</span><span class="pln">report</span><span class="pun">,</span><span class=""> </span><span class="pln">Nil</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">autoPlugins</span><span class="pun">(</span><span class="pln">report</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">,</span><span class=""> </span><span class="pln">internalPluginClasspath</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">pluginClasspath</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">report</span><span class="pun">.</span><span class="pln">matching</span><span class="pun">(</span><span class="pln">configurationFilter</span><span class="pun">(</span><span class="pln">CompilerPlugin</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pun">)</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">internalPluginClasspath</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">plugins</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">sbt</span><span class="pun">.</span><span class="pln">internal</span><span class="pun">.</span><span class="pln">inc</span><span class="pun">.</span><span class="pln">classpath</span><span class="pun">.</span><span class="pln">ClasspathUtilities</span><span class="pun">.</span><span class="pln">compilerPlugins</span><span class="pun">(</span><span class="pln">pluginClasspath</span><span class="pun">)</span><span class="">
      </span><span class="pln">plugins</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="str">&#34;-Xplugin:&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="kwd">_</span><span class="pun">.</span><span class="pln">getAbsolutePath</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toSeq</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">internalCompilerPluginClasspath</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Classpath</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">thisProjectRef</span><span class="pun">,</span><span class=""> </span><span class="pln">settingsData</span><span class="pun">,</span><span class=""> </span><span class="pln">buildDependencies</span><span class="pun">)</span><span class=""> </span><span class="pln">flatMap</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">ref</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">internalDependencies0</span><span class="pun">(</span><span class="pln">ref</span><span class="pun">,</span><span class=""> </span><span class="pln">CompilerPlugin</span><span class="pun">,</span><span class=""> </span><span class="pln">CompilerPlugin</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">,</span><span class=""> </span><span class="pln">deps</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">lazy</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">compilerPluginConfig</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Seq</span><span class="pun">(</span><span class="">
    </span><span class="pln">scalacOptions</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">options</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">scalacOptions</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">newPlugins</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">autoPlugins</span><span class="pun">(</span><span class="pln">update</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">internalCompilerPluginClasspath</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">files</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">existing</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">options</span><span class="pun">.</span><span class="pln">toSet</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">autoCompilerPlugins</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class=""> </span><span class="pln">options</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">newPlugins</span><span class="pun">.</span><span class="pln">filterNot</span><span class="pun">(</span><span class="pln">existing</span><span class="pun">)</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">options</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="pun">)</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Doesn&#39;t properly handle non-standard Scala organizations.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">substituteScalaFiles</span><span class="pun">(</span><span class="pln">scalaInstance</span><span class="pun">:</span><span class=""> </span><span class="pln">ScalaInstance</span><span class="pun">,</span><span class=""> </span><span class="pln">report</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">substituteScalaFiles</span><span class="pun">(</span><span class="pln">scalaInstance</span><span class="pun">,</span><span class=""> </span><span class="pln">ScalaArtifacts</span><span class="pun">.</span><span class="pln">Organization</span><span class="pun">,</span><span class=""> </span><span class="pln">report</span><span class="pun">)</span><span class="">

  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Directly provide the jar files per Scala version.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">substituteScalaFiles</span><span class="pun">(</span><span class="pln">scalaInstance</span><span class="pun">:</span><span class=""> </span><span class="pln">ScalaInstance</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaOrg</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">report</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">substituteScalaFiles</span><span class="pun">(</span><span class="pln">scalaOrg</span><span class="pun">,</span><span class=""> </span><span class="pln">report</span><span class="pun">)</span><span class="pun">(</span><span class="pln">const</span><span class="pun">(</span><span class="pln">scalaInstance</span><span class="pun">.</span><span class="pln">allJars</span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">substituteScalaFiles</span><span class="pun">(</span><span class="pln">scalaOrg</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">report</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class="pun">)</span><span class="pun">(</span><span class="pln">scalaJars</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">UpdateReport</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">report</span><span class="pun">.</span><span class="pln">substitute</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">module</span><span class="pun">,</span><span class=""> </span><span class="pln">arts</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">module</span><span class="pun">.</span><span class="pln">organization</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">scalaOrg</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">jarName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">module</span><span class="pun">.</span><span class="pln">name</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;.jar&#34;</span><span class="">
        </span><span class="kwd">val</span><span class=""> </span><span class="pln">replaceWith</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">scalaJars</span><span class="pun">(</span><span class="pln">module</span><span class="pun">.</span><span class="pln">revision</span><span class="pun">)</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">getName</span><span class=""> </span><span class="pun">==</span><span class=""> </span><span class="pln">jarName</span><span class="pun">)</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">f</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">Artifact</span><span class="pun">(</span><span class="pln">f</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">.</span><span class="pln">stripSuffix</span><span class="pun">(</span><span class="str">&#34;.jar&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">f</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">replaceWith</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">)</span><span class=""> </span><span class="pln">arts</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">replaceWith</span><span class="">
      </span><span class="pun">}</span><span class=""> </span><span class="kwd">else</span><span class="">
        </span><span class="pln">arts</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="com">// try/catch for supporting earlier launchers</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">bootIvyHome</span><span class="pun">(</span><span class="pln">app</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">AppConfiguration</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">Option</span><span class="pun">(</span><span class="pln">app</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">launcher</span><span class="pun">.</span><span class="pln">ivyHome</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">NoSuchMethodError</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">None</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">bootChecksums</span><span class="pun">(</span><span class="pln">app</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">AppConfiguration</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">app</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">launcher</span><span class="pun">.</span><span class="pln">checksums</span><span class="pun">.</span><span class="pln">toSeq</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">NoSuchMethodError</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">IvySbt</span><span class="pun">.</span><span class="pln">DefaultChecksums</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">isOverrideRepositories</span><span class="pun">(</span><span class="pln">app</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">AppConfiguration</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pln">app</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">launcher</span><span class="pun">.</span><span class="pln">isOverrideRepositories</span><span class="">
    </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">NoSuchMethodError</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">false</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="com">/** Loads the `appRepositories` configured for this launcher, if supported. */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">appRepositories</span><span class="pun">(</span><span class="pln">app</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">AppConfiguration</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">Resolver</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">app</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">launcher</span><span class="pun">.</span><span class="pln">appRepositories</span><span class="pun">.</span><span class="pln">toSeq</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">bootRepository</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">NoSuchMethodError</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">None</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">bootRepositories</span><span class="pun">(</span><span class="pln">app</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">AppConfiguration</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">Resolver</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="pln">app</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="pln">scalaProvider</span><span class="pun">.</span><span class="pln">launcher</span><span class="pun">.</span><span class="pln">ivyRepositories</span><span class="pun">.</span><span class="pln">toSeq</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pln">bootRepository</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">NoSuchMethodError</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">None</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">mavenCompatible</span><span class="pun">(</span><span class="pln">ivyRepo</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">IvyRepository</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">ivyRepo</span><span class="pun">.</span><span class="pln">mavenCompatible</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">NoSuchMethodError</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">false</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">skipConsistencyCheck</span><span class="pun">(</span><span class="pln">ivyRepo</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">IvyRepository</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">ivyRepo</span><span class="pun">.</span><span class="pln">skipConsistencyCheck</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">NoSuchMethodError</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">false</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">descriptorOptional</span><span class="pun">(</span><span class="pln">ivyRepo</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">IvyRepository</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">ivyRepo</span><span class="pun">.</span><span class="pln">descriptorOptional</span><span class=""> </span><span class="pun">}</span><span class="">
    </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class="pun">:</span><span class=""> </span><span class="pln">NoSuchMethodError</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">false</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">bootRepository</span><span class="pun">(</span><span class="pln">repo</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">Repository</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Resolver</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">import</span><span class=""> </span><span class="pln">xsbti.Predefined</span><span class="">
      </span><span class="pln">repo</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">m</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">MavenRepository</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">MavenRepository</span><span class="pun">(</span><span class="pln">m</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class=""> </span><span class="pln">m</span><span class="pun">.</span><span class="pln">url</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">)</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">i</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">IvyRepository</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
          </span><span class="kwd">val</span><span class=""> </span><span class="pln">patterns</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Patterns</span><span class="pun">(</span><span class="pln">i</span><span class="pun">.</span><span class="pln">ivyPattern</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class="pun">.</span><span class="pln">artifactPattern</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class="pun">,</span><span class=""> </span><span class="pln">mavenCompatible</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">descriptorOptional</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">skipConsistencyCheck</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pun">)</span><span class="">
          </span><span class="pln">i</span><span class="pun">.</span><span class="pln">url</span><span class="pun">.</span><span class="pln">getProtocol</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="str">&#34;file&#34;</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
              </span><span class="com">// This hackery is to deal suitably with UNC paths on Windows. Once we can assume Java7, Paths should save us from this.</span><span class="">
              </span><span class="kwd">val</span><span class=""> </span><span class="pln">file</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">try</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">File</span><span class="pun">(</span><span class="pln">i</span><span class="pun">.</span><span class="pln">url</span><span class="pun">.</span><span class="pln">toURI</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class=""> </span><span class="kwd">catch</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="kwd">case</span><span class=""> </span><span class="pln">e</span><span class="pun">:</span><span class=""> </span><span class="pln">java</span><span class="pun">.</span><span class="pln">net</span><span class="pun">.</span><span class="pln">URISyntaxException</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">File</span><span class="pun">(</span><span class="pln">i</span><span class="pun">.</span><span class="pln">url</span><span class="pun">.</span><span class="pln">getPath</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
              </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">file</span><span class="pun">(</span><span class="pln">i</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class=""> </span><span class="pln">file</span><span class="pun">)</span><span class="pun">(</span><span class="pln">patterns</span><span class="pun">)</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">url</span><span class="pun">(</span><span class="pln">i</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class="pun">.</span><span class="pln">url</span><span class="pun">)</span><span class="pun">(</span><span class="pln">patterns</span><span class="pun">)</span><span class="">
          </span><span class="pun">}</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pln">p</span><span class="pun">:</span><span class=""> </span><span class="pln">xsbti</span><span class="pun">.</span><span class="pln">PredefinedRepository</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">p</span><span class="pun">.</span><span class="pln">id</span><span class=""> </span><span class="kwd">match</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Predefined</span><span class="pun">.</span><span class="pln">Local</span><span class="">                </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">defaultLocal</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Predefined</span><span class="pun">.</span><span class="pln">MavenLocal</span><span class="">           </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">mavenLocal</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Predefined</span><span class="pun">.</span><span class="pln">MavenCentral</span><span class="">         </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">DefaultMavenRepository</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Predefined</span><span class="pun">.</span><span class="pln">ScalaToolsReleases</span><span class="">   </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">ScalaToolsReleases</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Predefined</span><span class="pun">.</span><span class="pln">ScalaToolsSnapshots</span><span class="">  </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">ScalaToolsSnapshots</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Predefined</span><span class="pun">.</span><span class="pln">SonatypeOSSReleases</span><span class="">  </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">sonatypeRepo</span><span class="pun">(</span><span class="str">&#34;releases&#34;</span><span class="pun">)</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">Predefined</span><span class="pun">.</span><span class="pln">SonatypeOSSSnapshots</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Resolver</span><span class="pun">.</span><span class="pln">sonatypeRepo</span><span class="pun">(</span><span class="str">&#34;snapshots&#34;</span><span class="pun">)</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pln">unknown</span><span class="">                         </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">sys</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">&#34;Unknown predefined resolver &#39;&#34;</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="pln">unknown</span><span class=""> </span><span class="pun">+</span><span class=""> </span><span class="str">&#34;&#39;.  This resolver may only be supported in newer sbt versions.&#34;</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
</span><span class="pun">}</span><span class="">

</span><span class="kwd">trait</span><span class=""> </span><span class="pln">BuildExtra</span><span class=""> </span><span class="kwd">extends</span><span class=""> </span><span class="pln">BuildCommon</span><span class=""> </span><span class="kwd">with</span><span class=""> </span><span class="pln">DefExtra</span><span class=""> </span><span class="pun">{</span><span class="">
  </span><span class="kwd">import</span><span class=""> </span><span class="pln">Defaults._</span><span class="">

  </span><span class="com">/**
   * Defines an alias given by `name` that expands to `value`.
   * This alias is defined globally after projects are loaded.
   * The alias is undefined when projects are unloaded.
   * Names are restricted to be either alphanumeric or completely symbolic.
   * As an exception, &#39;-&#39; and &#39;_&#39; are allowed within an alphanumeric name.
   */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addCommandAlias</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">value</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="typ">State</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">State</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">add</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">BasicCommands</span><span class="pun">.</span><span class="pln">addAlias</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">value</span><span class="pun">)</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">remove</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">BasicCommands</span><span class="pun">.</span><span class="pln">removeAlias</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">name</span><span class="pun">)</span><span class="">
      </span><span class="kwd">def</span><span class=""> </span><span class="pln">compose</span><span class="pun">(</span><span class="pln">setting</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">[</span><span class="typ">State</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">State</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">setting</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">Global</span><span class=""> </span><span class="pun">~=</span><span class=""> </span><span class="pun">(</span><span class="kwd">_</span><span class=""> </span><span class="pln">compose</span><span class=""> </span><span class="pln">f</span><span class="pun">)</span><span class="">
      </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">compose</span><span class="pun">(</span><span class="pln">onLoad</span><span class="pun">,</span><span class=""> </span><span class="pln">add</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">compose</span><span class="pun">(</span><span class="pln">onUnload</span><span class="pun">,</span><span class=""> </span><span class="pln">remove</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="com">/**
   * Adds Maven resolver plugin.
   */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addMavenResolverPlugin</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">libraryDependencies</span><span class=""> </span><span class="pun">+=</span><span class=""> </span><span class="pln">sbtPluginExtra</span><span class="pun">(</span><span class="pln">ModuleID</span><span class="pun">(</span><span class="str">&#34;org.scala-sbt&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;sbt-maven-resolver&#34;</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtBinaryVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBinaryVersion</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">

  </span><span class="com">/**
   * Adds `dependency` as an sbt plugin for the specific sbt version `sbtVersion` and Scala version `scalaVersion`.
   * Typically, use the default values for these versions instead of specifying them explicitly.
   */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addSbtPlugin</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtVersion</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaVersion</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">libraryDependencies</span><span class=""> </span><span class="pun">+=</span><span class=""> </span><span class="pln">sbtPluginExtra</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtVersion</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaVersion</span><span class="pun">)</span><span class="">

  </span><span class="com">/**
   * Adds `dependency` as an sbt plugin for the specific sbt version `sbtVersion`.
   * Typically, use the default value for this version instead of specifying it explicitly.
   */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addSbtPlugin</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtVersion</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">libraryDependencies</span><span class=""> </span><span class="pun">&lt;+=</span><span class=""> </span><span class="pun">(</span><span class="pln">scalaBinaryVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">scalaV</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">sbtPluginExtra</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtVersion</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaV</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="com">/**
   * Adds `dependency` as an sbt plugin for the sbt and Scala versions configured by
   * `sbtBinaryVersion` and `scalaBinaryVersion` scoped to `update`.
   */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addSbtPlugin</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">libraryDependencies</span><span class=""> </span><span class="pun">&lt;+=</span><span class=""> </span><span class="pun">(</span><span class="pln">sbtBinaryVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaBinaryVersion</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">update</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">sbtV</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaV</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">sbtPluginExtra</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">,</span><span class=""> </span><span class="pln">sbtV</span><span class="pun">,</span><span class=""> </span><span class="pln">scalaV</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="com">/** Transforms `dependency` to be in the auto-compiler plugin configuration. */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">compilerPlugin</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">dependency</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">(</span><span class="pln">configurations</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Some</span><span class="pun">(</span><span class="str">&#34;plugin-&gt;default(compile)&#34;</span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="com">/** Adds `dependency` to `libraryDependencies` in the auto-compiler plugin configuration. */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addCompilerPlugin</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">:</span><span class=""> </span><span class="pln">ModuleID</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">ModuleID</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">libraryDependencies</span><span class=""> </span><span class="pun">+=</span><span class=""> </span><span class="pln">compilerPlugin</span><span class="pun">(</span><span class="pln">dependency</span><span class="pun">)</span><span class="">

  </span><span class="com">/** Constructs a setting that declares a new artifact `a` that is generated by `taskDef`. */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addArtifact</span><span class="pun">(</span><span class="pln">a</span><span class="pun">:</span><span class=""> </span><span class="pln">Artifact</span><span class="pun">,</span><span class=""> </span><span class="pln">taskDef</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingsDefinition</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">pkgd</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">packagedArtifacts</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">packagedArtifacts</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">updated</span><span class=""> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">taskDef</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
      </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">artifacts</span><span class=""> </span><span class="pun">+=</span><span class=""> </span><span class="pln">a</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgd</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="com">/** Constructs a setting that declares a new artifact `artifact` that is generated by `taskDef`. */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">addArtifact</span><span class="pun">(</span><span class="pln">artifact</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Artifact</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">taskDef</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingsDefinition</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">artLocal</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">SettingKey</span><span class="pun">.</span><span class="pln">local</span><span class="pun">[</span><span class="typ">Artifact</span><span class="pun">]</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">taskLocal</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">.</span><span class="pln">local</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">art</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">artifacts</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">artLocal</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">+:</span><span class=""> </span><span class="pln">artifacts</span><span class="pun">.</span><span class="pln">value</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">pkgd</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">packagedArtifacts</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">packagedArtifacts</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pln">updated</span><span class=""> </span><span class="pun">(</span><span class="pln">artLocal</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">taskLocal</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
      </span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">artLocal</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">artifact</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">taskLocal</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="pln">taskDef</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">art</span><span class="pun">,</span><span class=""> </span><span class="pln">pkgd</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="com">// because this was commonly used, this might need to be kept longer than usual</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;In build.sbt files, this call can be removed.  In other cases, this can usually be replaced by Seq.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">seq</span><span class="pun">(</span><span class="pln">settings</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">*</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">SettingsDefinition</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">SettingList</span><span class="pun">(</span><span class="pln">settings</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">externalIvySettings</span><span class="pun">(</span><span class="pln">file</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inBase</span><span class="pun">(</span><span class="str">&#34;ivysettings.xml&#34;</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">addMultiResolver</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">IvyConfiguration</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">externalIvySettingsURI</span><span class="pun">(</span><span class="pln">file</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">toURI</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">addMultiResolver</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">externalIvySettingsURL</span><span class="pun">(</span><span class="pln">url</span><span class="pun">:</span><span class=""> </span><span class="pln">URL</span><span class="pun">,</span><span class=""> </span><span class="pln">addMultiResolver</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">IvyConfiguration</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">externalIvySettingsURI</span><span class="pun">(</span><span class="pln">Def</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="pln">url</span><span class="pun">.</span><span class="pln">toURI</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">addMultiResolver</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">externalIvySettingsURI</span><span class="pun">(</span><span class="pln">uri</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">URI</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">addMultiResolver</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">IvyConfiguration</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">other</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pun">(</span><span class="pln">baseDirectory</span><span class="pun">,</span><span class=""> </span><span class="pln">appConfiguration</span><span class="pun">,</span><span class=""> </span><span class="pln">projectResolver</span><span class="pun">,</span><span class=""> </span><span class="pln">updateOptions</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class="pun">.</span><span class="pln">identityMap</span><span class="">
      </span><span class="pln">ivyConfiguration</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pun">(</span><span class="pln">uri</span><span class=""> </span><span class="pln">zipWith</span><span class=""> </span><span class="pln">other</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
        </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">u</span><span class="pun">,</span><span class=""> </span><span class="pln">otherTask</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
          </span><span class="pln">otherTask</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
            </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">base</span><span class="pun">,</span><span class=""> </span><span class="pln">app</span><span class="pun">,</span><span class=""> </span><span class="pln">pr</span><span class="pun">,</span><span class=""> </span><span class="pln">uo</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
              </span><span class="kwd">val</span><span class=""> </span><span class="pln">extraResolvers</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">if</span><span class=""> </span><span class="pun">(</span><span class="pln">addMultiResolver</span><span class="pun">)</span><span class=""> </span><span class="pln">pr</span><span class=""> </span><span class="pun">::</span><span class=""> </span><span class="pln">Nil</span><span class=""> </span><span class="kwd">else</span><span class=""> </span><span class="pln">Nil</span><span class="">
              </span><span class="kwd">new</span><span class=""> </span><span class="pln">ExternalIvyConfiguration</span><span class="pun">(</span><span class="pln">base</span><span class="pun">,</span><span class=""> </span><span class="pln">u</span><span class="pun">,</span><span class=""> </span><span class="pln">Option</span><span class="pun">(</span><span class="pln">lock</span><span class="pun">(</span><span class="pln">app</span><span class="pun">)</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">extraResolvers</span><span class="pun">,</span><span class=""> </span><span class="pln">uo</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="">
          </span><span class="pun">}</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">inBase</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">setting</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">baseDirectory</span><span class="pun">.</span><span class="pln">value</span><span class=""> </span><span class="pun">/</span><span class=""> </span><span class="pln">name</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">externalIvyFile</span><span class="pun">(</span><span class="pln">file</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inBase</span><span class="pun">(</span><span class="str">&#34;ivy.xml&#34;</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">iScala</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Option</span><span class="pun">[</span><span class="typ">IvyScala</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyScala</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ModuleSettings</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">moduleSettings</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">IvyFileConfiguration</span><span class="pun">(</span><span class="pln">file</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">iScala</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyValidate</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">managedScalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">externalPom</span><span class="pun">(</span><span class="pln">file</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inBase</span><span class="pun">(</span><span class="str">&#34;pom.xml&#34;</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">iScala</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Option</span><span class="pun">[</span><span class="typ">IvyScala</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ivyScala</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">ModuleSettings</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">moduleSettings</span><span class=""> </span><span class="pun">:=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">PomConfiguration</span><span class="pun">(</span><span class="pln">file</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyScala</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">ivyValidate</span><span class="pun">.</span><span class="pln">value</span><span class="pun">,</span><span class=""> </span><span class="pln">managedScalaInstance</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">runInputTask</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClass</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">baseArguments</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">*</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">InputTask</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">inputTask</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">result</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pun">(</span><span class="pln">fullClasspath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">runner</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pun">(</span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">run</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">,</span><span class=""> </span><span class="pln">result</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">r</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">args</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="pln">toError</span><span class="pun">(</span><span class="pln">r</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">mainClass</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">baseArguments</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">args</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">)</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">runTask</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClass</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">arguments</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">*</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">fullClasspath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">runner</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pun">(</span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">run</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">r</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pln">toError</span><span class="pun">(</span><span class="pln">r</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">mainClass</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">arguments</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">)</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">fullRunInputTask</span><span class="pun">(</span><span class="pln">scoped</span><span class="pun">:</span><span class=""> </span><span class="pln">InputKey</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClass</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">baseArguments</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">*</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">InputTask</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">scoped</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">inputTask</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">result</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
      </span><span class="pun">(</span><span class="pln">initScoped</span><span class="pun">(</span><span class="pln">scoped</span><span class="pun">.</span><span class="pln">scopedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">runnerInit</span><span class="pun">)</span><span class=""> </span><span class="pln">zipWith</span><span class=""> </span><span class="pun">(</span><span class="pln">fullClasspath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">,</span><span class=""> </span><span class="pln">result</span><span class="pun">)</span><span class="pun">.</span><span class="pln">identityMap</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">rTask</span><span class="pun">,</span><span class=""> </span><span class="pln">t</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="pun">(</span><span class="pln">t</span><span class="pun">,</span><span class=""> </span><span class="pln">rTask</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">args</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">r</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
            </span><span class="pln">toError</span><span class="pun">(</span><span class="pln">r</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">mainClass</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">baseArguments</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">args</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
      </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">fullRunTask</span><span class="pun">(</span><span class="pln">scoped</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">,</span><span class=""> </span><span class="pln">mainClass</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">,</span><span class=""> </span><span class="pln">arguments</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">*</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Unit</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">scoped</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pun">(</span><span class="pln">initScoped</span><span class="pun">(</span><span class="pln">scoped</span><span class="pun">.</span><span class="pln">scopedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">runnerInit</span><span class="pun">)</span><span class=""> </span><span class="pln">zipWith</span><span class=""> </span><span class="pun">(</span><span class="pln">fullClasspath</span><span class=""> </span><span class="pln">in</span><span class=""> </span><span class="pln">config</span><span class="pun">,</span><span class=""> </span><span class="pln">streams</span><span class="pun">)</span><span class="pun">.</span><span class="pln">identityMap</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
      </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pln">rTask</span><span class="pun">,</span><span class=""> </span><span class="pln">t</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
        </span><span class="pun">(</span><span class="pln">t</span><span class="pun">,</span><span class=""> </span><span class="pln">rTask</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class="">
          </span><span class="kwd">case</span><span class=""> </span><span class="pun">(</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">r</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class="">
            </span><span class="pln">toError</span><span class="pun">(</span><span class="pln">r</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="pln">mainClass</span><span class="pun">,</span><span class=""> </span><span class="pln">data</span><span class="pun">(</span><span class="pln">cp</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">arguments</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">log</span><span class="pun">)</span><span class="pun">)</span><span class="">
        </span><span class="pun">}</span><span class="">
    </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">initScoped</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">sk</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">initScope</span><span class="pun">(</span><span class="pln">fillTaskAxis</span><span class="pun">(</span><span class="pln">sk</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">,</span><span class=""> </span><span class="pln">sk</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">initScope</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Scope</span><span class="pun">,</span><span class=""> </span><span class="pln">i</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">i</span><span class=""> </span><span class="pln">mapReferenced</span><span class=""> </span><span class="pln">Project</span><span class="pun">.</span><span class="pln">mapScope</span><span class="pun">(</span><span class="pln">Scope</span><span class="pun">.</span><span class="pln">replaceThis</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="com">/**
   * Disables post-compilation hook for determining tests for tab-completion (such as for &#39;test-only&#39;).
   * This is useful for reducing test:compile time when not running test.
   */</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">noTestCompletion</span><span class="pun">(</span><span class="pln">config</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Test</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">inConfig</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Seq</span><span class="pun">(</span><span class="pln">definedTests</span><span class=""> </span><span class="pun">&lt;&lt;=</span><span class=""> </span><span class="pln">detectTests</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">head</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">filterKeys</span><span class="pun">(</span><span class="pln">ss</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">transitive</span><span class="pun">:</span><span class=""> </span><span class="pln">Boolean</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">false</span><span class="pun">)</span><span class="pun">(</span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Boolean</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Setting</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">ss</span><span class=""> </span><span class="pln">filter</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">f</span><span class="pun">(</span><span class="pln">s</span><span class="pun">.</span><span class="pln">key</span><span class="pun">)</span><span class=""> </span><span class="pun">&amp;&amp;</span><span class=""> </span><span class="pun">(</span><span class="pun">!</span><span class="pln">transitive</span><span class=""> </span><span class="pun">||</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">dependencies</span><span class="pun">.</span><span class="pln">forall</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="">
</span><span class="pun">}</span><span class="">
</span><span class="kwd">trait</span><span class=""> </span><span class="pln">DefExtra</span><span class=""> </span><span class="pun">{</span><span class="">
  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">this</span><span class="pun">]</span><span class=""> </span><span class="kwd">val</span><span class=""> </span><span class="pln">ts</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskSequential</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">TaskSequential</span><span class=""> </span><span class="pun">{</span><span class="pun">}</span><span class="">
  </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">toTaskSequential</span><span class="pun">(</span><span class="pln">d</span><span class="pun">:</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="kwd">type</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskSequential</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">ts</span><span class="">
</span><span class="pun">}</span><span class="">
</span><span class="kwd">trait</span><span class=""> </span><span class="pln">BuildCommon</span><span class=""> </span><span class="pun">{</span><span class="">
  </span><span class="pln">@deprecated</span><span class="pun">(</span><span class="str">&#34;Use Def.inputTask with the `Def.spaceDelimited()` parser.&#34;</span><span class="pun">,</span><span class=""> </span><span class="str">&#34;0.13.0&#34;</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">inputTask</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">Seq</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">InputTask</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">InputTask</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="pln">Def</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">spaceDelimited</span><span class="pun">(</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class="">

  </span><span class="com">/**
   * Allows a String to be used where a `NameFilter` is expected.
   * Asterisks (`*`) in the string are interpreted as wildcards.
   * All other characters must match exactly.  See [[sbt.GlobFilter]].
   */</span><span class="">
  </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">globFilter</span><span class="pun">(</span><span class="pln">expression</span><span class="pun">:</span><span class=""> </span><span class="pln">String</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">NameFilter</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">GlobFilter</span><span class="pun">(</span><span class="pln">expression</span><span class="pun">)</span><span class="">

  </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">richAttributed</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Attributed</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">RichAttributed</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">RichAttributed</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="">
  </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">richFiles</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">RichFiles</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">RichFiles</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="">
  </span><span class="kwd">implicit</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">richPathFinder</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">PathFinder</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">RichPathFinder</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">new</span><span class=""> </span><span class="pln">RichPathFinder</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="">
  </span><span class="kwd">final</span><span class=""> </span><span class="kwd">class</span><span class=""> </span><span class="pln">RichPathFinder</span><span class=""> </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">PathFinder</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="com">/** Converts the `PathFinder` to a `Classpath`, which is an alias for `Seq[Attributed[File]]`. */</span><span class="">
    </span><span class="kwd">def</span><span class=""> </span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Attributed</span><span class=""> </span><span class="pln">blankSeq</span><span class=""> </span><span class="pln">s</span><span class="pun">.</span><span class="pln">get</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">final</span><span class=""> </span><span class="kwd">class</span><span class=""> </span><span class="pln">RichAttributed</span><span class=""> </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Attributed</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="com">/** Extracts the plain `Seq[File]` from a Classpath (which is a `Seq[Attributed[File]]`).*/</span><span class="">
    </span><span class="kwd">def</span><span class=""> </span><span class="pln">files</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Attributed</span><span class="pun">.</span><span class="pln">data</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">final</span><span class=""> </span><span class="kwd">class</span><span class=""> </span><span class="pln">RichFiles</span><span class=""> </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">File</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">{</span><span class="">
    </span><span class="com">/** Converts the `Seq[File]` to a Classpath, which is an alias for `Seq[Attributed[File]]`. */</span><span class="">
    </span><span class="kwd">def</span><span class=""> </span><span class="pln">classpath</span><span class="pun">:</span><span class=""> </span><span class="pln">Classpath</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Attributed</span><span class=""> </span><span class="pln">blankSeq</span><span class=""> </span><span class="pln">s</span><span class="">
  </span><span class="pun">}</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">toError</span><span class="pun">(</span><span class="pln">o</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">String</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Unit</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">o</span><span class=""> </span><span class="pln">foreach</span><span class=""> </span><span class="pln">error</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">overrideConfigs</span><span class="pun">(</span><span class="pln">cs</span><span class="pun">:</span><span class=""> </span><span class="pln">Configuration</span><span class="pun">*</span><span class="pun">)</span><span class="pun">(</span><span class="pln">configurations</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Configuration</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Seq</span><span class="pun">[</span><span class="typ">Configuration</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">{</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">existingName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">configurations</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">_</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toSet</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">newByName</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cs</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln">c</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">c</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">c</span><span class="pun">)</span><span class="pun">)</span><span class="pun">.</span><span class="pln">toMap</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">overridden</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">configurations</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">conf</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">newByName</span><span class="pun">.</span><span class="pln">getOrElse</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class=""> </span><span class="pln">conf</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="kwd">val</span><span class=""> </span><span class="pln">newConfigs</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">cs</span><span class=""> </span><span class="pln">filter</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pln">c</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">!</span><span class="pln">existingName</span><span class="pun">(</span><span class="pln">c</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">
      </span><span class="pln">overridden</span><span class=""> </span><span class="pun">++</span><span class=""> </span><span class="pln">newConfigs</span><span class="">
    </span><span class="pun">}</span><span class="">

  </span><span class="com">// these are intended for use in input tasks for creating parsers</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">getFromContext</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">context</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">SessionVar</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln">SessionVar</span><span class="pun">.</span><span class="pln">resolveContext</span><span class="pun">(</span><span class="pln">task</span><span class="pun">.</span><span class="pln">scopedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">context</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">loadFromContext</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">context</span><span class="pun">:</span><span class=""> </span><span class="pln">ScopedKey</span><span class="pun">[</span><span class="kwd">_</span><span class="pun">]</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">implicit</span><span class=""> </span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">sbinary</span><span class="pun">.</span><span class="pln">Format</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">SessionVar</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln">SessionVar</span><span class="pun">.</span><span class="pln">resolveContext</span><span class="pun">(</span><span class="pln">task</span><span class="pun">.</span><span class="pln">scopedKey</span><span class="pun">,</span><span class=""> </span><span class="pln">context</span><span class="pun">.</span><span class="pln">scope</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="">

  </span><span class="com">// intended for use in constructing InputTasks</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">loadForParser</span><span class="pun">[</span><span class="typ">P</span><span class="">, </span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pun">(</span><span class="pln">State</span><span class="pun">,</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Parser</span><span class="pun">[</span><span class="typ">P</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">implicit</span><span class=""> </span><span class="pln">format</span><span class="pun">:</span><span class=""> </span><span class="pln">sbinary</span><span class="pun">.</span><span class="pln">Format</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">State</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Parser</span><span class="pun">[</span><span class="typ">P</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">loadForParserI</span><span class="pun">(</span><span class="pln">task</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Def</span><span class=""> </span><span class="pln">value</span><span class=""> </span><span class="pln">f</span><span class="pun">)</span><span class="pun">(</span><span class="pln">format</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">loadForParserI</span><span class="pun">[</span><span class="typ">P</span><span class="">, </span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="pln">init</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="pun">(</span><span class="typ">State</span><span class="">, </span><span class="typ">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Parser</span><span class="pun">[</span><span class="typ">P</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">implicit</span><span class=""> </span><span class="pln">format</span><span class="pun">:</span><span class=""> </span><span class="pln">sbinary</span><span class="pun">.</span><span class="pln">Format</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">State</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Parser</span><span class="pun">[</span><span class="typ">P</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">resolvedScoped</span><span class="pun">,</span><span class=""> </span><span class="pln">init</span><span class="pun">)</span><span class="pun">(</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class=""> </span><span class="pln">f</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">f</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">loadFromContext</span><span class="pun">(</span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">ctx</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="pun">(</span><span class="pln">format</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">getForParser</span><span class="pun">[</span><span class="typ">P</span><span class="">, </span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="pln">init</span><span class="pun">:</span><span class=""> </span><span class="pun">(</span><span class="pln">State</span><span class="pun">,</span><span class=""> </span><span class="pln">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">Parser</span><span class="pun">[</span><span class="typ">P</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">State</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Parser</span><span class="pun">[</span><span class="typ">P</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pln">getForParserI</span><span class="pun">(</span><span class="pln">task</span><span class="pun">)</span><span class="pun">(</span><span class="pln">Def</span><span class=""> </span><span class="pln">value</span><span class=""> </span><span class="pln">init</span><span class="pun">)</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">getForParserI</span><span class="pun">[</span><span class="typ">P</span><span class="">, </span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="pln">init</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="pun">(</span><span class="typ">State</span><span class="">, </span><span class="typ">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Parser</span><span class="pun">[</span><span class="typ">P</span><span class="pun">]</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">State</span><span class=""> </span><span class="kwd">=&gt;</span><span class=""> </span><span class="typ">Parser</span><span class="pun">[</span><span class="typ">P</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">resolvedScoped</span><span class="pun">,</span><span class=""> </span><span class="pln">init</span><span class="pun">)</span><span class="pun">(</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class=""> </span><span class="pln">f</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">State</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">f</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">getFromContext</span><span class="pun">(</span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">ctx</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="pun">)</span><span class="pun">)</span><span class="">

  </span><span class="com">// these are for use for constructing Tasks</span><span class="">
  </span><span class="kwd">def</span><span class=""> </span><span class="pln">loadPrevious</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">(</span><span class="kwd">implicit</span><span class=""> </span><span class="pln">f</span><span class="pun">:</span><span class=""> </span><span class="pln">sbinary</span><span class="pun">.</span><span class="pln">Format</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">resolvedScoped</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">ctx</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">loadFromContext</span><span class="pun">(</span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">ctx</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">def</span><span class=""> </span><span class="pln">getPrevious</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">task</span><span class="pun">:</span><span class=""> </span><span class="pln">TaskKey</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Initialize</span><span class="pun">[</span><span class="typ">Task</span><span class="pun">[</span><span class="typ">Option</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">]</span><span class="pun">]</span><span class=""> </span><span class="kwd">=</span><span class="">
    </span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class=""> </span><span class="pln">resolvedScoped</span><span class="pun">)</span><span class=""> </span><span class="pln">map</span><span class=""> </span><span class="pun">{</span><span class=""> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">ctx</span><span class="pun">)</span><span class=""> </span><span class="pun">=&gt;</span><span class=""> </span><span class="pln">getFromContext</span><span class="pun">(</span><span class="pln">task</span><span class="pun">,</span><span class=""> </span><span class="pln">ctx</span><span class="pun">,</span><span class=""> </span><span class="pln">s</span><span class="pun">)</span><span class=""> </span><span class="pun">}</span><span class="">

  </span><span class="kwd">private</span><span class="pun">[</span><span class="typ">sbt</span><span class="pun">]</span><span class=""> </span><span class="kwd">def</span><span class=""> </span><span class="pln">derive</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">(</span><span class="pln">s</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class="pun">)</span><span class="pun">:</span><span class=""> </span><span class="pln">Setting</span><span class="pun">[</span><span class="typ">T</span><span class="pun">]</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="pln">Def</span><span class="pun">.</span><span class="pln">derive</span><span class="pun">(</span><span class="pln">s</span><span class="pun">,</span><span class=""> </span><span class="pln">allowDynamic</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">,</span><span class=""> </span><span class="pln">trigger</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">_</span><span class=""> </span><span class="pun">!=</span><span class=""> </span><span class="pln">streams</span><span class="pun">.</span><span class="pln">key</span><span class="pun">,</span><span class=""> </span><span class="pln">default</span><span class=""> </span><span class="pun">=</span><span class=""> </span><span class="kwd">true</span><span class="pun">)</span><span class="">
</span><span class="pun">}</span>

