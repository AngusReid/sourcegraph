{{define "Head"}}<title>Sourcegraph</title>
{{end}}

{{define "Body"}}
<br/>
{{if eq .AppURL.String "http://src.sourcegraph.com"}}
<div class="row">
	<div class="col-md-12">
		<h5>New to Sourcegraph? <a href="https://src.sourcegraph.com/sourcegraph/.docs/getting-started/">Getting started</a> is easy!</h5>
	</div>
</div>
<br>
{{end}}
{{if (and .MirrorsNext .CurrentUser (or .LinkGitHub .OnWaitlist))}}
	{{if .LinkGitHub}}
	<div class="row">
		<div class="col-md-offset-3 col-md-6">
			<br>
			<div class="well oauth-provider">
				<h1>Welcome to Sourcegraph!</h1>
				<p>Link your GitHub account to add your code to Sourcegraph</p>
				<form action={{router.URLToGitHubOAuth}} method="get">
					<div class="form-group">
						<button type="submit" class="btn btn-sgblue btn-lg">Link GitHub Account</button>
					</div>
				</form>
				<div class="clearfix"></div>
			</div>
		</div>
	</div>
	{{else}}
	<div class="row">
		<div class="col-md-offset-3 col-md-6">
			<br>
			<div class="well oauth-provider">
				<h1>You're on the waitlist!</h1>
				<p>Look out for an email from us when you get access. Feel free to explore public repositories till then.</p>
				<div class="clearfix"></div>
			</div>
		</div>
	</div>
	{{end}}
{{else}}
{{$hasUsers := (or .MirrorsNext .Users)}}
<div class="row dashboard">
	<div class="col-md-{{if $hasUsers}}6{{else}}12{{end}}">
		<h3>Repositories
			{{if (and .Repos (not .MirrorsNext))}}
				<button class="btn btn-default" data-toggle="collapse" data-target="#addRepo"><i class="fa fa-plus"></i></button>
			{{end}}
		</h3>
		{{if not .MirrorsNext}}
		<div {{if .Repos}}class="collapse"{{end}} id="addRepo">
			<div class="well">
				<form action={{router.URLToRepoCreate}} method="post">
					<div class="form-group">
						<label for="repo-name-input">Create a repository:</label> <input type="text" name="repo-name" id="repo-name-input" placeholder="e.g. my-project" class="form-control">
					</div>
					<div class="form-group">
						<button type="submit" class="btn btn-sgblue">Create</button>
					</div>
					<input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
				</form>
				<br>
			</div>
		</div>
		{{end}}
		<div class="list-group repos">
			{{range .Repos}}
				<a class="list-group-item" href="{{urlToRepo .URI}}">
					<h4>{{template "RepoIcon" .}} {{template "RepoLabel" (repoLabelForOwner "" .URI)}}</h4>
					{{with .Description}}<p class="description">{{.}}</p>{{end}}
					{{with .PushedAt}}<p class="updated">Updated {{template "TimeAgo" .}}</p>{{end}}
				</a>
			{{end}}
		</div>
		{{if (and .MirrorsNext $.CurrentUser (not appconf.DisableIntegrations))}}
			{{with .MirrorData}}
			<h4>GitHub repositories available for mirroring</h4>
			{{if (or .PrivateRepos .PublicRepos)}}
			<div class="repo-list">
				<form action="{{urlTo "person.settings.integrations.update" "User" $.CurrentUser.Login "Integration" "enable"}}" method="POST">
					<table class="table repo-list">
						<tr>
							<td align="right">
								select all:
							</td>
							<td>
								<input type="checkbox" id="check-all-repos" name="check-all-repos" value="" >
							</td>
						</tr>
						{{$host := .Host}}
						<tr>
							<td>
								<h4>Private</h4>
							</td>
							<td></td>
						</tr>
						{{range $repo := .PrivateRepos}}
							{{if not $repo.ExistsLocally}}
							<tr>
								<td>
									{{trimPrefix $repo.URI $host}}
									<a href="https://{{$repo.URI}}" target="_blank"><i class="fa fa-github github-link"></i></a>
								</td>
								<td>
									<input type="checkbox" name="RepoURI[]" value="{{$repo.URI}},private" >
								</td>
							</tr>
							{{end}}
						{{end}}
						<tr>
							<td>
								<h4>Public</h4>
							</td>
							<td></td>
						</tr>
						{{range $repo := .PublicRepos}}
							{{if not $repo.ExistsLocally}}
							<tr>
								<td>
									{{trimPrefix $repo.URI $host}}
									<a href="https://{{$repo.URI}}" target="_blank"><i class="fa fa-github github-link"></i></a>
								</td>
								<td>
									<input type="checkbox" name="RepoURI[]" value="{{$repo.URI}},public" >
								</td>
							</tr>
							{{end}}
						{{end}}
						<tr>
							<td></td>
							<td>
								<input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
								<button type="submit" class="btn btn-success">Add</button>
							</td>
						</tr>
					</table>
				</form>
			</div>
			{{end}}
			{{end}}
		{{end}}
	</div>
	<div class="col-md-6">
		{{if .MirrorsNext}}
		<h3>Teammates <button class="btn btn-default" data-toggle="collapse" data-target="#addTeammate"><i class="fa fa-plus"></i></button></h3>
		<div class="collapse" id="addTeammate">
			<div class="well">
				<strong>Invite</strong> your teammates:
				<ul id="teammate-invites-list" class="list-group">
				</ul>
				<form action="javascript:void(0);" class="form-inline">
					<input name="Email" type="email" class="input-xlarge form-control" id="teammate-invite-email" placeholder="user@example.com" value="" required tabindex=1 autofocus>
					<button type="submit" id="teammate-invite-btn" class="btn btn-md btn-sgblue" name="Invite" value="Invite" tabindex=3>Invite</button>
					<input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
				</form>
			</div>
		</div>
		<h4>On Sourcegraph</h4>
		<div class="list-group">
			{{range .Teammates.LinkedUsers}}
				<li class="list-group-item">
					{{if .AvatarURL}}<img src="{{.AvatarURL}}" class="avatar img-rounded" width="30" height="30" />{{end}} <strong>{{getIdentifier .Name .Login}}</strong>
				</li>
			{{end}}
		</div>
		<h4>Not Yet On Sourcegraph</h4>
		<div class="list-group">
			{{range .Teammates.ExternalUsers}}
				<li class="list-group-item">
					{{if .AvatarURL}}<img src="{{.AvatarURL}}" class="avatar img-rounded" width="30" height="30" />{{end}} <strong>{{getIdentifier .Name .Login}}</strong>
				</li>
			{{end}}
		</div>
		{{else}}
		{{if .Users}}
		<h3>Users <button class="btn btn-default" data-toggle="collapse" data-target="#addUser"><i class="fa fa-plus"></i></button></h3>
		<div class="collapse" id="addUser">
			<div class="well">
				{{if .IsLDAP}}
				Your teammates can log in with their LDAP credentials. {{if not .DisableExternalLinks}}<a href="https://src.sourcegraph.com/sourcegraph/.docs/config/authentication/" target="_blank">Click here</a> for instructions to configure Sourcegraph for LDAP.{{end}}
				{{else}}
				<strong>Create invite links</strong> for your teammates:
				<ul id="user-invites-list" class="list-group">
				</ul>
				<form action="javascript:void(0);" class="form-inline">
					<input name="Email" type="email" class="input-xlarge form-control" id="user-invite-email" placeholder="user@example.com" value="" required tabindex=1 autofocus>
					<select name="Permission" class="input-small form-control"class="form-control" id="user-invite-perms" tabindex=2>
						<option value="read" selected>can read</option>
						<option value="write">can write</option>
						<option value="admin">is admin</option>
					</select>
					<button type="submit" id="user-invite-btn" class="btn btn-md btn-sgblue" name="Invite" value="Invite" tabindex=3>Invite</button>
					<input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
				</form>
				{{end}}
			</div>
		</div>
		<div class="list-group">
			{{range .Users}}
				<li class="list-group-item">
					<strong>{{getIdentifier .Name .Login}}</strong>{{if .Invite}}<div class="btn-xs btn-red pull-right">Pending Invite</div>{{end}}{{if .Admin}}<div class="btn-xs btn-green pull-right">Admin</div>{{else if .Write}}<div class="btn-xs btn-sgblue pull-right">Write</div>{{end}}
				</li>
			{{end}}
		</div>
		{{end}}
		{{end}}
	</div>
</div>
{{end}}
{{end}}
