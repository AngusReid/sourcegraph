{{define "Head"}}<title>Sourcegraph</title>
{{end}}

{{define "Body"}}

<script>
	console.log(JSON.parse({{json .}}));
	window.repos = JSON.parse({{json .Repos}}) || [];
	window.users = JSON.parse({{json .Users}}) || [];
	window.currentUser = JSON.parse({{json .CurrentUser}});
	// mirrorData is {ReposByOrg: {org: {PrivateRepos, PublicRepos}}}
	// Repos is {Repo: {PushedAt, URI, Description, ExistsLocally}}
	window.mirrorData = JSON.parse({{json .MirrorData}});
	// teammates is {UsersByOrg: org: Users: []}
	// User is {RemoteAccount: {AvatarURL, Domain, Login}, LocalAccount, Email}
	window.teammates = JSON.parse({{json .Teammates}});

	window.progress = {
		numSteps: 4,
	};
	// TODO: inject .DoOnboarding (for post .LinkGitHub)
	{{if (or (and .PrivateMirrors .CurrentUser) .LinkGitHub)}}
		{{if .LinkGitHub}}
			window.progress.currentStep = 0;
			window.progress.githubLinkURL = "{{router.URLToGitHubOAuth}}";
		{{else}}
			if (true) { // TODO(pararth): set if being redirected from GitHub
				window.progress.currentStep = 1;
			} else {
				window.progress.currentStep = 50; // done
			}
		{{end}}
	{{else}}
		window.progress.currentStep = 50; // done
	{{end}}
	window.progress.currentStep = 2; // TODO(rothfels): remove

	window.isMothership = JSON.parse({{json (isMothership .AppURL)}});
	window.allowMirrors = JSON.parse({{json .PrivateMirrors}});
</script>

<div class="dashboard">
	<div id="DashboardContainer"></div>
	<div id="OnboardingContainer"></div>
</div>

{{end}}
