{{define "ROOT"}}
<!DOCTYPE html>
<html lang="en">
	<head
		{{if googleAnalyticsTrackingID}}data-google-analytics-tracking-id="{{googleAnalyticsTrackingID}}"{{end}}
		data-heap-analytics-id="{{heapAnalyticsID}}"
		{{if deployedGitCommitID}}data-deployed-git-commit-id="{{deployedGitCommitID}}"{{end}}
		{{if publicRavenDSN}}data-public-raven-dsn="{{publicRavenDSN}}"{{end}}
		data-current-route="{{.CurrentRoute}}"
		data-template-name="{{.TemplateName}}"
		{{if .CacheControl}}data-cache-control="{{.CacheControl}}"{{end}}
		{{if .CurrentUser}}data-current-user-login="{{.CurrentUser.Login}}"{{end}}
		{{if .CurrentUser}}data-current-user-uid="{{.CurrentUser.UID}}"{{end}}
		{{with .Session}}data-current-user-oauth2-access-token="{{.AccessToken}}"{{end}}
		{{if .CurrentSpanID}}data-appdash-current-span-id="{{.CurrentSpanID}}"{{end}}
		{{if .CurrentSpanID}}data-appdash-current-span-id-trace="{{.CurrentSpanID.Trace}}"{{end}}
		{{if .CurrentSpanID}}data-appdash-current-span-id-span="{{.CurrentSpanID.Span}}"{{end}}
		{{if .CurrentSpanID}}data-appdash-current-span-id-parent="{{.CurrentSpanID.Parent}}"{{end}}
		data-csrf-token="{{.CSRFToken}}"
		>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="twitter:widgets:csp" content="on">
		<link rel="search" type="application/opensearchdescription+xml" href="{{assetURL "/misc/opensearch.xml"}}" title="Sourcegraph" />
		<link href="{{urlToBlogAtomFeed}}" type="application/atom+xml" rel="alternate" title="The Sourcegraph Blog">
		<link rel="shortcut icon" href="{{assetURL "/img/favicon.png"}}">

		<link href="{{assetURL "/bundle.css"}}" rel="stylesheet">
		<link href="{{assetURL "/sourcebox.css"}}" rel="stylesheet">
		<link href="{{assetURL "/font/octicons/octicons.css"}}" rel="stylesheet">

		<script ignore-csp>
			{{if .Features}}window._featureToggles = JSON.parse({{.Features|json}});{{end}}
			window._csrfToken = "{{.CSRFToken}}";
			{{if .CacheControl}}window._cacheControl = "{{.CacheControl}}";{{end}}
		</script>

		<script src="{{assetURL "/analytics.js"}}"></script>

		<link rel="canonical" href="{{.CanonicalURL}}">

		{{/* Add a noindex tag UNLESS the template data has a RobotsIndex field AND it is truthy. */}}
		{{if hasField . "RobotsIndex"}}
		{{if not .RobotsIndex}}<meta name="robots" content="noindex">{{end}}
		{{else}}
		<meta name="robots" content="noindex">
		{{end}}

		{{if .TraceguideAccessToken}}
		<script src="https://resonancelabs.github.io/traceguide/dist/preview/rl-cruntime-browser-0.3.15.min.js"
			type="text/javascript"
			data-access_token="{{.TraceguideAccessToken}}"
			data-service_host="{{.TraceguideServiceHost}}"
			data-group_name="src_browser"></script>
		{{end}}

		{{template "Head" $}}

		{{appconf.ExtraHeadHTML}}
	</head>
	<body class="{{classForRoute .CurrentRoute}}{{if motd}} has-motd{{end}}{{if hasField . "Repo"}} with-fixed-subnav{{end}}"
		{{if hasField . "Repo"}}
			data-current-repo-url="{{(urlToRepo .Repo.URI).String}}"
			data-current-repo-builds-url="{{(urlToRepoSubroute "repo.builds" .Repo.URI).String}}"
		{{end}}
		{{if fileSearchDisabled}}
			data-file-search-disabled="true"
		{{end}}
	>

		<header class="page-header">
			<div class="fixed">
				{{if motd}}<div class="motd">{{motd}}</div>{{end}}

				{{template "Nav" $}}

				<!-- If the "RepoSubnav" template is defined in the current -->
				<!-- template, include it. -->
				<!-- The "RepoSubnav" definition is in "repo/subnav.html" -->
				{{ifTemplate .Common.TemplateName "RepoSubnav" $}}
			</div>
		</header>

		{{if not $.DisableExternalLinks}}
			{{if eq $.TemplateName "home/dashboard.html"}}
				<div class="container{{if .FullWidth}}-fluid{{end}}">
					{{if not haveToolchain}}
						<div
							data-react="AlertView"
							data-html="
								<strong>Sourcegraph is running without support for your language!</strong> <a href='https://src.sourcegraph.com/sourcegraph/.docs/config/toolchains/'>Please troubleshoot this issue!</a>
							">
						</div>
					{{end}}
				</div>
			{{end}}
		{{end}}

		<div class="container{{if .FullWidth}}-fluid{{end}} body" id="{{if .Features.SearchNext}}main{{else}}pjax-container{{end}}" data-pjax-container>
			{{template "Body" $}}
		</div>

		{{template "Footer" $}}

		<div id="loading">
			<div class="loading-indicator"><span class="asterisk-animation">&#x2731;</span></div>
		</div>

		{{if .Debug}}
		<div id="debug">
			<div class="verbose">
			{{if not (eq buildvar.Version "dev")}}{{buildvar.Version}}<br>{{end}}
			{{if buildvar.CommitID}}
				{{hostname}}<br>
				@{{buildvar.CommitID|maxLen 7}} &nbsp;
			{{end}}
			</div>

			{{if .CurrentSpanID.Span}}
				<a href="{{urlToAppdashTrace .Ctx .CurrentSpanID.Trace}}" target="_blank">...</a>
			{{end}}
		</div>
		{{end}}

		{{if appconf.CustomFeedbackForm}}
			<div id="custom-feedback-form">{{customFeedbackForm}}</div>
		{{end}}

		{{template "KeyboardShortcutsHelp" $}}

		{{if useWebpackDevServer}}
		<script src="http://localhost:8080/webpack-dev-server.js"></script>
		{{end}}

		<script src="{{assetURL "/bundle.js"}}"></script>
		{{appconf.ExtraBodyHTML}}
	</body>
</html>
{{end}}
