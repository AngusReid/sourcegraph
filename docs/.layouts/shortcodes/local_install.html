<div class="row">
	<div class="col-md-6">
		<form class="form-inline">
			<label for="os-selector">Choose your operating system:</label>
			<select class="form-control os-selector" onchange="refreshInstallInstructions()" id="os-selector" name="os-selector">
			  <option disabled selected>-- select an option --</option>
			  <option value="mac">Mac OS X (10.8+)</option>
			  <option value="ubuntu">Ubuntu (12.04 & 14.04)</option>
			  <option value="centos">CentOS (6.3)</option>
			  <option value="redhat">RedHat (7.1)</option>
			  <option value="source">install from source</option>
			</select>
		</form>
	</div>
</div>
<div class="row" style="padding-top:10px;">
	<div class="col-md-12">
		<form class="form-inline" id="lang-selector" name="lang-selector">
			<label for="lang-selector">Choose your programming language(s):</label>
			<input class="lang-checkbox" type="checkbox" id="go" checked onclick="refreshInstallInstructions()"> Go
			<input class="lang-checkbox" type="checkbox" id="java" onclick="refreshInstallInstructions()"> Java
		</form>
	</div>
</div>

<br>
<div id="local-install-instructions"></div>

<script>
var refreshInstallInstructions = function () {

	var tag = function(str, tagname) {
		return "<" + tagname + ">" + str + "</" + tagname + ">";
	}
	var code = function(str) {
		return tag(str, "code");
	}
	var p = function(str) {
		return tag(str, "p");
	}
	var h2 = function(str) {
		return tag(str, "h2");
	}
	var strong = function(str) {
		return tag(str, "strong");
	}
	var precode = function(str) {
		return tag(code(str), "pre");
	}
	var a = function(href, text) {
		return "<a href=\"" + href + "\">" + text + "</a>";
	}


	var installURL = "https://sourcegraph.com/.download/install.sh";
	var curlInstall = code("curl -sSL " + installURL + " | bash");
	var wgetInstall = code("wget -O - " + installURL + " | bash");

	var macBinary = strong(a("https://sourcegraph.com/.download/latest/darwin-amd64/src.gz", "src.gz"));
	var linuxBinary = strong(a("https://sourcegraph.com/.download/latest/linux-amd64/src.gz", "src.gz"));
	var debFile = strong(a("https://sourcegraph.com/.download/latest/linux-amd64/src.deb", "src.deb (64-bit)"));
	var rpmFile = strong(a("https://sourcegraph.com/.download/latest/linux-amd64/src.rpm", "src.rpm (64-bit)"));

	var langFlag = function() {
		var langs = "";
		["go", "java"].forEach(function(lang) {
			var isChecked = document.getElementById(lang).checked;
			if (isChecked) {
				langs += lang + ","
			}
		});

		if (langs != "") {
			// Remove off-by-one comma.
			langs = langs.substr(0, langs.length - 1)
			// Add flagname.
			return "--init-langs=" + langs
		}

		return "";
	}

	var runSrcServe = function(linuxFile) {
		var str = h2("Run a local Sourcegraph server") + p(precode("src serve " + langFlag()));
		if (linuxFile) {
			str += p("Or, if you installed using the " + code(linuxFile) + " and have upstart installed, your server will already be running:");
			str += p(precode("sudo restart src"));
		}
		return str;
	}

	var visitLocalhost = h2("Visit " + a("http://localhost:3080", "http://localhost:3080") + " to create an admin acccount") + p("");

	var installOptions = function(installScript, downloadLinks) {
		return p(precode(installScript) + "Direct downloads: " + downloadLinks);
	}

	var macInstructions = function() {
		return installOptions(curlInstall, macBinary) + runSrcServe() + visitLocalhost;
	}

	var ubuntuInstructions = function() {
		return installOptions(wgetInstall, debFile + " or " + linuxBinary) + runSrcServe(".deb") + visitLocalhost;
	}

	var centosInstructions = function() {
		return installOptions(curlInstall, rpmFile + " or " + linuxBinary) + runSrcServe(".rpm") + visitLocalhost;
	}

	var redhatInstructions = function() {
		return installOptions(curlInstall, rpmFile + " or " + linuxBinary) + runSrcServe(".rpm") + visitLocalhost;
	}

	var sourceInstructions = function() {
		return p(strong(a("https://src.sourcegraph.com/sourcegraph@master/.tree/README.dev.md", "Follow the developer README."))) + p("Linux (64-bit) pre-compiled binary: " + linuxBinary) + runSrcServe() + visitLocalhost
	}

	var instructions = function(os) {
		if (os == "mac") {
			return macInstructions();
		}
		if (os == "ubuntu") {
			return ubuntuInstructions();
		}
		if (os == "centos") {
			return centosInstructions();
		}
		if (os == "redhat") {
			return redhatInstructions();
		}
		if (os == "source") {
			return sourceInstructions();
		}
		return "";
	}

	var setInstructions = function(instructions) {
		document.getElementById("local-install-instructions").innerHTML = instructions;
	}

	return function() {
		var el = document.getElementById("os-selector");
		setInstructions(instructions(el.options[el.selectedIndex].value));
	}
}();

refreshInstallInstructions(); // initialization
</script>
